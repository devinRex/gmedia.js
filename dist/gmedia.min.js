!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.gmediajs=e()}}(function(){var e;return function(){function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var _=n[s]={exports:{}};t[s][0].call(_.exports,function(e){return i(t[s][1][e]||e)},_,_.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}return e}()({1:[function(t,n,r){(function(i){(function(){!function(t){if("object"==typeof r&&void 0!==n)n.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var a;a="undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this,a.flvjs=t()}}(function(){var e;return function e(n,r,i){function a(o,l){if(!r[o]){if(!n[o]){var u="function"==typeof t&&t;if(!l&&u)return u(o,!0);if(s)return s(o,!0);var _=new Error("Cannot find module '"+o+"'");throw _.code="MODULE_NOT_FOUND",_}var f=r[o]={exports:{}};n[o][0].call(f.exports,function(e){var t=n[o][1][e];return a(t||e)},f,f.exports,e,n,r,i)}return r[o].exports}for(var s="function"==typeof t&&t,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(t,n,r){(function(i,a){!function(t,i){"object"==typeof r&&void 0!==n?n.exports=i():"function"==typeof e&&e.amd?e(i):t.ES6Promise=i()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function r(e){H=e}function s(e){G=e}function o(){return void 0!==V?function(){V(u)}:l()}function l(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<F;e+=2){(0,W[e])(W[e+1]),W[e]=void 0,W[e+1]=void 0}F=0}function _(e,t){var n=this,r=new this.constructor(c);void 0===r[Q]&&x(r);var i=n._state;if(i){var a=arguments[i-1];G(function(){return T(i,r,a,n._result)})}else w(n,r,e,t);return r}function f(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(c);return y(n,e),n}function c(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return te.error=e,te}}function p(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function v(e,t,n){G(function(e){var r=!1,i=p(n,t,function(n){r||(r=!0,t!==n?y(e,n):k(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,E(e,i))},e)}function b(e,t){t._state===$?k(e,t._result):t._state===ee?E(e,t._result):w(t,void 0,function(t){return y(e,t)},function(t){return E(e,t)})}function g(e,t,r){t.constructor===e.constructor&&r===_&&t.constructor.resolve===f?b(e,t):r===te?(E(e,te.error),te.error=null):void 0===r?k(e,t):n(r)?v(e,t,r):k(e,t)}function y(t,n){t===n?E(t,h()):e(n)?g(t,n,m(n)):k(t,n)}function S(e){e._onerror&&e._onerror(e._result),R(e)}function k(e,t){e._state===J&&(e._result=t,e._state=$,0!==e._subscribers.length&&G(R,e))}function E(e,t){e._state===J&&(e._state=ee,e._result=t,G(S,e))}function w(e,t,n,r){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+$]=n,i[a+ee]=r,0===a&&e._state&&G(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,a=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?T(n,r,i,a):i(a);e._subscribers.length=0}}function A(e,t){try{return e(t)}catch(e){return te.error=e,te}}function T(e,t,r,i){var a=n(r),s=void 0,o=void 0,l=void 0,u=void 0;if(a){if(s=A(r,i),s===te?(u=!0,o=s.error,s.error=null):l=!0,t===s)return void E(t,d())}else s=i,l=!0;t._state!==J||(a&&l?y(t,s):u?E(t,o):e===$?k(t,s):e===ee&&E(t,s))}function M(e,t){try{t(function(t){y(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function L(){return ne++}function x(e){e[Q]=ne++,e._state=void 0,e._result=void 0,e._subscribers=[]}function B(){return new Error("Array Methods must be provided an Array")}function O(e){return new re(this,e).promise}function C(e){var t=this;return new t(U(e)?function(n,r){for(var i=e.length,a=0;a<i;a++)t.resolve(e[a]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function I(e){var t=this,n=new t(c);return E(n,e),n}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(){var e=void 0;if(void 0!==a)e=a;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=ie}var N=void 0;N=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var U=N,F=0,V=void 0,H=void 0,G=function(e,t){W[F]=e,W[F+1]=t,2===(F+=2)&&(H?H(u):Z())},z="undefined"!=typeof window?window:void 0,q=z||{},Y=q.MutationObserver||q.WebKitMutationObserver,X="undefined"==typeof self&&void 0!==i&&"[object process]"==={}.toString.call(i),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,W=new Array(1e3),Z=void 0;Z=X?function(){return function(){return i.nextTick(u)}}():Y?function(){var e=0,t=new Y(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():K?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}():void 0===z&&"function"==typeof t?function(){try{var e=Function("return this")().require("vertx");return V=e.runOnLoop||e.runOnContext,o()}catch(e){return l()}}():l();var Q=Math.random().toString(36).substring(2),J=void 0,$=1,ee=2,te={error:null},ne=0,re=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[Q]||x(this.promise),U(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&k(this.promise,this._result))):E(this.promise,B())}return e.prototype._enumerate=function(e){for(var t=0;this._state===J&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===f){var i=m(e);if(i===_&&e._state!==J)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===ie){var a=new n(c);g(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===J&&(this._remaining--,e===ee?E(r,n):this._result[t]=n),0===this._remaining&&k(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;w(e,void 0,function(e){return n._settledAt($,t,e)},function(e){return n._settledAt(ee,t,e)})},e}(),ie=function(){function e(t){this[Q]=L(),this._result=this._state=void 0,this._subscribers=[],c!==t&&("function"!=typeof t&&P(),this instanceof e?M(this,t):D())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return n(e)?t.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return ie.prototype.then=_,ie.all=O,ie.race=C,ie.resolve=f,ie.reject=I,ie._setScheduler=r,ie._setAsap=s,ie._asap=G,ie.polyfill=j,ie.Promise=ie,ie})}).call(this,t("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var _=new Error('Uncaught, unspecified "error" event. ('+t+")");throw _.context=t,_}if(n=this._events[e],o(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,a,o;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(o=a;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){r=o;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(e){if(c===clearTimeout)return clearTimeout(e);if((c===i||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function o(){p&&d&&(p=!1,d.length?m=d.concat(m):v=-1,m.length&&l())}function l(){if(!p){var e=a(o);p=!0;for(var t=m.length;t;){for(d=m,m=[];++v<t;)d&&d[v].run();v=-1,t=m.length}d=null,p=!1,s(e)}}function u(e,t){this.fun=e,this.array=t}function _(){}var f,c,h=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{c="function"==typeof clearTimeout?clearTimeout:i}catch(e){c=i}}();var d,m=[],p=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||p||a(l)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=_,h.addListener=_,h.once=_,h.off=_,h.removeListener=_,h.removeAllListeners=_,h.emit=_,h.prependListener=_,h.prependOnceListener=_,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(e,t,n){var r=arguments[3],i=arguments[4],a=arguments[5],s=JSON.stringify;t.exports=function(e,t){function n(e){p[e]=!0;for(var t in i[e][1]){var r=i[e][1][t];p[r]||n(r)}}for(var o,l=Object.keys(a),u=0,_=l.length;u<_;u++){var f=l[u],c=a[f].exports;if(c===e||c&&c.default===e){o=f;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},u=0,_=l.length;u<_;u++){var f=l[u];h[f]=f}i[o]=["function(require,module,exports){"+e+"(self); }",h]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[o]=o,i[d]=["function(require,module,exports){var f = require("+s(o)+");(f.default ? f.default : f)(self);}",m];var p={};n(d);var v="("+r+")({"+Object.keys(p).map(function(e){return s(e)+":["+i[e][0]+","+s(i[e][1])+"]"}).join(",")+"},{},["+s(d)+"])",b=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([v],{type:"text/javascript"});if(t&&t.bare)return g;var y=b.createObjectURL(g),S=new Worker(y);return S.objectURL=y,S}},{}],5:[function(e,t,n){"use strict";function r(){return Object.assign({},i)}Object.defineProperty(n,"__esModule",{value:!0}),n.createDefaultConfig=r;var i=n.defaultConfig={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0}},{}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../io/io-controller.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e("../config.js"),l=function(){function e(){r(this,e)}return i(e,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var e=new s.default({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new s.default({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(t){void 0==e.videoElement&&(e.videoElement=window.document.createElement("video"));var n=e.videoElement.canPlayType(t);return"probably"===n||"maybe"==n}},{key:"getFeatureList",value:function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t}}]),e}();n.default=l},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return i(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,n=this._search(t.times,e);return{index:n,milliseconds:t.times[n],fileposition:t.filepositions[n]}}},{key:"_search",value:function(e,t){var n=0,r=e.length-1,i=0,a=0,s=r;for(t<e[0]&&(n=0,a=s+1);a<=s;){if((i=a+Math.floor((s-a)/2))===r||t>=e[i]&&t<e[i+1]){n=i;break}e[i]<t?a=i+1:s=i-1}return n}}]),e}();n.default=a},{}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.SampleInfo=function e(t,n,i,a,s){r(this,e),this.dts=t,this.pts=n,this.duration=i,this.originalDts=a,this.isSyncPoint=s,this.fileposition=null},n.MediaSegmentInfo=function(){function e(){r(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return i(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),n.IDRSampleList=function(){function e(){r(this,e),this._list=[]}return i(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,n=0,r=t.length-1,i=0,a=0,s=r;for(e<t[0].dts&&(n=0,a=s+1);a<=s;){if((i=a+Math.floor((s-a)/2))===r||e>=t[i].dts&&e<t[i+1].dts){n=i;break}t[i].dts<e?a=i+1:s=i-1}return this._list[n]}}]),e}(),n.MediaSegmentInfoList=function(){function e(t){r(this,e),this._type=t,this._list=[],this._lastAppendLocation=-1}return i(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var n=t.length-1,r=0,i=0,a=n,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||e>t[r].lastSample.originalDts&&e<t[r+1].originalBeginDts){s=r;break}t[r].originalBeginDts<e?i=r+1:a=r-1}return s}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,n=e,r=this._lastAppendLocation,i=0;-1!==r&&r<t.length&&n.originalBeginDts>=t[r].lastSample.originalDts&&(r===t.length-1||r<t.length-1&&n.originalBeginDts<t[r+1].originalBeginDts)?i=r+1:t.length>0&&(i=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=i,this._list.splice(i,0,n)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),n=this._list[t].syncPoints;0===n.length&&t>0;)t--,n=this._list[t].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},{}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("events"),o=r(s),l=e("../utils/logger.js"),u=r(l),_=e("../utils/browser.js"),f=r(_),c=e("./mse-events.js"),h=r(c),d=e("./media-segment-info.js"),m=e("../utils/exception.js"),p=function(){function e(t){i(this,e),this.TAG="MSEController",this._config=t,this._emitter=new o.default,this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new d.IDRSampleList}return a(e,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new m.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var n=this._pendingSegments[t];n.splice(0,n.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var r=this._sourceBuffers[t];if(r){if("closed"!==e.readyState){try{e.removeSourceBuffer(r)}catch(e){u.default.e(this.TAG,e.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){u.default.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var n=e,r=""+n.container;n.codec&&n.codec.length>0&&(r+=";codecs="+n.codec);var i=!1;if(u.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[n.type]=n,r!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])u.default.v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+r);else{i=!0;try{var a=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(r);a.addEventListener("error",this.e.onSourceBufferError),a.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return u.default.e(this.TAG,e.message),void this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message})}}this._mimeTypes[n.type]=r}t||this._pendingSegments[n.type].push(n),i||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),f.default.safari&&"audio/mpeg"===n.container&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[t.type];!n||n.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var n=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{n.abort()}catch(e){u.default.e(this.TAG,e.message)}this._idrList.clear();var r=this._pendingSegments[t];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var i=0;i<n.buffered.length;i++){var a=n.buffered.start(i),s=n.buffered.end(i);this._pendingRemoveRanges[t].push({start:a,end:s})}if(n.updating||this._doRemoveRanges(),f.default.safari){var o=this._lastInitSegments[t];o&&(this._pendingSegments[t].push(o),n.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;if(!e||"open"!==e.readyState)return void(e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0));t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){var r=n.buffered;if(r.length>=1&&e-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){for(var r=n.buffered,i=!1,a=0;a<r.length;a++){var s=r.start(a),o=r.end(a);if(s<=e&&e<o+3){if(e-s>=this._config.autoCleanupMaxBackwardDuration){i=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:s,end:l})}}else o<e&&(i=!0,this._pendingRemoveRanges[t].push({start:s,end:o}))}i&&!n.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(t)||n>t)&&(u.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],n=this._pendingRemoveRanges[e];n.length&&!t.updating;){var r=n.shift();t.remove(r.start,r.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var n=e[t].shift();if(n.timestampOffset){var r=this._sourceBuffers[t].timestampOffset,i=n.timestampOffset/1e3,a=Math.abs(r-i);a>.1&&(u.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+i),this._sourceBuffers[t].timestampOffset=i),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(n.data),this._isBufferFull=!1,"video"===t&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(n),22===e.code?(this._isBufferFull||this._emitter.emit(h.default.BUFFER_FULL),this._isBufferFull=!0):(u.default.e(this.TAG,e.message),this._emitter.emit(h.default.ERROR,{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(u.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(h.default.SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){u.default.v(this.TAG,"MediaSource onSourceEnded"),this._emitter.emit(h.default.SOURCE_END,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){u.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){
this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(h.default.UPDATE_END)}},{key:"_onSourceBufferError",value:function(e){u.default.e(this.TAG,"SourceBuffer Error: "+e)}}]),e}();n.default=p},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full",SOURCE_END:"source_end"};n.default=r},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("events"),o=r(s),l=e("../utils/logger.js"),u=r(l),_=e("../utils/logging-control.js"),f=r(_),c=e("./transmuxing-controller.js"),h=r(c),d=e("./transmuxing-events.js"),m=r(d),p=e("./transmuxing-worker.js"),v=r(p),b=e("./media-info.js"),g=r(b),y=function(){function t(n,r){if(i(this,t),this.TAG="Transmuxer",this._emitter=new o.default,r.enableWorker&&"undefined"!=typeof Worker)try{var a=e("webworkify");this._worker=a(v.default),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[n,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},f.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:f.default.getConfig()})}catch(e){u.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h.default(n,r)}else this._controller=new h.default(n,r);if(this._controller){var s=this._controller;s.on(m.default.IO_ERROR,this._onIOError.bind(this)),s.on(m.default.DEMUX_ERROR,this._onDemuxError.bind(this)),s.on(m.default.INIT_SEGMENT,this._onInitSegment.bind(this)),s.on(m.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),s.on(m.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),s.on(m.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),s.on(m.default.MEDIA_INFO,this._onMediaInfo.bind(this)),s.on(m.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),s.on(m.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),s.on(m.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),s.on(m.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this)),s.on(m.default.STREAM_TIME,this._onStreamTime.bind(this))}}return a(t,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),f.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(m.default.INIT_SEGMENT,e,t)})}},{key:"_onMediaSegment",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(m.default.MEDIA_SEGMENT,e,t)})}},{key:"_onLoadingComplete",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.default.LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(m.default.RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.MEDIA_INFO,e)})}},{key:"_onMetaDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.METADATA_ARRIVED,e)})}},{key:"_onScriptDataArrived",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.SCRIPTDATA_ARRIVED,e)})}},{key:"_onStatisticsInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.STATISTICS_INFO,e)})}},{key:"_onIOError",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(m.default.IO_ERROR,e,t)})}},{key:"_onDemuxError",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(m.default.DEMUX_ERROR,e,t)})}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.RECOMMEND_SEEKPOINT,e)})}},{key:"_onStreamTime",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(m.default.STREAM_TIME,e)})}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case m.default.INIT_SEGMENT:case m.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,n.type,n.data);break;case m.default.LOADING_COMPLETE:case m.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case m.default.MEDIA_INFO:Object.setPrototypeOf(n,g.default.prototype),this._emitter.emit(t.msg,n);break;case m.default.METADATA_ARRIVED:case m.default.SCRIPTDATA_ARRIVED:case m.default.STATISTICS_INFO:this._emitter.emit(t.msg,n);break;case m.default.IO_ERROR:case m.default.DEMUX_ERROR:this._emitter.emit(t.msg,n.type,n.info);break;case m.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,n);break;case"logcat_callback":u.default.emitter.emit("log",n.type,n.logcat)}}}]),t}();n.default=y},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("events"),o=r(s),l=e("../utils/logger.js"),u=r(l),_=e("../utils/browser.js"),f=r(_),c=e("./media-info.js"),h=r(c),d=e("../demux/flv-demuxer.js"),m=r(d),p=e("../remux/mp4-remuxer.js"),v=r(p),b=e("../demux/demux-errors.js"),g=r(b),y=e("../io/io-controller.js"),S=r(y),k=e("./transmuxing-events.js"),E=r(k),w=(e("../io/loader.js"),function(){function e(t,n){i(this,e),this.TAG="TransmuxingController",this._emitter=new o.default,this._config=n,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=r,r+=e.duration,e.cors=t.cors,e.withCredentials=t.withCredentials,n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy)}),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return a(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var n=this._mediaDataSource.segments[e],r=this._ioctl=new S.default(n,this._config,e);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var n=this._mediaInfo.segments[t];if(void 0==n)this._pendingSeekTime=e;else{var r=n.getNearestKeyframe(e);this._remuxer.seek(r.milliseconds),this._ioctl.seek(r.fileposition),this._pendingResolveSeekPoint=r.milliseconds}}else{var i=this._mediaInfo.segments[t];if(void 0==i)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var a=i.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(t)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,n=t.length-1,r=0;r<t.length;r++)if(e<t[r].timestampBase){n=r-1;break}return n}},{key:"_onInitChunkArrival",value:function(e,t){var n=this,r=null,i=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,i=this._demuxer.parseChunks(e,t);else if((r=m.default.probe(e)).match){this._demuxer=new m.default(r,this._config),this._remuxer||(this._remuxer=new v.default(this._config));var a=this._mediaDataSource;void 0==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._demuxer.onStreamTime=this._onStreamTime.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),i=this._demuxer.parseChunks(e,t)}else r=null,u.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){n._internalAbort()}),this._emitter.emit(E.default.DEMUX_ERROR,g.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),i=0;return i}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,h.default.prototype));var n=Object.assign({},e);Object.setPrototypeOf(n,h.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=n,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)})}},{key:"_onMetaDataArrived",value:function(e){this._emitter.emit(E.default.METADATA_ARRIVED,e)}},{key:"_onScriptDataArrived",value:function(e){this._emitter.emit(E.default.SCRIPTDATA_ARRIVED,e)}},{key:"_onStreamTime",value:function(e){this._emitter.emit(E.default.STREAM_TIME,e)}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){var t=e,n=t+1;n<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(n)):(this._remuxer.flushStashedSamples(),this._emitter.emit(E.default.LOADING_COMPLETE),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(E.default.RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function(e,t){u.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(E.default.IO_ERROR,e,t),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(e,t){u.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(E.default.DEMUX_ERROR,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(E.default.INIT_SEGMENT,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(E.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var n=t.info.syncPoints,r=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,f.default.safari&&n.length>0&&n[0].originalDts===r&&(r=n[0].pts),this._emitter.emit(E.default.RECOMMEND_SEEKPOINT,r)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],n=Object.assign({},t);n.duration=this._mediaInfo.duration,n.segmentCount=this._mediaInfo.segmentCount,delete n.segments,delete n.keyframesIndex,this._emitter.emit(E.default.MEDIA_INFO,n)}},{key:"_reportStatisticsInfo",value:function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(E.default.STATISTICS_INFO,e)}}]),e}());n.default=w},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint",STREAM_TIME:"stream_time"};n.default=r},{}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../utils/logger.js"),a=(r(i),e("../utils/logging-control.js")),s=r(a),o=e("../utils/polyfill.js"),l=r(o),u=e("./transmuxing-controller.js"),_=r(u),f=e("./transmuxing-events.js"),c=r(f),h=function(e){function t(t,n){var r={msg:c.default.INIT_SEGMENT,data:{type:t,data:n}};e.postMessage(r,[n.data])}function n(t,n){var r={msg:c.default.MEDIA_SEGMENT,data:{type:t,data:n}};e.postMessage(r,[n.data])}function r(){var t={msg:c.default.LOADING_COMPLETE};e.postMessage(t)}function i(){var t={msg:c.default.RECOVERED_EARLY_EOF};e.postMessage(t)}function a(t){var n={msg:c.default.MEDIA_INFO,data:t};e.postMessage(n)}function o(t){var n={msg:c.default.METADATA_ARRIVED,data:t};e.postMessage(n)}function u(t){var n={msg:c.default.SCRIPTDATA_ARRIVED,data:t};e.postMessage(n)}function f(t){var n={msg:c.default.STATISTICS_INFO,data:t};e.postMessage(n)}function h(t,n){e.postMessage({msg:c.default.IO_ERROR,data:{type:t,info:n}})}function d(t,n){e.postMessage({msg:c.default.DEMUX_ERROR,data:{type:t,info:n}})}function m(t){e.postMessage({msg:c.default.RECOMMEND_SEEKPOINT,data:t})}function p(t,n){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:n}})}var v=null,b=p.bind(this);l.default.install(),e.addEventListener("message",function(l){switch(l.data.cmd){case"init":v=new _.default(l.data.param[0],l.data.param[1]),v.on(c.default.IO_ERROR,h.bind(this)),v.on(c.default.DEMUX_ERROR,d.bind(this)),v.on(c.default.INIT_SEGMENT,t.bind(this)),v.on(c.default.MEDIA_SEGMENT,n.bind(this)),v.on(c.default.LOADING_COMPLETE,r.bind(this)),v.on(c.default.RECOVERED_EARLY_EOF,i.bind(this)),v.on(c.default.MEDIA_INFO,a.bind(this)),v.on(c.default.METADATA_ARRIVED,o.bind(this)),v.on(c.default.SCRIPTDATA_ARRIVED,u.bind(this)),v.on(c.default.STATISTICS_INFO,f.bind(this)),v.on(c.default.RECOMMEND_SEEKPOINT,m.bind(this));break;case"destroy":v&&(v.destroy(),v=null),e.postMessage({msg:"destroyed"});break;case"start":v.start();break;case"stop":v.stop();break;case"seek":v.seek(l.data.param);break;case"pause":v.pause();break;case"resume":v.resume();break;case"logging_config":var p=l.data.param;s.default.applyConfig(p),!0===p.enableCallback?s.default.addLogListener(b):s.default.removeLogListener(b)}})};n.default=h},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/logger.js"),o=r(s),l=e("../utils/utf8-conv.js"),u=r(l),_=e("../utils/exception.js"),f=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),c=function(){function e(){i(this,e)}return a(e,null,[{key:"parseScriptData",value:function(t,n,r){var i={};try{var a=e.parseValue(t,n,r),s=e.parseValue(t,n+a.size,r-a.size);i[a.data]=s.data}catch(e){o.default.e("AMF",e.toString())}return i}},{key:"parseObject",value:function(t,n,r){if(r<3)throw new _.IllegalStateException("Data not enough when parse ScriptDataObject");var i=e.parseString(t,n,r),a=e.parseValue(t,n+i.size,r-i.size),s=a.objectEnd;return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:s}}},{key:"parseVariable",value:function(t,n,r){return e.parseObject(t,n,r)}},{key:"parseString",value:function(e,t,n){if(n<2)throw new _.IllegalStateException("Data not enough when parse String");var r=new DataView(e,t,n),i=r.getUint16(0,!f),a=void 0;return a=i>0?(0,u.default)(new Uint8Array(e,t+2,i)):"",{data:a,size:2+i}}},{key:"parseLongString",value:function(e,t,n){if(n<4)throw new _.IllegalStateException("Data not enough when parse LongString");var r=new DataView(e,t,n),i=r.getUint32(0,!f),a=void 0;return a=i>0?(0,u.default)(new Uint8Array(e,t+4,i)):"",{data:a,size:4+i}}},{key:"parseDate",value:function(e,t,n){if(n<10)throw new _.IllegalStateException("Data size invalid when parse Date");var r=new DataView(e,t,n),i=r.getFloat64(0,!f);return i+=60*r.getInt16(8,!f)*1e3,{data:new Date(i),size:10}}},{key:"parseValue",value:function(t,n,r){if(r<1)throw new _.IllegalStateException("Data not enough when parse Value");var i=new DataView(t,n,r),a=1,s=i.getUint8(0),l=void 0,u=!1;try{switch(s){case 0:l=i.getFloat64(1,!f),a+=8;break;case 1:l=!!i.getUint8(1),a+=1;break;case 2:var c=e.parseString(t,n+1,r-1);l=c.data,a+=c.size;break;case 3:l={};var h=0;for(9==(16777215&i.getUint32(r-4,!f))&&(h=3);a<r-4;){var d=e.parseObject(t,n+a,r-a-h);if(d.objectEnd)break;l[d.data.name]=d.data.value,a+=d.size}if(a<=r-3){9===(16777215&i.getUint32(a-1,!f))&&(a+=3)}break;case 8:l={},a+=4;var m=0;for(9==(16777215&i.getUint32(r-4,!f))&&(m=3);a<r-8;){var p=e.parseVariable(t,n+a,r-a-m);if(p.objectEnd)break;l[p.data.name]=p.data.value,a+=p.size}if(a<=r-3){9===(16777215&i.getUint32(a-1,!f))&&(a+=3)}break;case 9:l=void 0,a=1,u=!0;break;case 10:l=[];var v=i.getUint32(1,!f);a+=4;for(var b=0;b<v;b++){var g=e.parseValue(t,n+a,r-a);l.push(g.data),a+=g.size}break;case 11:var y=e.parseDate(t,n+1,r-1);l=y.data,a+=y.size;break;case 12:var S=e.parseString(t,n+1,r-1);l=S.data,a+=S.size;break;default:a=r,o.default.w("AMF","Unsupported AMF value type "+s)}}catch(e){o.default.e("AMF",e.toString())}return{data:l,size:a,objectEnd:u}}}]),e}();n.default=c},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};n.default=r},{}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../utils/exception.js"),s=function(){function e(t){r(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return i(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new a.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new a.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(r,this._current_word_bits_left),s=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,n=n<<i|s}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();n.default=s},{"../utils/exception.js":40}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/logger.js"),u=r(l),_=e("./amf-parser.js"),f=r(_),c=e("./sps-parser.js"),h=r(c),d=e("./demux-errors.js"),m=r(d),p=e("../core/media-info.js"),v=r(p),b=e("../utils/exception.js"),g=function(){function e(t,n){i(this,e),this.TAG="FLVDemuxer",this._config=n,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._onStreamTime=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new v.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return o(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._onStreamTime=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new v.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,n){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new b.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var r=0,i=this._littleEndian;if(0===n){if(!(t.byteLength>13))return 0;r=e.probe(t).dataOffset}if(this._firstParse){this._firstParse=!1,n+r!==this._dataOffset&&u.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(t,r).getUint32(0,!i)&&u.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),r+=4}for(;r<t.byteLength;){this._dispatch=!0;var a=new DataView(t,r);if(r+11+4>t.byteLength)break;var s=a.getUint8(0),o=16777215&a.getUint32(0,!i);if(r+11+o+4>t.byteLength)break;if(8===s||9===s||18===s){var l=a.getUint8(4),_=a.getUint8(5),f=a.getUint8(6),c=a.getUint8(7),h=f|_<<8|l<<16|c<<24;0!==(16777215&a.getUint32(7,!i))&&u.default.w(this.TAG,"Meet tag which has StreamID != 0!");var d=r+11;switch(s){case 8:this._parseAudioData(t,d,o,h);break;case 9:null!=this._onStreamTime&&this._onStreamTime(h),this._parseVideoData(t,d,o,h,n+r);break;case 18:this._parseScriptData(t,d,o)}var m=a.getUint32(11+o,!i);m!==11+o&&u.default.w(this.TAG,"Invalid PrevTagSize "+m),r+=11+o+4}else u.default.w(this.TAG,"Unsupported tag type "+s+", skipped"),r+=11+o+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),r}},{key:"_parseScriptData",value:function(e,t,n){var r=f.default.parseScriptData(e,t,n);if(r.hasOwnProperty("onMetaData")){if(null==r.onMetaData||"object"!==s(r.onMetaData))return void u.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&u.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var i=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},i)),"boolean"==typeof i.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=i.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof i.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=i.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof i.audiodatarate&&(this._mediaInfo.audioDataRate=i.audiodatarate),"number"==typeof i.videodatarate&&(this._mediaInfo.videoDataRate=i.videodatarate),"number"==typeof i.width&&(this._mediaInfo.width=i.width),"number"==typeof i.height&&(this._mediaInfo.height=i.height),"number"==typeof i.duration){if(!this._durationOverrided){var a=Math.floor(i.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof i.framerate){var o=Math.floor(1e3*i.framerate);if(o>0){var l=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=l,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=l}}if("object"===s(i.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var _=i.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(_),i.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=i,u.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}
Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],n=[],r=1;r<e.times.length;r++){var i=this._timestampBase+Math.floor(1e3*e.times[r]);t.push(i),n.push(e.filepositions[r])}return{times:t,filepositions:n}}},{key:"_parseAudioData",value:function(e,t,n,r){if(n<=1)return void u.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var i=(this._littleEndian,new DataView(e,t,n)),a=i.getUint8(0),s=a>>>4;if(2!==s&&10!==s)return void this._onError(m.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s);var o=0,l=(12&a)>>>2;if(!(l>=0&&l<=4))return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);o=this._flvSoundRateTable[l];var _=1&a,f=this._audioMetadata,c=this._audioTrack;if(f||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),f=this._audioMetadata={},f.type="audio",f.id=c.id,f.timescale=this._timescale,f.duration=this._duration,f.audioSampleRate=o,f.channelCount=0===_?1:2),10===s){var h=this._parseAACAudioData(e,t+1,n-1);if(void 0==h)return;if(0===h.packetType){f.config&&u.default.w(this.TAG,"Found another AudioSpecificConfig!");var d=h.data;f.audioSampleRate=d.samplingRate,f.channelCount=d.channelCount,f.codec=d.codec,f.originalCodec=d.originalCodec,f.config=d.config,f.refSampleDuration=1024/f.audioSampleRate*f.timescale,u.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",f);var p=this._mediaInfo;p.audioCodec=f.originalCodec,p.audioSampleRate=f.audioSampleRate,p.audioChannelCount=f.channelCount,p.hasVideo?null!=p.videoCodec&&(p.mimeType='video/x-flv; codecs="'+p.videoCodec+","+p.audioCodec+'"'):p.mimeType='video/x-flv; codecs="'+p.audioCodec+'"',p.isComplete()&&this._onMediaInfo(p)}else if(1===h.packetType){var v=this._timestampBase+r,b={unit:h.data,length:h.data.byteLength,dts:v,pts:v};c.samples.push(b),c.length+=h.data.length}else u.default.e(this.TAG,"Flv: Unsupported AAC data type "+h.packetType)}else if(2===s){if(!f.codec){var g=this._parseMP3AudioData(e,t+1,n-1,!0);if(void 0==g)return;f.audioSampleRate=g.samplingRate,f.channelCount=g.channelCount,f.codec=g.codec,f.originalCodec=g.originalCodec,f.refSampleDuration=1152/f.audioSampleRate*f.timescale,u.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",f);var y=this._mediaInfo;y.audioCodec=f.codec,y.audioSampleRate=f.audioSampleRate,y.audioChannelCount=f.channelCount,y.audioDataRate=g.bitRate,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}var S=this._parseMP3AudioData(e,t+1,n-1,!1);if(void 0==S)return;var k=this._timestampBase+r,E={unit:S,length:S.byteLength,dts:k,pts:k};c.samples.push(E),c.length+=S.length}}}},{key:"_parseAACAudioData",value:function(e,t,n){if(n<=1)return void u.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var r={},i=new Uint8Array(e,t,n);return r.packetType=i[0],0===i[0]?r.data=this._parseAACAudioSpecificConfig(e,t+1,n-1):r.data=i.subarray(1),r}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,n){var r=new Uint8Array(e,t,n),i=null,a=0,s=0,o=0,l=null;if(a=s=r[0]>>>3,(o=(7&r[0])<<1|r[1]>>>7)<0||o>=this._mpegSamplingRates.length)return void this._onError(m.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var u=this._mpegSamplingRates[o],_=(120&r[1])>>>3;if(_<0||_>=8)return void this._onError(m.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(l=(7&r[1])<<1|r[2]>>>7,r[2]);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?o>=6?(a=5,i=new Array(4),l=o-3):(a=2,i=new Array(2),l=o):-1!==f.indexOf("android")?(a=2,i=new Array(2),l=o):(a=5,l=o,i=new Array(4),o>=6?l=o-3:1===_&&(a=2,i=new Array(2),l=o)),i[0]=a<<3,i[0]|=(15&o)>>>1,i[1]=(15&o)<<7,i[1]|=(15&_)<<3,5===a&&(i[1]|=(15&l)>>>1,i[2]=(1&l)<<7,i[2]|=8,i[3]=0),{config:i,samplingRate:u,channelCount:_,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+s}}},{key:"_parseMP3AudioData",value:function(e,t,n,r){if(n<4)return void u.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var i=(this._littleEndian,new Uint8Array(e,t,n)),a=null;if(r){if(255!==i[0])return;var s=i[1]>>>3&3,o=(6&i[1])>>1,l=(240&i[2])>>>4,_=(12&i[2])>>>2,f=i[3]>>>6&3,c=3!==f?2:1,h=0,d=0;switch(s){case 0:h=this._mpegAudioV25SampleRateTable[_];break;case 2:h=this._mpegAudioV20SampleRateTable[_];break;case 3:h=this._mpegAudioV10SampleRateTable[_]}switch(o){case 1:34,l<this._mpegAudioL3BitRateTable.length&&(d=this._mpegAudioL3BitRateTable[l]);break;case 2:33,l<this._mpegAudioL2BitRateTable.length&&(d=this._mpegAudioL2BitRateTable[l]);break;case 3:32,l<this._mpegAudioL1BitRateTable.length&&(d=this._mpegAudioL1BitRateTable[l])}a={bitRate:d,samplingRate:h,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else a=i;return a}},{key:"_parseVideoData",value:function(e,t,n,r,i){if(n<=1)return void u.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,n)[0],s=(240&a)>>>4,o=15&a;if(7!==o)return void this._onError(m.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+o);this._parseAVCVideoPacket(e,t+1,n-1,r,i,s)}}},{key:"_parseAVCVideoPacket",value:function(e,t,n,r,i,a){if(n<4)return void u.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var s=this._littleEndian,o=new DataView(e,t,n),l=o.getUint8(0),_=16777215&o.getUint32(0,!s),f=_<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===l)this._parseAVCVideoData(e,t+4,n-4,r,i,a,f);else if(2!==l)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,n){if(n<7)return void u.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var r=this._videoMetadata,i=this._videoTrack,a=this._littleEndian,s=new DataView(e,t,n);r?void 0!==r.avcc&&u.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=i.id,r.timescale=this._timescale,r.duration=this._duration);var o=s.getUint8(0),l=s.getUint8(1);s.getUint8(2),s.getUint8(3);if(1!==o||0===l)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=1+(3&s.getUint8(4)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(m.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var _=31&s.getUint8(5);if(0===_)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");_>1&&u.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+_);for(var f=6,c=0;c<_;c++){var d=s.getUint16(f,!a);if(f+=2,0!==d){var p=new Uint8Array(e,t+f,d);f+=d;var v=h.default.parseSPS(p);if(0===c){r.codecWidth=v.codec_size.width,r.codecHeight=v.codec_size.height,r.presentWidth=v.present_size.width,r.presentHeight=v.present_size.height,r.profile=v.profile_string,r.level=v.level_string,r.bitDepth=v.bit_depth,r.chromaFormat=v.chroma_format,r.sarRatio=v.sar_ratio,r.frameRate=v.frame_rate,!1!==v.frame_rate.fixed&&0!==v.frame_rate.fps_num&&0!==v.frame_rate.fps_den||(r.frameRate=this._referenceFrameRate);var b=r.frameRate.fps_den,g=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(b/g);for(var y=p.subarray(1,4),S="avc1.",k=0;k<3;k++){var E=y[k].toString(16);E.length<2&&(E="0"+E),S+=E}r.codec=S;var w=this._mediaInfo;w.width=r.codecWidth,w.height=r.codecHeight,w.fps=r.frameRate.fps,w.profile=r.profile,w.level=r.level,w.refFrames=v.ref_frames,w.chromaFormat=v.chroma_format_string,w.sarNum=r.sarRatio.width,w.sarDen=r.sarRatio.height,w.videoCodec=S,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this._onMediaInfo(w)}}}var R=s.getUint8(f);if(0===R)return void this._onError(m.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");R>1&&u.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+R),f++;for(var A=0;A<R;A++){var T=s.getUint16(f,!a);f+=2,0!==T&&(f+=T)}r.avcc=new Uint8Array(n),r.avcc.set(new Uint8Array(e,t,n),0),u.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)}},{key:"_parseAVCVideoData",value:function(e,t,n,r,i,a,s){for(var o=this._littleEndian,l=new DataView(e,t,n),_=[],f=0,c=0,h=this._naluLengthSize,d=this._timestampBase+r,m=1===a;c<n;){if(c+4>=n){u.default.w(this.TAG,"Malformed Nalu near timestamp "+d+", offset = "+c+", dataSize = "+n);break}var p=l.getUint32(c,!o);if(3===h&&(p>>>=8),p>n-h)return void u.default.w(this.TAG,"Malformed Nalus near timestamp "+d+", NaluSize > DataSize!");var v=31&l.getUint8(c+h);5===v&&(m=!0);var b=new Uint8Array(e,t+c,h+p),g={type:v,data:b};_.push(g),f+=b.byteLength,c+=h+p}if(_.length){var y=this._videoTrack,S={units:_,length:f,isKeyframe:m,dts:d,cts:s,pts:d+s};m&&(S.fileposition=i),y.samples.push(S),y.length+=f}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"onStreamTime",get:function(){return this._onStreamTime},set:function(e){this._onStreamTime=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),n={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return n;var r=(4&t[4])>>>2!=0,i=0!=(1&t[4]),s=a(t,5);return s<9?n:{match:!0,consumed:s,dataOffset:s,hasAudioTrack:r,hasVideoTrack:i}}}]),e}();n.default=g},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./exp-golomb.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=function(){function e(){r(this,e)}return i(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,r=new Uint8Array(n),i=0,a=0;a<n;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(r[i]=t[a],i++);return new Uint8Array(r.buffer,0,i)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),r=new s.default(n);r.readByte();var i=r.readByte();r.readByte();var a=r.readByte();r.readUEG();var o=e.getProfileString(i),l=e.getLevelString(a),u=1,_=420,f=[0,420,422,444],c=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(u=r.readUEG(),3===u&&r.readBits(1),u<=3&&(_=f[u]),c=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var h=3!==u?8:12,d=0;d<h;d++)r.readBool()&&(d<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var m=r.readUEG();if(0===m)r.readUEG();else if(1===m){r.readBits(1),r.readSEG(),r.readSEG();for(var p=r.readUEG(),v=0;v<p;v++)r.readSEG()}var b=r.readUEG();r.readBits(1);var g=r.readUEG(),y=r.readUEG(),S=r.readBits(1);0===S&&r.readBits(1),r.readBits(1);var k=0,E=0,w=0,R=0;r.readBool()&&(k=r.readUEG(),E=r.readUEG(),w=r.readUEG(),R=r.readUEG());var A=1,T=1,M=0,L=!0,x=0,B=0;if(r.readBool()){if(r.readBool()){var O=r.readByte(),C=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],I=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];O>0&&O<16?(A=C[O-1],T=I[O-1]):255===O&&(A=r.readByte()<<8|r.readByte(),T=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var P=r.readBits(32),D=r.readBits(32);L=r.readBool(),x=D,B=2*P,M=x/B}}var j=1;1===A&&1===T||(j=A/T);var N=0,U=0;if(0===u)N=1,U=2-S;else{var F=3===u?1:2,V=1===u?2:1;N=F,U=V*(2-S)}var H=16*(g+1),G=16*(y+1)*(2-S);H-=(k+E)*N,G-=(w+R)*U;var z=Math.ceil(H*j);return r.destroy(),r=null,{profile_string:o,level_string:l,bit_depth:c,ref_frames:b,chroma_format:_,chroma_format_string:e.getChromaFormatString(_),frame_rate:{fixed:L,fps:M,fps_den:B,fps_num:x},sar_ratio:{width:A,height:T},codec_size:{width:H,height:G},present_size:{width:z,height:G}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,r=8,i=0,a=0;a<t;a++)0!==r&&(i=e.readSEG(),r=(n+i+256)%256),n=0===r?n:r}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();n.default=o},{"./exp-golomb.js":17}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=e;if(null==n||"object"!==(void 0===n?"undefined":o(n)))throw new k.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!n.hasOwnProperty("type"))throw new k.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(n.type){case"flv":return new d.default(n,t);default:return new p.default(n,t)}}function a(){return f.default.supportMSEH264Playback()}function s(){return f.default.getFeatureList()}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=e("./utils/polyfill.js"),u=r(l),_=e("./core/features.js"),f=r(_),c=e("./io/loader.js"),h=e("./player/flv-player.js"),d=r(h),m=e("./player/native-player.js"),p=r(m),v=e("./player/player-events.js"),b=r(v),g=e("./player/player-errors.js"),y=e("./utils/logging-control.js"),S=r(y),k=e("./utils/exception.js");u.default.install();var E={};E.createPlayer=i,E.isSupported=a,E.getFeatureList=s,E.BaseLoader=c.BaseLoader,E.LoaderStatus=c.LoaderStatus,E.LoaderErrors=c.LoaderErrors,E.Events=b.default,E.ErrorTypes=g.ErrorTypes,E.ErrorDetails=g.ErrorDetails,E.FlvPlayer=d.default,E.NativePlayer=p.default,E.LoggingControl=S.default,Object.defineProperty(E,"version",{enumerable:!0,get:function(){return"1.6.1"}}),n.default=E},{"./core/features.js":6,"./io/loader.js":24,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,t,n){"use strict";t.exports=e("./flv.js").default},{"./flv.js":20}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=e("../utils/logger.js"),f=(r(_),e("../utils/browser.js")),c=r(f),h=e("./loader.js"),d=e("../utils/exception.js"),m=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));return r.TAG="FetchStreamLoader",r._seekHandler=e,r._config=n,r._needStash=!0,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return s(t,e),u(t,null,[{key:"isSupported",value:function(){try{var e=c.default.msedge&&c.default.version.minor>=15048,t=!c.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]),u(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var n=this;this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(r=e.redirectedURL);var i=this._seekHandler.getConfig(r,t),a=new self.Headers;if("object"===o(i.headers)){var s=i.headers;for(var l in s)s.hasOwnProperty(l)&&a.append(l,s[l])}var u={method:"GET",headers:a,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===o(this._config.headers))for(var _ in this._config.headers)a.append(_,this._config.headers[_]);!1===e.cors&&(u.mode="same-origin"),e.withCredentials&&(u.credentials="include"),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,u.signal=this._abortController.signal),this._status=h.LoaderStatus.kConnecting,self.fetch(i.url,u).then(function(e){if(n._requestAbort)return n._status=h.LoaderStatus.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==i.url&&n._onURLRedirect){var t=n._seekHandler.removeURLParameters(e.url);n._onURLRedirect(t)}var r=e.headers.get("Content-Length");return null!=r&&(n._contentLength=parseInt(r),0!==n._contentLength&&n._onContentLengthKnown&&n._onContentLengthKnown(n._contentLength)),n._pump.call(n,e.body.getReader())}if(n._status=h.LoaderStatus.kError,!n._onError)throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);n._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}).catch(function(e){if(!n._abortController||!n._abortController.signal.aborted){if(n._status=h.LoaderStatus.kError,!n._onError)throw e;n._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}})}},{key:"abort",value:function(){if(this._requestAbort=!0,(this._status!==h.LoaderStatus.kBuffering||!c.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){return}}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(n){if(n.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=h.LoaderStatus.kError;var r=h.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new d.RuntimeException(i.msg);t._onError(r,i)}else t._status=h.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=h.LoaderStatus.kComplete);if(!0===t._requestAbort)return t._status=h.LoaderStatus.kComplete,e.cancel();t._status=h.LoaderStatus.kBuffering;var a=n.value.buffer,s=t._range.from+t._receivedLength;t._receivedLength+=a.byteLength,t._onDataArrival&&t._onDataArrival(a,s,t._receivedLength),t._pump(e)}}).catch(function(e){if(t._abortController&&t._abortController.signal.aborted)return void(t._status=h.LoaderStatus.kComplete);if(11!==e.code||!c.default.msedge){t._status=h.LoaderStatus.kError;var n=0,r=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(n=h.LoaderErrors.EXCEPTION,r={code:e.code,msg:e.message}):(n=h.LoaderErrors.EARLY_EOF,r={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new d.RuntimeException(r.msg);t._onError(n,r)}})}}]),t}(h.BaseLoader);n.default=m},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/logger.js"),o=r(s),l=e("./speed-sampler.js"),u=r(l),_=e("./loader.js"),f=e("./fetch-stream-loader.js"),c=r(f),h=e("./xhr-moz-chunked-loader.js"),d=r(h),m=e("./xhr-msstream-loader.js"),p=(r(m),e("./xhr-range-loader.js")),v=r(p),b=e("./websocket-loader.js"),g=r(b),y=e("./range-seek-handler.js"),S=r(y),k=e("./param-seek-handler.js"),E=r(k),w=e("../utils/exception.js"),R=function(){function e(t,n,r){i(this,e),this.TAG="IOController",this._config=n,this._extraData=r,this._stashInitialSize=393216,void 0!=n.stashInitialSize&&n.stashInitialSize>0&&(this._stashInitialSize=n.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===n.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new u.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return a(e,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new S.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",n=e.seekParamEnd||"bend";this._seekHandler=new E.default(t,n)}else{if("custom"!==e.seekType)throw new w.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new w.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}},{key:"_selectLoader",value:function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=g.default;else if(c.default.isSupported())this._loaderClass=c.default;else if(d.default.isSupported())this._loaderClass=d.default;else{if(!v.default.isSupported())throw new w.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=v.default}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var n={from:e,to:-1};this._currentRange={from:n.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,n),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new w.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var n=new ArrayBuffer(t);if(this._stashUsed>0){var r=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(n,0,t).set(r,0)}this._stashBuffer=n,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,n=t.length-1,r=0,i=0,a=n;if(e<t[0])return t[0];for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?i=r+1:a=r-1}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var n=1024*t+1048576;this._bufferSize<n&&this._expandBuffer(n),this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,n){if(!this._onDataArrival)throw new w.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var r=this._speedSampler.lastSecondKBps;if(0!==r){var i=this._normalizeSpeed(r);this._speedNormalized!==i&&(this._speedNormalized=i,this._adjustStashSize(i))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var s=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var o=this._stashBuffer.slice(0,this._stashUsed),l=this._dispatchChunks(o,this._stashByteStart);if(l<o.byteLength){if(l>0){var u=new Uint8Array(o,l);s.set(u,0),this._stashUsed=u.byteLength,this._stashByteStart+=l}}else this._stashUsed=0,this._stashByteStart+=l;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var _=this._dispatchChunks(e,t);if(_<e.byteLength){var f=e.byteLength-_;f>this._bufferSize&&(this._expandBuffer(f),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(e,_),0),this._stashUsed+=f,this._stashByteStart=t+_}}}else if(0===this._stashUsed){var c=this._dispatchChunks(e,t);if(c<e.byteLength){var h=e.byteLength-c;h>this._bufferSize&&this._expandBuffer(h);var d=new Uint8Array(this._stashBuffer,0,this._bufferSize);d.set(new Uint8Array(e,c),0),this._stashUsed+=h,this._stashByteStart=t+c}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var p=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(p<this._stashUsed&&p>0){var v=new Uint8Array(this._stashBuffer,p);m.set(v,0)}this._stashUsed-=p,this._stashByteStart+=p}}}},{key:"_flushStashBuffer",value:function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),n=this._dispatchChunks(t,this._stashByteStart),r=t.byteLength-n;if(n<t.byteLength){if(!e){if(n>0){var i=new Uint8Array(this._stashBuffer,0,this._bufferSize),a=new Uint8Array(t,n);i.set(a,0),this._stashUsed=a.byteLength,this._stashByteStart+=n}return 0}o.default.w(this.TAG,r+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,r}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(e,t){
switch(o.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=_.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case _.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var n=this._currentRange.to+1;return void(n<this._totalLength&&(o.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(n,!1)))}e=_.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case _.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case _.LoaderErrors.CONNECTING_TIMEOUT:case _.LoaderErrors.HTTP_STATUS_CODE_INVALID:case _.LoaderErrors.EXCEPTION:}if(!this._onError)throw new w.RuntimeException("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||void 0!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===v.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),e}();n.default=R},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.BaseLoader=n.LoaderErrors=n.LoaderStatus=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../utils/exception.js"),s=n.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};n.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},n.BaseLoader=function(){function e(t){r(this,e),this._type=t||"undefined",this._status=s.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return i(e,[{key:"destroy",value:function(){this._status=s.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===s.kConnecting||this._status===s.kBuffering}},{key:"open",value:function(e,t){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new a.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}()},{"../utils/exception.js":40}],25:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this._startName=t,this._endName=n}return i(e,[{key:"getConfig",value:function(e,t){var n=e;if(0!==t.from||-1!==t.to){var r=!0;-1===n.indexOf("?")&&(n+="?",r=!1),r&&(n+="&"),n+=this._startName+"="+t.from.toString(),-1!==t.to&&(n+="&"+this._endName+"="+t.to.toString())}return{url:n,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],n=void 0,r=e.indexOf("?");-1!==r&&(n=e.substring(r+1));var i="";if(void 0!=n&&n.length>0)for(var a=n.split("&"),s=0;s<a.length;s++){var o=a[s].split("="),l=s>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(i+="&"),i+=a[s])}return 0===i.length?t:t+"?"+i}}]),e}();n.default=a},{}],26:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this._zeroStart=t||!1}return i(e,[{key:"getConfig",value:function(e,t){var n={};if(0!==t.from||-1!==t.to){var r=void 0;r=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",n.Range=r}else this._zeroStart&&(n.Range="bytes=0-");return{url:e,headers:n}}},{key:"removeURLParameters",value:function(e){return e}}]),e}();n.default=a},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return i(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();n.default=a},{}],28:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("../utils/logger.js"),u=(function(e){e&&e.__esModule}(l),e("./loader.js")),_=e("../utils/exception.js"),f=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return a(t,e),o(t,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket}catch(e){return!1}}}]),o(t,[{key:"destroy",value:function(){this._ws&&this.abort(),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=u.LoaderStatus.kConnecting}catch(e){this._status=u.LoaderStatus.kError;var n={code:e.code,msg:e.message};if(!this._onError)throw new _.RuntimeException(n.msg);this._onError(u.LoaderErrors.EXCEPTION,n)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=u.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._status=u.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function(e){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t._dispatchArrayBuffer(n.result)},n.readAsArrayBuffer(e.data)}else{this._status=u.LoaderStatus.kError;var r={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new _.RuntimeException(r.msg);this._onError(u.LoaderErrors.EXCEPTION,r)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,n=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){this._status=u.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new _.RuntimeException(t.msg);this._onError(u.LoaderErrors.EXCEPTION,t)}}]),t}(u.BaseLoader);n.default=f},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/logger.js"),_=function(e){return e&&e.__esModule?e:{default:e}}(u),f=e("./loader.js"),c=e("../utils/exception.js"),h=function(e){function t(e,n){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-moz-chunked-loader"));return a.TAG="MozChunkedLoader",a._seekHandler=e,a._config=n,a._needStash=!0,a._xhr=null,a._requestAbort=!1,a._contentLength=null,a._receivedLength=0,a}return a(t,e),l(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return _.default.w("MozChunkedLoader",e.message),!1}}}]),l(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var n=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(n=e.redirectedURL);var r=this._seekHandler.getConfig(n,t);this._requestURL=r.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",r.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),e.withCredentials&&(i.withCredentials=!0),"object"===s(r.headers)){var a=r.headers;for(var o in a)a.hasOwnProperty(o)&&i.setRequestHeader(o,a[o])}if("object"===s(this._config.headers)){var l=this._config.headers;for(var u in l)l.hasOwnProperty(u)&&i.setRequestHeader(u,l[u])}this._status=f.LoaderStatus.kConnecting,i.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=f.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var n=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(n)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=f.LoaderStatus.kError,!this._onError)throw new c.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=f.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==f.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){if(!0===this._requestAbort)return void(this._requestAbort=!1);this._status!==f.LoaderStatus.kError&&(this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},{key:"_onXhrError",value:function(e){this._status=f.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&e.loaded<this._contentLength?(t=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=f.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new c.RuntimeException(n.msg);this._onError(t,n)}}]),t}(f.BaseLoader);n.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/logger.js"),_=function(e){return e&&e.__esModule?e:{default:e}}(u),f=e("./loader.js"),c=e("../utils/exception.js"),h=function(e){function t(e,n){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-msstream-loader"));return a.TAG="MSStreamLoader",a._seekHandler=e,a._config=n,a._needStash=!0,a._xhr=null,a._reader=null,a._totalRange=null,a._currentRange=null,a._currentRequestURL=null,a._currentRedirectedURL=null,a._contentLength=null,a._receivedLength=0,a._bufferLimit=16777216,a._lastTimeBufferSize=0,a._isReconnecting=!1,a}return a(t,e),l(t,null,[{key:"isSupported",value:function(){try{if(void 0===self.MSStream||void 0===self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="ms-stream","ms-stream"===e.responseType}catch(e){return _.default.w("MSStreamLoader",e.message),!1}}}]),l(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._internalOpen(e,t,!1)}},{key:"_internalOpen",value:function(e,t,n){this._dataSource=e,n?this._currentRange=t:this._totalRange=t;var r=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?r=this._currentRedirectedURL:void 0!=e.redirectedURL&&(r=e.redirectedURL));var i=this._seekHandler.getConfig(r,t);this._currentRequestURL=i.url;var a=this._reader=new self.MSStreamReader;a.onprogress=this._msrOnProgress.bind(this),a.onload=this._msrOnLoad.bind(this),a.onerror=this._msrOnError.bind(this);var o=this._xhr=new XMLHttpRequest;if(o.open("GET",i.url,!0),o.responseType="ms-stream",o.onreadystatechange=this._xhrOnReadyStateChange.bind(this),o.onerror=this._xhrOnError.bind(this),e.withCredentials&&(o.withCredentials=!0),"object"===s(i.headers)){var l=i.headers;for(var u in l)l.hasOwnProperty(u)&&o.setRequestHeader(u,l[u])}if("object"===s(this._config.headers)){var _=this._config.headers;for(var c in _)_.hasOwnProperty(c)&&o.setRequestHeader(c,_[c])}this._isReconnecting?this._isReconnecting=!1:this._status=f.LoaderStatus.kConnecting,o.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=f.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState)if(t.status>=200&&t.status<=299){if(this._status=f.LoaderStatus.kBuffering,void 0!=t.responseURL){var n=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}var r=t.getResponseHeader("Content-Length");if(null!=r&&null==this._contentLength){var i=parseInt(r);i>0&&(this._contentLength=i,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=f.LoaderStatus.kError,!this._onError)throw new c.RuntimeException("MSStreamLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else if(3===t.readyState&&t.status>=200&&t.status<=299){this._status=f.LoaderStatus.kBuffering;var a=t.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(e){this._status=f.LoaderStatus.kError;var t=f.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type};if(!this._onError)throw new c.RuntimeException(n.msg);this._onError(t,n)}},{key:"_msrOnProgress",value:function(e){var t=e.target,n=t.result;if(null==n)return void this._doReconnectIfNeeded();var r=n.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=n.byteLength;var i=this._totalRange.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,i,this._receivedLength),n.byteLength>=this._bufferLimit&&(_.default.v(this.TAG,"MSStream buffer exceeded max size near "+(i+r.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var e={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,e,!0)}}},{key:"_msrOnLoad",value:function(e){this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(e){this._status=f.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&this._receivedLength<this._contentLength?(t=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:"MSStream meet Early-Eof"}):(t=f.LoaderErrors.EARLY_EOF,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new c.RuntimeException(n.msg);this._onError(t,n)}}]),t}(f.BaseLoader);n.default=h},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=e("../utils/logger.js"),f=r(_),c=e("./speed-sampler.js"),h=r(c),d=e("./loader.js"),m=e("../utils/exception.js"),p=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-range-loader"));return r.TAG="RangeLoader",r._seekHandler=e,r._config=n,r._needStash=!1,r._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],r._currentChunkSizeKB=384,r._currentSpeedNormalized=0,r._zeroSpeedChunkCount=0,r._xhr=null,r._speedSampler=new h.default,r._requestAbort=!1,r._waitForTotalLength=!1,r._totalLengthReceived=!1,r._currentRequestURL=null,r._currentRedirectedURL=null,r._currentRequestRange=null,r._totalLength=null,r._contentLength=null,r._receivedLength=0,r._lastTimeLoaded=0,r}return s(t,e),u(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return f.default.w("RangeLoader",e.message),!1}}}]),u(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=d.LoaderStatus.kConnecting;var n=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(n=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||n?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,n=t+e;null!=this._contentLength&&n-this._range.from>=this._contentLength&&(n=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:n},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var n=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?n=this._currentRedirectedURL:void 0!=e.redirectedURL&&(n=e.redirectedURL));var r=this._seekHandler.getConfig(n,t);this._currentRequestURL=r.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",r.url,!0),i.responseType="arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),e.withCredentials&&(i.withCredentials=!0),"object"===o(r.headers)){var a=r.headers;for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s])}if("object"===o(this._config.headers)){var l=this._config.headers;for(var u in l)l.hasOwnProperty(u)&&i.setRequestHeader(u,l[u])}i.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL){var n=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else{if(this._status=d.LoaderStatus.kError,!this._onError)throw new m.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==d.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var n=e.total;this._internalAbort(),null!=n&0!==n&&(this._totalLength=n)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var r=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(r)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,n=t.length-1,r=0,i=0,a=n;if(e<t[0])return t[0];for(;i<=a;){if((r=i+Math.floor((a-i)/2))===n||e>=t[r]&&e<t[r+1])return t[r];t[r]<e?i=r+1:a=r-1}}},{key:"_onLoad",value:function(e){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength)return void(this._waitForTotalLength=!1);this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&++this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps),0!==t){var n=this._normalizeSpeed(t);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var r=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(r,i,this._receivedLength),a&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=d.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=d.LoaderErrors.EARLY_EOF,n={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=d.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new m.RuntimeException(n.msg);this._onError(t,n)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),t}(d.BaseLoader);n.default=p},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}
}(),o=e("events"),l=r(o),u=e("../utils/logger.js"),_=r(u),f=e("../utils/browser.js"),c=r(f),h=e("./player-events.js"),d=r(h),m=e("../core/transmuxer.js"),p=r(m),v=e("../core/transmuxing-events.js"),b=r(v),g=e("../core/mse-controller.js"),y=r(g),S=e("../core/mse-events.js"),k=r(S),E=e("./player-errors.js"),w=e("../config.js"),R=e("../utils/exception.js"),A=function(){function e(t,n){if(i(this,e),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new l.default,this._config=(0,w.createDefaultConfig)(),"object"===(void 0===n?"undefined":a(n))&&Object.assign(this._config,n),"flv"!==t.type.toLowerCase())throw new R.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===t.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=t,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=c.default.chrome&&(c.default.version.major<50||50===c.default.version.major&&c.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||c.default.msedge||c.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1),this.callbackStreamTime=null,this._mediaSourceEndCallback=null}return s(e,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null,this.callbackStreamTime=null,this._mediaSourceEndCallback=null}},{key:"on",value:function(e,t){var n=this;e===d.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){n._emitter.emit(d.default.MEDIA_INFO,n.mediaInfo)}):e===d.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){n._emitter.emit(d.default.STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),this._msectl=new y.default(this._config),this._msectl.on(k.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(k.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(k.default.SOURCE_OPEN,function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on(k.default.ERROR,function(e){t._emitter.emit(d.default.ERROR,E.ErrorTypes.MEDIA_ERROR,E.ErrorDetails.MEDIA_MSE_ERROR,e)}),this._msectl.on(k.default.SOURCE_END,function(e){null!=t._mediaSourceEndCallback&&t._mediaSourceEndCallback(e)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var e=this;if(!this._mediaElement)throw new R.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new R.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened)return void(this._hasPendingLoad=!0);this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new p.default(this._mediaDataSource,this._config),this._transmuxer.on(b.default.INIT_SEGMENT,function(t,n){e._msectl.appendInitSegment(n)}),this._transmuxer.on(b.default.MEDIA_SEGMENT,function(t,n){if(e._msectl.appendMediaSegment(n),e._config.lazyLoad&&!e._config.isLive){var r=e._mediaElement.currentTime;n.info.endDts>=1e3*(r+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(_.default.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}}),this._transmuxer.on(b.default.LOADING_COMPLETE,function(){e._msectl.endOfStream(),e._emitter.emit(d.default.LOADING_COMPLETE)}),this._transmuxer.on(b.default.RECOVERED_EARLY_EOF,function(){e._emitter.emit(d.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(b.default.IO_ERROR,function(t,n){e._emitter.emit(d.default.ERROR,E.ErrorTypes.NETWORK_ERROR,t,n)}),this._transmuxer.on(b.default.DEMUX_ERROR,function(t,n){e._emitter.emit(d.default.ERROR,E.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:n})}),this._transmuxer.on(b.default.MEDIA_INFO,function(t){e._mediaInfo=t,e._emitter.emit(d.default.MEDIA_INFO,Object.assign({},t))}),this._transmuxer.on(b.default.METADATA_ARRIVED,function(t){e._emitter.emit(d.default.METADATA_ARRIVED,t)}),this._transmuxer.on(b.default.SCRIPTDATA_ARRIVED,function(t){e._emitter.emit(d.default.SCRIPTDATA_ARRIVED,t)}),this._transmuxer.on(b.default.STATISTICS_INFO,function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(d.default.STATISTICS_INFO,Object.assign({},e._statisticsInfo))}),this._transmuxer.on(b.default.RECOMMEND_SEEKPOINT,function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)}),this._transmuxer.on(b.default.STREAM_TIME,function(t){e._receiveStreamTime(t)}),this._transmuxer.open()}}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();n=i.totalVideoFrames,r=i.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=r),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,n=0,r=0;r<e.length;r++){var i=e.start(r),a=e.end(r);if(i<=t&&t<a){i,n=a;break}}n>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(_.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){_.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,n=!1,r=0;r<t.length;r++){var i=t.start(r),a=t.end(r);if(e>=i&&e<a){e>=a-this._config.lazyLoadRecoverDuration&&(n=!0);break}}n&&(window.clearInterval(this._progressChecker),this._progressChecker=null,n&&(_.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,n=0;n<t.length;n++){var r=t.start(n),i=t.end(n);if(e>=r&&e<i)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),n=!1,r=0;if(e<1&&this._mediaElement.buffered.length>0){var i=this._mediaElement.buffered.start(0);(i<1&&e<i||c.default.safari)&&(n=!0,r=c.default.safari?.1:i)}if(n)this._requestSetTime=!0,this._mediaElement.currentTime=r;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var n=t.buffered;n.length>0&&t.currentTime<n.start(0)&&(_.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+n.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=n.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,n=this._mediaElement.buffered;if(this._requestSetTime)return void(this._requestSetTime=!1);if(t<1&&n.length>0){var r=n.start(0);if(r<1&&t<r||c.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=c.default.safari?.1:r)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var i=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=i&&(this._requestSetTime=!0,this._mediaElement.currentTime=i.dts/1e3)}return void(null!=this._progressChecker&&this._checkProgressAndResume())}this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"setMediaSourceEndCallback",value:function(e){this._mediaSourceEndCallback=e}},{key:"setStreamTimeCallback",value:function(e){this.callbackStreamTime=e}},{key:"_receiveStreamTime",value:function(e){null!=this.callbackStreamTime&&this.callbackStreamTime(e)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),e}();n.default=A},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("events"),l=r(o),u=e("./player-events.js"),_=r(u),f=e("../config.js"),c=e("../utils/exception.js"),h=function(){function e(t,n){if(i(this,e),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new l.default,this._config=(0,f.createDefaultConfig)(),"object"===(void 0===n?"undefined":a(n))&&Object.assign(this._config,n),"flv"===t.type.toLowerCase())throw new c.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(t.hasOwnProperty("segments"))throw new c.InvalidArgumentException("NativePlayer("+t.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=t,this._mediaElement=null}return s(e,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var n=this;e===_.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){n._emitter.emit(_.default.MEDIA_INFO,n.mediaInfo)}):e===_.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){n._emitter.emit(_.default.STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new c.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(_.default.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(_.default.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){var e=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",t={mimeType:e+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,r=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();n=i.totalVideoFrames,r=i.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,r=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=r),e}}]),e}();n.default=h},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorDetails=n.ErrorTypes=void 0;var r=e("../io/loader.js"),i=e("../demux/demux-errors.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(i);n.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},n.ErrorDetails={NETWORK_EXCEPTION:r.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:r.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:r.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:r.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};n.default=r},{}],36:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();n.default=a},{}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=e.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,n=null,r=Array.prototype.slice.call(arguments,1),i=r.length,a=0;a<i;a++)t+=r[a].byteLength;n=new Uint8Array(t),n[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var s=8,o=0;o<i;o++)n.set(r[o],s),s+=r[o].byteLength;return n}},{key:"generateInitSegment",value:function(t){var n=e.box(e.types.ftyp,e.constants.FTYP),r=e.moov(t),i=new Uint8Array(n.byteLength+r.byteLength);return i.set(n,0),i.set(r,n.byteLength),i}},{key:"moov",value:function(t){var n=e.mvhd(t.timescale,t.duration),r=e.trak(t),i=e.mvex(t);return e.box(e.types.moov,n,r,i)}},{key:"mvhd",value:function(t,n){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration,i=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var n=t.timescale,r=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r,85,196,0,0]))}},{key:"hdlr",value:function(t){var n=null;return n="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,n)}},{key:"minf",value:function(t){var n=null;return n="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,n,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var n=t.channelCount,r=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types[".mp3"],i)}},{key:"mp4a",value:function(t){var n=t.channelCount,r=t.audioSampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return e.box(e.types.mp4a,i,e.esds(t))}},{key:"esds",value:function(t){var n=t.config||[],r=n.length,i=new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(n).concat([6,1,2]));return e.box(e.types.esds,i)}},{key:"avc1",value:function(t){var n=t.avcc,r=t.codecWidth,i=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,n))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var n=t.id,r=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,r)}},{key:"moof",value:function(t,n){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,n))}},{key:"mfhd",value:function(t){var n=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,n)}},{key:"traf",value:function(t,n){var r=t.id,i=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),s=e.sdtp(t),o=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,i,a,o,s)}},{key:"sdtp",value:function(t){for(var n=t.samples||[],r=n.length,i=new Uint8Array(4+r),a=0;a<r;a++){var s=n[a].flags;i[a+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,i)}},{key:"trun",value:function(t,n){var r=t.samples||[],i=r.length,a=12+16*i,s=new Uint8Array(a);n+=8+a,s.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var o=0;o<i;o++){var l=r[o].duration,u=r[o].size,_=r[o].flags,f=r[o].cts;s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,_.isLeading<<2|_.dependsOn,_.isDependedOn<<6|_.hasRedundancy<<4|_.isNonSync,0,0,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,s)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();a.init(),n.default=a},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/logger.js"),o=r(s),l=e("./mp4-generator.js"),u=r(l),_=e("./aac-silent.js"),f=r(_),c=e("../utils/browser.js"),h=r(c),d=e("../core/media-segment-info.js"),m=e("../utils/exception.js"),p=function(){function e(t){i(this,e),this.TAG="MP4Remuxer",this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new d.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new d.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!h.default.chrome||!(h.default.version.major<50||50===h.default.version.major&&h.default.version.build<2661)),this._fillSilentAfterSeek=h.default.msedge||h.default.msie,this._mp3UseMpegAudio=!h.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return a(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new m.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var n=null,r="mp4",i=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(r="mpeg",i="",n=new Uint8Array):n=u.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,n=u.default.generateInitSegment(t)}if(!this._onInitSegment)throw new m.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:n.buffer,codec:i,container:e+"/"+r,mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,n={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(n.samples.push(e),n.length=e.length);var r={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(r.samples.push(t),r.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(n,!0),this._remuxAudio(r,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var n=e,r=n.samples,i=void 0,a=-1,s=-1,l=this._audioMeta.refSampleDuration,_="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,c=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(r&&0!==r.length&&(1!==r.length||t)){var p=0,v=null,b=0;_?(p=0,b=n.length):(p=8,b=8+n.length);var g=null;if(r.length>1&&(g=r.pop(),b-=g.length),null!=this._audioStashedLastSample){
var y=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(y),b+=y.length}null!=g&&(this._audioStashedLastSample=g);var S=r[0].dts-this._dtsBase;if(this._audioNextDts)i=S-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())i=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var k=this._audioSegmentInfoList.getLastSampleBefore(S);if(null!=k){var E=S-(k.originalDts+k.duration);E<=3&&(E=0);var w=k.dts+k.duration+E;i=S-w}else i=0}if(m){var R=S-i,A=this._videoSegmentInfoList.getLastSegmentBefore(S);if(null!=A&&A.beginDts<R){var T=f.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(T){var M=A.beginDts,L=R-A.beginDts;o.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+M+", duration: "+L),r.unshift({unit:T,dts:M,pts:M}),b+=T.byteLength}}else m=!1}for(var x=[],B=0;B<r.length;B++){var O=r[B],C=O.unit,I=O.dts-this._dtsBase,P=I,D=!1,j=null,N=0;if(!(I<-.001)){if("mp3"!==this._audioMeta.codec){var U=I;if(this._audioNextDts&&(U=this._audioNextDts),(i=I-U)<=-3*l)continue;if(i>=3*l&&this._fillAudioTimestampGap&&!h.default.safari){D=!0;var F=Math.floor(i/l);o.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+I+" ms, curRefDts: "+U+" ms, dtsCorrection: "+Math.round(i)+" ms, generate: "+F+" frames"),P=Math.floor(U),N=Math.floor(U+l)-P;var V=f.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==V&&(o.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),V=C),j=[];for(var H=0;H<F;H++){U+=l;var G=Math.floor(U),z=Math.floor(U+l)-G,q={dts:G,pts:G,cts:0,unit:V,size:V.byteLength,duration:z,originalDts:I,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};j.push(q),b+=q.size}this._audioNextDts=U+l}else P=Math.floor(U),N=Math.floor(U+l)-P,this._audioNextDts=U+l}else{if(P=I-i,B!==r.length-1){N=r[B+1].dts-this._dtsBase-i-P}else if(null!=g){var Y=g.dts-this._dtsBase-i;N=Y-P}else N=x.length>=1?x[x.length-1].duration:Math.floor(l);this._audioNextDts=P+N}-1===a&&(a=P),x.push({dts:P,pts:P,cts:0,unit:O.unit,size:O.unit.byteLength,duration:N,originalDts:I,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),D&&x.push.apply(x,j)}}if(0===x.length)return n.samples=[],void(n.length=0);_?v=new Uint8Array(b):(v=new Uint8Array(b),v[0]=b>>>24&255,v[1]=b>>>16&255,v[2]=b>>>8&255,v[3]=255&b,v.set(u.default.types.mdat,4));for(var X=0;X<x.length;X++){var K=x[X].unit;v.set(K,p),p+=K.byteLength}var W=x[x.length-1];s=W.dts+W.duration;var Z=new d.MediaSegmentInfo;Z.beginDts=a,Z.endDts=s,Z.beginPts=a,Z.endPts=s,Z.originalBeginDts=x[0].originalDts,Z.originalEndDts=W.originalDts+W.duration,Z.firstSample=new d.SampleInfo(x[0].dts,x[0].pts,x[0].duration,x[0].originalDts,!1),Z.lastSample=new d.SampleInfo(W.dts,W.pts,W.duration,W.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(Z),n.samples=x,n.sequenceNumber++;var Q=null;Q=_?new Uint8Array:u.default.moof(n,a),n.samples=[],n.length=0;var J={type:"audio",data:this._mergeBoxes(Q,v).buffer,sampleCount:x.length,info:Z};_&&c&&(J.timestampOffset=a),this._onMediaSegment("audio",J)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var n=e,r=n.samples,i=void 0,a=-1,s=-1,o=-1,l=-1;if(r&&0!==r.length&&(1!==r.length||t)){var _=8,f=null,c=8+e.length,h=null;if(r.length>1&&(h=r.pop(),c-=h.length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,r.unshift(m),c+=m.length}null!=h&&(this._videoStashedLastSample=h);var p=r[0].dts-this._dtsBase;if(this._videoNextDts)i=p-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())i=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=v){var b=p-(v.originalDts+v.duration);b<=3&&(b=0);var g=v.dts+v.duration+b;i=p-g}else i=0}for(var y=new d.MediaSegmentInfo,S=[],k=0;k<r.length;k++){var E=r[k],w=E.dts-this._dtsBase,R=E.isKeyframe,A=w-i,T=E.cts,M=A+T;-1===a&&(a=A,o=M);var L=0;if(k!==r.length-1){L=r[k+1].dts-this._dtsBase-i-A}else if(null!=h){var x=h.dts-this._dtsBase-i;L=x-A}else L=S.length>=1?S[S.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(R){var B=new d.SampleInfo(A,M,L,E.dts,!0);B.fileposition=E.fileposition,y.appendSyncPoint(B)}S.push({dts:A,pts:M,cts:T,units:E.units,size:E.length,isKeyframe:R,duration:L,originalDts:w,flags:{isLeading:0,dependsOn:R?2:1,isDependedOn:R?1:0,hasRedundancy:0,isNonSync:R?0:1}})}f=new Uint8Array(c),f[0]=c>>>24&255,f[1]=c>>>16&255,f[2]=c>>>8&255,f[3]=255&c,f.set(u.default.types.mdat,4);for(var O=0;O<S.length;O++)for(var C=S[O].units;C.length;){var I=C.shift(),P=I.data;f.set(P,_),_+=P.byteLength}var D=S[S.length-1];if(s=D.dts+D.duration,l=D.pts+D.duration,this._videoNextDts=s,y.beginDts=a,y.endDts=s,y.beginPts=o,y.endPts=l,y.originalBeginDts=S[0].originalDts,y.originalEndDts=D.originalDts+D.duration,y.firstSample=new d.SampleInfo(S[0].dts,S[0].pts,S[0].duration,S[0].originalDts,S[0].isKeyframe),y.lastSample=new d.SampleInfo(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(y),n.samples=S,n.sequenceNumber++,this._forceFirstIDR){var j=S[0].flags;j.dependsOn=2,j.isNonSync=0}var N=u.default.moof(n,a);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(N,f).buffer,sampleCount:S.length,info:y})}}}},{key:"_mergeBoxes",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}();n.default=p},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:n[0]||""},a={};if(i.browser){a[i.browser]=!0;var s=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},s.length>1&&(a.version.minor=parseInt(s[1],10)),s.length>2&&(a.version.build=parseInt(s[2],10))}i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a.msie=!0),a.edge&&(delete a.edge,i.browser="msedge",a.msedge=!0),a.opr&&(i.browser="opera",a.opera=!0),a.safari&&a.android&&(i.browser="android",a.android=!0),a.name=i.browser,a.platform=i.platform;for(var o in r)r.hasOwnProperty(o)&&delete r[o];Object.assign(r,a)}(),n.default=r},{}],40:[function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n.RuntimeException=function(){function e(t){a(this,e),this._message=t}return s(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}();n.IllegalStateException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"name",get:function(){return"IllegalStateException"}}]),t}(o),n.InvalidArgumentException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"name",get:function(){return"InvalidArgumentException"}}]),t}(o),n.NotImplementedException=function(e){function t(e){return a(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),s(t,[{key:"name",get:function(){return"NotImplementedException"}}]),t}(o)},{}],41:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("events"),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=function(){function e(){r(this,e)}return i(e,null,[{key:"e",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",r),e.ENABLE_ERROR&&(console.error?console.error(r):console.warn?console.warn(r):console.log(r))}},{key:"i",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",r),e.ENABLE_INFO&&(console.info?console.info(r):console.log(r))}},{key:"w",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",r),e.ENABLE_WARN&&(console.warn?console.warn(r):console.log(r))}},{key:"d",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",r),e.ENABLE_DEBUG&&(console.debug?console.debug(r):console.log(r))}},{key:"v",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var r="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",r),e.ENABLE_VERBOSE&&console.log(r)}}]),e}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new s.default,n.default=o},{events:2}],42:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("events"),o=r(s),l=e("./logger.js"),u=r(l),_=function(){function e(){i(this,e)}return a(e,null,[{key:"getConfig",value:function(){return{globalTag:u.default.GLOBAL_TAG,forceGlobalTag:u.default.FORCE_GLOBAL_TAG,enableVerbose:u.default.ENABLE_VERBOSE,enableDebug:u.default.ENABLE_DEBUG,enableInfo:u.default.ENABLE_INFO,enableWarn:u.default.ENABLE_WARN,enableError:u.default.ENABLE_ERROR,enableCallback:u.default.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){u.default.GLOBAL_TAG=e.globalTag,u.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,u.default.ENABLE_VERBOSE=e.enableVerbose,u.default.ENABLE_DEBUG=e.enableDebug,u.default.ENABLE_INFO=e.enableInfo,u.default.ENABLE_WARN=e.enableWarn,u.default.ENABLE_ERROR=e.enableError,u.default.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var t=e.emitter;if(t.listenerCount("change")>0){var n=e.getConfig();t.emit("change",n)}}},{key:"registerListener",value:function(t){e.emitter.addListener("change",t)}},{key:"removeListener",value:function(t){e.emitter.removeListener("change",t)}},{key:"addLogListener",value:function(t){u.default.emitter.addListener("log",t),u.default.emitter.listenerCount("log")>0&&(u.default.ENABLE_CALLBACK=!0,e._notifyChange())}},{key:"removeLogListener",value:function(t){u.default.emitter.removeListener("log",t),0===u.default.emitter.listenerCount("log")&&(u.default.ENABLE_CALLBACK=!1,e._notifyChange())}},{key:"forceGlobalTag",get:function(){return u.default.FORCE_GLOBAL_TAG},set:function(t){u.default.FORCE_GLOBAL_TAG=t,e._notifyChange()}},{key:"globalTag",get:function(){return u.default.GLOBAL_TAG},set:function(t){u.default.GLOBAL_TAG=t,e._notifyChange()}},{key:"enableAll",get:function(){return u.default.ENABLE_VERBOSE&&u.default.ENABLE_DEBUG&&u.default.ENABLE_INFO&&u.default.ENABLE_WARN&&u.default.ENABLE_ERROR},set:function(t){u.default.ENABLE_VERBOSE=t,u.default.ENABLE_DEBUG=t,u.default.ENABLE_INFO=t,u.default.ENABLE_WARN=t,u.default.ENABLE_ERROR=t,e._notifyChange()}},{key:"enableDebug",get:function(){return u.default.ENABLE_DEBUG},set:function(t){u.default.ENABLE_DEBUG=t,e._notifyChange()}},{key:"enableVerbose",get:function(){return u.default.ENABLE_VERBOSE},set:function(t){u.default.ENABLE_VERBOSE=t,e._notifyChange()}},{key:"enableInfo",get:function(){return u.default.ENABLE_INFO},set:function(t){u.default.ENABLE_INFO=t,e._notifyChange()}},{key:"enableWarn",get:function(){return u.default.ENABLE_WARN},set:function(t){u.default.ENABLE_WARN=t,e._notifyChange()}},{key:"enableError",get:function(){return u.default.ENABLE_ERROR},set:function(t){u.default.ENABLE_ERROR=t,e._notifyChange()}}]),e}();_.emitter=new o.default,n.default=_},{"./logger.js":41,events:2}],43:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function t(){r(this,t)}return i(t,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t},"function"!=typeof self.Promise&&e("es6-promise").polyfill()}}]),t}();a.install(),n.default=a},{"es6-promise":1}],44:[function(e,t,n){"use strict";function r(e,t,n){var r=e;if(t+n<r.length){for(;n--;)if(128!=(192&r[++t]))return!1;return!0}return!1}function i(e){for(var t=[],n=e,i=0,a=e.length;i<a;)if(n[i]<128)t.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(r(n,i,1)){var s=(31&n[i])<<6|63&n[i+1];if(s>=128){t.push(String.fromCharCode(65535&s)),i+=2;continue}}}else if(n[i]<240){if(r(n,i,2)){var o=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(o>=2048&&55296!=(63488&o)){t.push(String.fromCharCode(65535&o)),i+=3;continue}}}else if(n[i]<248&&r(n,i,3)){var l=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(l>65536&&l<1114112){l-=65536,t.push(String.fromCharCode(l>>>10|55296)),t.push(String.fromCharCode(1023&l|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}Object.defineProperty(n,"__esModule",{value:!0}),n.default=i},{}]},{},[21])(21)})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){!function(){"use strict";function e(){function t(e){return new Int8Array(e)}function n(e){return new Int16Array(e)}function r(e){return new Int32Array(e)}function i(e){return new Float32Array(e)}function a(e){return new Float64Array(e)}function s(e){if(1==e.length)return i(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(s(e));return n}function o(e){if(1==e.length)return r(e[0]);var t=e[0];e=e.slice(1);for(var n=[],i=0;i<t;i++)n.push(o(e));return n}function l(e){if(1==e.length)return n(e[0]);var t=e[0];e=e.slice(1);for(var r=[],i=0;i<t;i++)r.push(l(e));return r}function u(e){if(1==e.length)return new Array(e[0]);var t=e[0];e=e.slice(1);for(var n=[],r=0;r<t;r++)n.push(u(e));return n}function _(e){this.ordinal=e}function f(e){this.ordinal=e}function c(e){var t=e;this.ordinal=function(){return t}}function h(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}function d(){function e(e){this.bits=0|e}function t(e,t,n,r,i,a){var s=.5946/t;for(e>>=1;0!=e--;)i[a++]=s>n[r++]?0:1,i[a++]=s>n[r++]?0:1}function n(e,t,n,r,i,a){e>>=1;var s=e%2;for(e>>=1;0!=e--;){var o,l,u,_,f,c,h,d;o=n[r++]*t,l=n[r++]*t,f=0|o,u=n[r++]*t,c=0|l,_=n[r++]*t,h=0|u,o+=m.adj43[f],d=0|_,l+=m.adj43[c],i[a++]=0|o,u+=m.adj43[h],i[a++]=0|l,_+=m.adj43[d],i[a++]=0|u,i[a++]=0|_}if(0!=s){var o,l,f,c;o=n[r++]*t,l=n[r++]*t,f=0|o,c=0|l,o+=m.adj43[f],l+=m.adj43[c],i[a++]=0|o,i[a++]=0|l}}function i(e,r,i,a,s){var o,l,u,_=0,f=0,c=0,h=0,d=r,p=0,v=d,b=0,g=e,y=0;for(u=null!=s&&a.global_gain==s.global_gain,l=a.block_type==P.SHORT_TYPE?38:21,o=0;o<=l;o++){var S=-1;if((u||a.block_type==P.NORM_TYPE)&&(S=a.global_gain-(a.scalefac[o]+(0!=a.preflag?m.pretab[o]:0)<<a.scalefac_scale+1)-8*a.subblock_gain[a.window[o]]),u&&s.step[o]==S)0!=f&&(n(f,i,g,y,v,b),f=0),0!=c&&(t(c,i,g,y,v,b),c=0);else{var k=a.width[o];if(_+a.width[o]>a.max_nonzero_coeff){var E;E=a.max_nonzero_coeff-_+1,Z.fill(r,a.max_nonzero_coeff,576,0),k=E,k<0&&(k=0),o=l+1}if(0==f&&0==c&&(v=d,b=p,g=e,y=h),null!=s&&s.sfb_count1>0&&o>=s.sfb_count1&&s.step[o]>0&&S>=s.step[o]?(0!=f&&(n(f,i,g,y,v,b),f=0,v=d,b=p,g=e,y=h),c+=k):(0!=c&&(t(c,i,g,y,v,b),c=0,v=d,b=p,g=e,y=h),f+=k),k<=0){0!=c&&(t(c,i,g,y,v,b),c=0),0!=f&&(n(f,i,g,y,v,b),f=0);break}}o<=l&&(p+=a.width[o],h+=a.width[o],_+=a.width[o])}0!=f&&(n(f,i,g,y,v,b),f=0),0!=c&&(t(c,i,g,y,v,b),c=0)}function a(e,t,n){var r=0,i=0;do{var a=e[t++],s=e[t++];r<a&&(r=a),i<s&&(i=s)}while(t<n);return r<i&&(r=i),r}function s(e,t,n,r,i,a){var s,o=65536*ee.ht[r].xlen+ee.ht[i].xlen,l=0;do{var u=e[t++],_=e[t++];0!=u&&(u>14&&(u=15,l+=o),u*=16),0!=_&&(_>14&&(_=15,l+=o),u+=_),l+=ee.largetbl[u]}while(t<n);return s=65535&l,l>>=16,l>s&&(l=s,r=i),a.bits+=l,r}function o(e,t,n,r){var i=0,a=ee.ht[1].hlen;do{var s=2*e[t+0]+e[t+1];t+=2,i+=a[s]}while(t<n);return r.bits+=i,1}function l(e,t,n,r,i){var a,s,o=0,l=ee.ht[r].xlen;s=2==r?ee.table23:ee.table56;do{var u=e[t+0]*l+e[t+1];t+=2,o+=s[u]}while(t<n);return a=65535&o,o>>=16,o>a&&(o=a,r++),i.bits+=o,r}function u(e,t,n,r,i){var a=0,s=0,o=0,l=ee.ht[r].xlen,u=ee.ht[r].hlen,_=ee.ht[r+1].hlen,f=ee.ht[r+2].hlen;do{var c=e[t+0]*l+e[t+1];t+=2,a+=u[c],s+=_[c],o+=f[c]}while(t<n);var h=r;return a>s&&(a=s,h++),a>o&&(a=o,h=r+2),i.bits+=a,h}function _(e,t,n,r){var i=a(e,t,n);switch(i){case 0:return i;case 1:return o(e,t,n,r);case 2:case 3:return l(e,t,n,v[i-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return u(e,t,n,v[i-1],r);default:if(i>L.IXMAX_VAL)return r.bits=L.LARGE_BITS,-1;i-=15;var _;for(_=24;_<32&&!(ee.ht[_].linmax>=i);_++);var f;for(f=_-8;f<24&&!(ee.ht[f].linmax>=i);f++);return s(e,t,n,f,_,r)}}function f(t,n,r,i,a,s,o){for(var l=n.big_values,u=0;u<=22;u++)i[u]=L.LARGE_BITS;for(var u=0;u<16;u++){var f=t.scalefac_band.l[u+1];if(f>=l)break;var c=0,h=new e(c),d=_(r,0,f,h);c=h.bits;for(var m=0;m<8;m++){var p=t.scalefac_band.l[u+m+2];if(p>=l)break;var v=c;h=new e(v);var b=_(r,f,p,h);v=h.bits,i[u+m]>v&&(i[u+m]=v,a[u+m]=u,s[u+m]=d,o[u+m]=b)}}}function c(t,n,r,i,a,s,o,l){for(var u=n.big_values,f=2;f<P.SBMAX_l+1;f++){var c=t.scalefac_band.l[f];if(c>=u)break;var h=a[f-2]+n.count1bits;if(r.part2_3_length<=h)break;var d=new e(h),m=_(i,c,u,d);h=d.bits,r.part2_3_length<=h||(r.assign(n),r.part2_3_length=h,r.region0_count=s[f-2],r.region1_count=f-2-s[f-2],r.table_select[0]=o[f-2],r.table_select[1]=l[f-2],r.table_select[2]=m)}}function h(e,t){for(var n,r=t.tt[1][e],i=t.tt[0][e],a=0;a<ee.scfsi_band.length-1;a++){for(n=ee.scfsi_band[a];n<ee.scfsi_band[a+1]&&!(i.scalefac[n]!=r.scalefac[n]&&r.scalefac[n]>=0);n++);if(n==ee.scfsi_band[a+1]){for(n=ee.scfsi_band[a];n<ee.scfsi_band[a+1];n++)r.scalefac[n]=-1;t.scfsi[e][a]=1}}var s=0,o=0;for(n=0;n<11;n++)-1!=r.scalefac[n]&&(o++,s<r.scalefac[n]&&(s=r.scalefac[n]));for(var l=0,u=0;n<P.SBPSY_l;n++)-1!=r.scalefac[n]&&(u++,l<r.scalefac[n]&&(l=r.scalefac[n]));for(var a=0;a<16;a++)if(s<b[a]&&l<g[a]){var _=y[a]*o+S[a]*u;r.part2_length>_&&(r.part2_length=_,r.scalefac_compress=a)}}var m=null;this.qupvt=null,this.setModules=function(e){this.qupvt=e,m=e};var p=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],v=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(t,n,r){var i=n.l3_enc,a=Math.min(576,n.max_nonzero_coeff+2>>1<<1);for(null!=r&&(r.sfb_count1=0);a>1&&0==(i[a-1]|i[a-2]);a-=2);n.count1=a;for(var s=0,o=0;a>3;a-=4){var l;if((2147483647&(i[a-1]|i[a-2]|i[a-3]|i[a-4]))>1)break;l=2*(2*(2*i[a-4]+i[a-3])+i[a-2])+i[a-1],s+=ee.t32l[l],o+=ee.t33l[l]}var u=s;if(n.count1table_select=0,s>o&&(u=o,n.count1table_select=1),n.count1bits=u,n.big_values=a,0==a)return u;if(n.block_type==P.SHORT_TYPE)s=3*t.scalefac_band.s[3],s>n.big_values&&(s=n.big_values),o=n.big_values;else if(n.block_type==P.NORM_TYPE){if(s=n.region0_count=t.bv_scf[a-2],o=n.region1_count=t.bv_scf[a-1],o=t.scalefac_band.l[s+o+2],s=t.scalefac_band.l[s+1],o<a){var f=new e(u);n.table_select[2]=_(i,o,a,f),u=f.bits}}else n.region0_count=7,n.region1_count=P.SBMAX_l-1-7-1,s=t.scalefac_band.l[8],o=a,s>o&&(s=o);if(s=Math.min(s,a),o=Math.min(o,a),0<s){var f=new e(u);n.table_select[0]=_(i,0,s,f),u=f.bits}if(s<o){var f=new e(u);n.table_select[1]=_(i,s,o,f),u=f.bits}if(2==t.use_best_huffman&&(n.part2_3_length=u,best_huffman_divide(t,n),u=n.part2_3_length),null!=r&&n.block_type==P.NORM_TYPE){for(var c=0;t.scalefac_band.l[c]<n.big_values;)c++;r.sfb_count1=c}return u},this.count_bits=function(e,t,n,r){var a=n.l3_enc,s=L.IXMAX_VAL/m.IPOW20(n.global_gain);if(n.xrpow_max>s)return L.LARGE_BITS;if(i(t,a,m.IPOW20(n.global_gain),n,r),0!=(2&e.substep_shaping))for(var o=0,l=n.global_gain+n.scalefac_scale,u=.634521682242439/m.IPOW20(l),_=0;_<n.sfbmax;_++){var f=n.width[_];if(0==e.pseudohalf[_])o+=f;else{var c;for(c=o,o+=f;c<o;++c)a[c]=t[c]>=u?a[c]:0}}return this.noquant_count_bits(e,n,r)},this.best_huffman_divide=function(t,n){var i=new B,a=n.l3_enc,s=r(23),o=r(23),l=r(23),u=r(23);if(n.block_type!=P.SHORT_TYPE||1!=t.mode_gr){i.assign(n),n.block_type==P.NORM_TYPE&&(f(t,n,a,s,o,l,u),c(t,i,n,a,s,o,l,u));var h=i.big_values;if(!(0==h||(a[h-2]|a[h-1])>1||(h=n.count1+2)>576)){i.assign(n),i.count1=h;for(var d=0,m=0;h>i.big_values;h-=4){var p=2*(2*(2*a[h-4]+a[h-3])+a[h-2])+a[h-1];d+=ee.t32l[p],m+=ee.t33l[p]}if(i.big_values=h,i.count1table_select=0,d>m&&(d=m,i.count1table_select=1),i.count1bits=d,i.block_type==P.NORM_TYPE)c(t,i,n,a,s,o,l,u);else{if(i.part2_3_length=d,d=t.scalefac_band.l[8],d>h&&(d=h),d>0){var v=new e(i.part2_3_length);i.table_select[0]=_(a,0,d,v),i.part2_3_length=v.bits}if(h>d){var v=new e(i.part2_3_length);i.table_select[1]=_(a,d,h,v),i.part2_3_length=v.bits}n.part2_3_length>i.part2_3_length&&n.assign(i)}}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],g=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],y=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],S=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];d.slen1_tab=y,d.slen2_tab=S,this.best_scalefac_store=function(e,t,n,r){var i,a,s,o,l=r.tt[t][n],u=0;for(s=0,i=0;i<l.sfbmax;i++){var _=l.width[i];for(s+=_,o=-_;o<0&&0==l.l3_enc[o+s];o++);0==o&&(l.scalefac[i]=u=-2)}if(0==l.scalefac_scale&&0==l.preflag){var f=0;for(i=0;i<l.sfbmax;i++)l.scalefac[i]>0&&(f|=l.scalefac[i]);if(0==(1&f)&&0!=f){for(i=0;i<l.sfbmax;i++)l.scalefac[i]>0&&(l.scalefac[i]>>=1);l.scalefac_scale=u=1}}if(0==l.preflag&&l.block_type!=P.SHORT_TYPE&&2==e.mode_gr){for(i=11;i<P.SBPSY_l&&!(l.scalefac[i]<m.pretab[i]&&-2!=l.scalefac[i]);i++);if(i==P.SBPSY_l){for(i=11;i<P.SBPSY_l;i++)l.scalefac[i]>0&&(l.scalefac[i]-=m.pretab[i]);l.preflag=u=1}}for(a=0;a<4;a++)r.scfsi[n][a]=0;for(2==e.mode_gr&&1==t&&r.tt[0][n].block_type!=P.SHORT_TYPE&&r.tt[1][n].block_type!=P.SHORT_TYPE&&(h(n,r),u=0),i=0;i<l.sfbmax;i++)-2==l.scalefac[i]&&(l.scalefac[i]=0);0!=u&&(2==e.mode_gr?this.scale_bitcount(l):this.scale_bitcount_lsf(e,l))};var k=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],E=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],w=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,n,r,i=0,a=0,s=e.scalefac;if(e.block_type==P.SHORT_TYPE)r=k,0!=e.mixed_block_flag&&(r=E);else if(r=w,0==e.preflag){for(n=11;n<P.SBPSY_l&&!(s[n]<m.pretab[n]);n++);if(n==P.SBPSY_l)for(e.preflag=1,n=11;n<P.SBPSY_l;n++)s[n]-=m.pretab[n]}for(n=0;n<e.sfbdivide;n++)i<s[n]&&(i=s[n]);for(;n<e.sfbmax;n++)a<s[n]&&(a=s[n]);for(e.part2_length=L.LARGE_BITS,t=0;t<16;t++)i<b[t]&&a<g[t]&&e.part2_length>r[t]&&(e.part2_length=r[t],e.scalefac_compress=t);return e.part2_length==L.LARGE_BITS};var R=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,t){var n,i,a,s,o,l,u,_,f=r(4),c=t.scalefac;for(n=0!=t.preflag?2:0,u=0;u<4;u++)f[u]=0;if(t.block_type==P.SHORT_TYPE){i=1;var h=m.nr_of_sfb_block[n][i];for(_=0,a=0;a<4;a++)for(s=h[a]/3,u=0;u<s;u++,_++)for(o=0;o<3;o++)c[3*_+o]>f[a]&&(f[a]=c[3*_+o])}else{i=0;var h=m.nr_of_sfb_block[n][i];for(_=0,a=0;a<4;a++)for(s=h[a],u=0;u<s;u++,_++)c[_]>f[a]&&(f[a]=c[_])}for(l=!1,a=0;a<4;a++)f[a]>R[n][a]&&(l=!0);if(!l){var d,p,v,b;for(t.sfb_partition_table=m.nr_of_sfb_block[n][i],a=0;a<4;a++)t.slen[a]=A[f[a]];switch(d=t.slen[0],p=t.slen[1],v=t.slen[2],b=t.slen[3],n){case 0:t.scalefac_compress=(5*d+p<<4)+(v<<2)+b;break;case 1:t.scalefac_compress=400+(5*d+p<<2)+v;break;case 2:t.scalefac_compress=500+3*d+p;break;default:Q.err.printf("intensity stereo not implemented yet\n")}}if(!l)for(t.part2_length=0,a=0;a<4;a++)t.part2_length+=t.slen[a]*t.sfb_partition_table[a];return l};var A=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var n,r=0;e.scalefac_band.l[++r]<t;);for(n=p[r][0];e.scalefac_band.l[n+1]>t;)n--;for(n<0&&(n=p[r][0]),e.bv_scf[t-2]=n,n=p[r][1];e.scalefac_band.l[n+e.bv_scf[t-2]+2]>t;)n--;n<0&&(n=p[r][1]),e.bv_scf[t-1]=n}}}function m(){}function p(){function e(e,t,n,r,i,a,s,o,l,u,_,f,c,h,d){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=n,this.expY=r,this.st_lrm=i,this.st_s=a,this.masking_adj=s,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=u,this.ath_sensitivity=_,this.interch=f,this.safejoint=c,this.sfb21mod=h,this.msfix=d}function t(e,t,n,r,i,a,s,o,l,u,_,f,c,h){this.quant_comp=t,this.quant_comp_s=n,this.safejoint=r,this.nsmsfix=i,this.st_lrm=a,this.st_s=s,this.nsbass=o,this.scale=l,this.masking_adj=u,this.ath_lower=_,this.ath_curve=f,this.interch=c,this.sfscale=h}function n(e,t,n){var r=e.VBR==f.vbr_rh?s:o,a=e.VBR_q_frac,l=r[t],u=r[t+1],_=l;l.st_lrm=l.st_lrm+a*(u.st_lrm-l.st_lrm),l.st_s=l.st_s+a*(u.st_s-l.st_s),l.masking_adj=l.masking_adj+a*(u.masking_adj-l.masking_adj),l.masking_adj_short=l.masking_adj_short+a*(u.masking_adj_short-l.masking_adj_short),l.ath_lower=l.ath_lower+a*(u.ath_lower-l.ath_lower),l.ath_curve=l.ath_curve+a*(u.ath_curve-l.ath_curve),l.ath_sensitivity=l.ath_sensitivity+a*(u.ath_sensitivity-l.ath_sensitivity),l.interch=l.interch+a*(u.interch-l.interch),l.msfix=l.msfix+a*(u.msfix-l.msfix),i(e,_.vbr_q),0!=n?e.quant_comp=_.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=_.quant_comp),0!=n?e.quant_comp_short=_.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=_.quant_comp_s),0!=_.expY&&(e.experimentalY=0!=_.expY),0!=n?e.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=_.st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=_.st_s),0!=n?e.maskingadjust=_.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=_.masking_adj),0!=n?e.maskingadjust_short=_.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=_.masking_adj_short),0!=n?e.ATHlower=-_.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-_.ath_lower/10),0!=n?e.ATHcurve=_.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=_.ath_curve),0!=n?e.athaa_sensitivity=_.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(0!=n?e.interChRatio=_.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=_.interch)),_.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|_.sfb21mod<<20),0!=n?e.msfix=_.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=_.msfix),0==n&&(e.VBR_q=t,e.VBR_q_frac=a)}function r(e,t,n){var r=t,i=a.nearestBitrateFullIndex(t);if(e.VBR=f.vbr_abr,e.VBR_mean_bitrate_kbps=r,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),l[i].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),l[i].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(l[i].nsbass)>0){var s=int(4*l[i].nsbass);s<0&&(s+=64),e.exp_nspsytune=e.exp_nspsytune|s<<2}return 0!=n?e.quant_comp=l[i].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=l[i].quant_comp),0!=n?e.quant_comp_short=l[i].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=l[i].quant_comp_s),0!=n?e.msfix=l[i].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=l[i].nsmsfix),0!=n?e.internal_flags.nsPsy.attackthre=l[i].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=l[i].st_lrm),0!=n?e.internal_flags.nsPsy.attackthre_s=l[i].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=l[i].st_s),0!=n?e.scale=l[i].scale:Math.abs(e.scale- -1)>0||(e.scale=l[i].scale),0!=n?e.maskingadjust=l[i].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=l[i].masking_adj),l[i].masking_adj>0?0!=n?e.maskingadjust_short=.9*l[i].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*l[i].masking_adj):0!=n?e.maskingadjust_short=1.1*l[i].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*l[i].masking_adj),0!=n?e.ATHlower=-l[i].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-l[i].ath_lower/10),0!=n?e.ATHcurve=l[i].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=l[i].ath_curve),0!=n?e.interChRatio=l[i].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=l[i].interch),t}function i(e,t){var n=0;return 0>t&&(n=-1,t=0),9<t&&(n=-1,t=9),e.VBR_q=t,e.VBR_q_frac=0,n}var a;this.setModules=function(e){a=e}
;var s=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],o=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],l=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,t,i){switch(t){case G.R3MIX:t=G.V3,e.VBR=f.vbr_mtrh;break;case G.MEDIUM:t=G.V4,e.VBR=f.vbr_rh;break;case G.MEDIUM_FAST:t=G.V4,e.VBR=f.vbr_mtrh;break;case G.STANDARD:t=G.V2,e.VBR=f.vbr_rh;break;case G.STANDARD_FAST:t=G.V2,e.VBR=f.vbr_mtrh;break;case G.EXTREME:t=G.V0,e.VBR=f.vbr_rh;break;case G.EXTREME_FAST:t=G.V0,e.VBR=f.vbr_mtrh;break;case G.INSANE:return t=320,e.preset=t,r(e,t,i),e.VBR=f.vbr_off,t}switch(e.preset=t,t){case G.V9:return n(e,9,i),t;case G.V8:return n(e,8,i),t;case G.V7:return n(e,7,i),t;case G.V6:return n(e,6,i),t;case G.V5:return n(e,5,i),t;case G.V4:return n(e,4,i),t;case G.V3:return n(e,3,i),t;case G.V2:return n(e,2,i),t;case G.V1:return n(e,1,i),t;case G.V0:return n(e,0,i),t}return 8<=t&&t<=320?r(e,t,i):(e.preset=0,t)}}function v(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,n){var r,i=t.internal_flags,a=i.l3_side,s=e.getframebits(t);n.bits=(s-8*i.sideinfo_len)/i.mode_gr;var o=2048*i.mode_gr-8;t.brate>320?r=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(r=11520,t.strict_ISO&&(r=8*int(32e4/(t.out_samplerate/1152)/8+.5))),i.ResvMax=r-s,i.ResvMax>o&&(i.ResvMax=o),(i.ResvMax<0||t.disable_reservoir)&&(i.ResvMax=0);var l=n.bits*i.mode_gr+Math.min(i.ResvSize,i.ResvMax);return l>r&&(l=r),a.resvDrain_pre=0,null!=i.pinfo&&(i.pinfo.mean_bits=n.bits/2,i.pinfo.resvsize=i.ResvSize),l},this.ResvMaxBits=function(e,t,n,r){var i,a=e.internal_flags,s=a.ResvSize,o=a.ResvMax;0!=r&&(s+=t),0!=(1&a.substep_shaping)&&(o*=.9),n.bits=t,10*s>9*o?(i=s-9*o/10,n.bits+=i,a.substep_shaping|=128):(i=0,a.substep_shaping&=127,e.disable_reservoir||0!=(1&a.substep_shaping)||(n.bits-=.1*t));var l=s<6*a.ResvMax/10?s:6*a.ResvMax/10;return l-=i,l<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var n,r=e.l3_side;e.ResvSize+=t*e.mode_gr;var i=0;r.resvDrain_post=0,r.resvDrain_pre=0,0!=(n=e.ResvSize%8)&&(i+=n),(n=e.ResvSize-i-e.ResvMax)>0&&(i+=n);var a=Math.min(8*r.main_data_begin,i)/8;r.resvDrain_pre+=8*a,i-=8*a,e.ResvSize-=8*a,r.main_data_begin-=a,r.resvDrain_post+=i,e.ResvSize-=i}}function b(){function e(e,t){return t=t>>8^i[255&(t^e)]}var t,n,r;this.setModules=function(e,i,a){t=e,n=i,r=a};var i=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.updateMusicCRC=function(t,n,r,i){for(var a=0;a<i;++a)t[0]=e(n[r+a],t[0])}}function g(){function e(e){Q.arraycopy(e.header[e.w_ptr].buf,0,R,T,e.sideinfo_len),T+=e.sideinfo_len,A+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&F.MAX_HEADER_BUF-1}function n(t,n,r){for(;r>0;){var i;0==M&&(M=8,T++,t.header[t.w_ptr].write_timing==A&&e(t),R[T]=0),i=Math.min(r,M),r-=i,M-=i,R[T]|=n>>r<<M,A+=i}}function i(e,t,n){for(;n>0;){var r;0==M&&(M=8,T++,R[T]=0),r=Math.min(n,M),n-=r,M-=r,R[T]|=t>>n<<M,A+=r}}function a(e,t){var r,i=e.internal_flags;if(t>=8&&(n(i,76,8),t-=8),t>=8&&(n(i,65,8),t-=8),t>=8&&(n(i,77,8),t-=8),t>=8&&(n(i,69,8),t-=8),t>=32){var a=E.getLameShortVersion();if(t>=32)for(r=0;r<a.length&&t>=8;++r)t-=8,n(i,a.charCodeAt(r),8)}for(;t>=1;t-=1)n(i,i.ancillary_flag,1),i.ancillary_flag^=e.disable_reservoir?0:1}function o(e,t,n){for(var r=e.header[e.h_ptr].ptr;n>0;){var i=Math.min(n,8-(7&r));n-=i,e.header[e.h_ptr].buf[r>>3]|=t>>n<<8-(7&r)-i,r+=i}e.header[e.h_ptr].ptr=r}function l(e,t){e<<=8;for(var n=0;n<8;n++)e<<=1,0!=(65536&((t<<=1)^e))&&(t^=y);return t}function u(e,t){var n,r,i,a=e.internal_flags;if(n=a.l3_side,a.header[a.h_ptr].ptr=0,Z.fill(a.header[a.h_ptr].buf,0,a.sideinfo_len,0),e.out_samplerate<16e3?o(a,4094,12):o(a,4095,12),o(a,e.version,1),o(a,1,2),o(a,e.error_protection?0:1,1),o(a,a.bitrate_index,4),o(a,a.samplerate_index,2),o(a,a.padding,1),o(a,e.extension,1),o(a,e.mode.ordinal(),2),o(a,a.mode_ext,2),o(a,e.copyright,1),o(a,e.original,1),o(a,e.emphasis,2),e.error_protection&&o(a,0,16),1==e.version){for(o(a,n.main_data_begin,9),2==a.channels_out?o(a,n.private_bits,3):o(a,n.private_bits,5),i=0;i<a.channels_out;i++){var s;for(s=0;s<4;s++)o(a,n.scfsi[i][s],1)}for(r=0;r<2;r++)for(i=0;i<a.channels_out;i++){var l=n.tt[r][i];o(a,l.part2_3_length+l.part2_length,12),o(a,l.big_values/2,9),o(a,l.global_gain,8),o(a,l.scalefac_compress,4),l.block_type!=P.NORM_TYPE?(o(a,1,1),o(a,l.block_type,2),o(a,l.mixed_block_flag,1),14==l.table_select[0]&&(l.table_select[0]=16),o(a,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),o(a,l.table_select[1],5),o(a,l.subblock_gain[0],3),o(a,l.subblock_gain[1],3),o(a,l.subblock_gain[2],3)):(o(a,0,1),14==l.table_select[0]&&(l.table_select[0]=16),o(a,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),o(a,l.table_select[1],5),14==l.table_select[2]&&(l.table_select[2]=16),o(a,l.table_select[2],5),o(a,l.region0_count,4),o(a,l.region1_count,3)),o(a,l.preflag,1),o(a,l.scalefac_scale,1),o(a,l.count1table_select,1)}}else for(o(a,n.main_data_begin,8),o(a,n.private_bits,a.channels_out),r=0,i=0;i<a.channels_out;i++){var l=n.tt[r][i];o(a,l.part2_3_length+l.part2_length,12),o(a,l.big_values/2,9),o(a,l.global_gain,8),o(a,l.scalefac_compress,9),l.block_type!=P.NORM_TYPE?(o(a,1,1),o(a,l.block_type,2),o(a,l.mixed_block_flag,1),14==l.table_select[0]&&(l.table_select[0]=16),o(a,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),o(a,l.table_select[1],5),o(a,l.subblock_gain[0],3),o(a,l.subblock_gain[1],3),o(a,l.subblock_gain[2],3)):(o(a,0,1),14==l.table_select[0]&&(l.table_select[0]=16),o(a,l.table_select[0],5),14==l.table_select[1]&&(l.table_select[1]=16),o(a,l.table_select[1],5),14==l.table_select[2]&&(l.table_select[2]=16),o(a,l.table_select[2],5),o(a,l.region0_count,4),o(a,l.region1_count,3)),o(a,l.scalefac_scale,1),o(a,l.count1table_select,1)}e.error_protection&&CRC_writeheader(a,a.header[a.h_ptr].buf);var u=a.h_ptr;a.h_ptr=u+1&F.MAX_HEADER_BUF-1,a.header[a.h_ptr].write_timing=a.header[u].write_timing+t,a.h_ptr==a.w_ptr&&Q.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}function _(e,t){var r,i=ee.ht[t.count1table_select+32],a=0,s=t.big_values,o=t.big_values;for(r=(t.count1-t.big_values)/4;r>0;--r){var l,u=0,_=0;l=t.l3_enc[s+0],0!=l&&(_+=8,t.xr[o+0]<0&&u++),l=t.l3_enc[s+1],0!=l&&(_+=4,u*=2,t.xr[o+1]<0&&u++),l=t.l3_enc[s+2],0!=l&&(_+=2,u*=2,t.xr[o+2]<0&&u++),l=t.l3_enc[s+3],0!=l&&(_++,u*=2,t.xr[o+3]<0&&u++),s+=4,o+=4,n(e,u+i.table[_],i.hlen[_]),a+=i.hlen[_]}return a}function f(e,t,r,i,a){var s=ee.ht[t],o=0;if(0==t)return o;for(var l=r;l<i;l+=2){var u=0,_=0,f=s.xlen,c=s.xlen,h=0,d=a.l3_enc[l],m=a.l3_enc[l+1];if(0!=d&&(a.xr[l]<0&&h++,u--),t>15){if(d>14){h|=d-15<<1,_=f,d=15}if(m>14){var p=m-15;h<<=f,h|=p,_+=f,m=15}c=16}0!=m&&(h<<=1,a.xr[l+1]<0&&h++,u--),d=d*c+m,_-=u,u+=s.hlen[d],n(e,s.table[d],u),n(e,h,_),o+=u+_}return o}function c(e,t){var n=3*e.scalefac_band.s[3];n>t.big_values&&(n=t.big_values);var r=f(e,t.table_select[0],0,n,t);return r+=f(e,t.table_select[1],n,t.big_values,t)}function h(e,t){var n,r,i,a;n=t.big_values;var s=t.region0_count+1;return i=e.scalefac_band.l[s],s+=t.region1_count+1,a=e.scalefac_band.l[s],i>n&&(i=n),a>n&&(a=n),r=f(e,t.table_select[0],0,i,t),r+=f(e,t.table_select[1],i,a,t),r+=f(e,t.table_select[2],a,n,t)}function p(e){var t,r,i,a,s=0,o=e.internal_flags,l=o.l3_side;if(1==e.version)for(t=0;t<2;t++)for(r=0;r<o.channels_out;r++){var u=l.tt[t][r],f=d.slen1_tab[u.scalefac_compress],m=d.slen2_tab[u.scalefac_compress];for(a=0,i=0;i<u.sfbdivide;i++)-1!=u.scalefac[i]&&(n(o,u.scalefac[i],f),a+=f);for(;i<u.sfbmax;i++)-1!=u.scalefac[i]&&(n(o,u.scalefac[i],m),a+=m);u.block_type==P.SHORT_TYPE?a+=c(o,u):a+=h(o,u),a+=_(o,u),s+=a}else for(t=0,r=0;r<o.channels_out;r++){var p,v,u=l.tt[t][r],b=0;if(a=0,i=0,v=0,u.block_type==P.SHORT_TYPE){for(;v<4;v++){var g=u.sfb_partition_table[v]/3,y=u.slen[v];for(p=0;p<g;p++,i++)n(o,Math.max(u.scalefac[3*i+0],0),y),n(o,Math.max(u.scalefac[3*i+1],0),y),n(o,Math.max(u.scalefac[3*i+2],0),y),b+=3*y}a+=c(o,u)}else{for(;v<4;v++){var g=u.sfb_partition_table[v],y=u.slen[v];for(p=0;p<g;p++,i++)n(o,Math.max(u.scalefac[i],0),y),b+=y}a+=h(o,u)}a+=_(o,u),s+=b+a}return s}function v(){this.total=0}function b(e,t){var n,r,i,a,s,o=e.internal_flags;return s=o.w_ptr,a=o.h_ptr-1,-1==a&&(a=F.MAX_HEADER_BUF-1),n=o.header[a].write_timing-A,t.total=n,n>=0&&(r=1+a-s,a<s&&(r=1+a-s+F.MAX_HEADER_BUF),n-=8*r*o.sideinfo_len),i=g.getframebits(e),n+=i,t.total+=i,t.total%8!=0?t.total=1+t.total/8:t.total=t.total/8,t.total+=T+1,n<0&&Q.err.println("strange error flushing buffer ... \n"),n}var g=this,y=32773,S=null,k=null,E=null,w=null;this.setModules=function(e,t,n,r){S=e,k=t,E=n,w=r};var R=null,A=0,T=0,M=0;this.getframebits=function(e){var t,n=e.internal_flags;return t=0!=n.bitrate_index?ee.bitrate_table[e.version][n.bitrate_index]:e.brate,8*(0|72e3*(e.version+1)*t/e.out_samplerate+n.padding)},this.CRC_writeheader=function(e,t){var n=65535;n=l(255&t[2],n),n=l(255&t[3],n);for(var r=6;r<e.sideinfo_len;r++)n=l(255&t[r],n);t[4]=byte(n>>8),t[5]=byte(255&n)},this.flush_bitstream=function(e){var t,n,r=e.internal_flags,i=r.h_ptr-1;if(-1==i&&(i=F.MAX_HEADER_BUF-1),t=r.l3_side,!((n=b(e,new v))<0)){if(a(e,n),r.ResvSize=0,t.main_data_begin=0,r.findReplayGain){var s=S.GetTitleGain(r.rgdata);r.RadioGain=0|Math.floor(10*s+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*W(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,n){for(var r,a=e.internal_flags;n-- >0;)for(i(a,t,8),r=0;r<F.MAX_HEADER_BUF;++r)a.header[r].write_timing+=8},this.format_bitstream=function(e){var t,n=e.internal_flags;t=n.l3_side;var r=this.getframebits(e);a(e,t.resvDrain_pre),u(e,r);var i=8*n.sideinfo_len;if(i+=p(e),a(e,t.resvDrain_post),i+=t.resvDrain_post,t.main_data_begin+=(r-i)/8,b(e,new v)!=n.ResvSize&&Q.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=n.ResvSize&&(Q.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,n.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*n.sideinfo_len,i-t.resvDrain_post-8*n.sideinfo_len,i,i%8,r),Q.err.println("This is a fatal error.  It has several possible causes:"),Q.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Q.err.println(" 9%%  Your system is overclocked"),Q.err.println(" 1%%  bug in LAME encoding library"),n.ResvSize=8*t.main_data_begin),A>1e9){var s;for(s=0;s<F.MAX_HEADER_BUF;++s)n.header[s].write_timing-=A;A=0}return 0},this.copy_buffer=function(e,t,n,i,a){var o=T+1;if(o<=0)return 0;if(0!=i&&o>i)return-1;if(Q.arraycopy(R,0,t,n,o),T=-1,M=0,0!=a){var l=r(1);if(l[0]=e.nMusicCRC,w.updateMusicCRC(l,t,n,o),e.nMusicCRC=l[0],o>0&&(e.VBR_seek_table.nBytesWritten+=o),e.decode_on_the_fly)for(var u,_=s([2,1152]),f=o,c=-1;0!=c;)if(c=k.hip_decode1_unclipped(e.hip,t,n,f,_[0],_[1]),f=0,-1==c&&(c=0),c>0){if(e.findPeakSample){for(u=0;u<c;u++)_[0][u]>e.PeakSample?e.PeakSample=_[0][u]:-_[0][u]>e.PeakSample&&(e.PeakSample=-_[0][u]);if(e.channels_out>1)for(u=0;u<c;u++)_[1][u]>e.PeakSample?e.PeakSample=_[1][u]:-_[1][u]>e.PeakSample&&(e.PeakSample=-_[1][u])}if(e.findReplayGain&&S.AnalyzeSamples(e.rgdata,_[0],0,_[1],0,c,e.channels_out)==m.GAIN_ANALYSIS_ERROR)return-6}}return o},this.init_bit_stream_w=function(e){R=t(G.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,T=-1,M=0,A=0}}function y(e,t,n,r){this.xlen=e,this.linmax=t,this.table=n,this.hlen=r}function S(e){this.bits=e}function k(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}function E(){var e,t;this.setModules=function(n,r){e=n,t=r}}function w(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=i(P.SBMAX_l),this.s=i(P.SBMAX_s),this.psfb21=i(P.PSFB21),this.psfb12=i(P.PSFB12),this.cb_l=i(P.CBANDS),this.cb_s=i(P.CBANDS),this.eql_w=i(P.BLKSIZE/2)}function R(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=c.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}function A(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,n,a){var s,o=e.internal_flags,l=i(te.SFBMAX),u=i(576),_=r(2),f=0,c=o.l3_side,h=new S(f);this.quantize.rv.ResvFrameBegin(e,h),f=h.bits;for(var d=0;d<o.mode_gr;d++){s=this.quantize.qupvt.on_pe(e,t,_,f,d,d),o.mode_ext==P.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,d),this.quantize.qupvt.reduce_side(_,n[d],f,s));for(var m=0;m<o.channels_out;m++){var p,v,b=c.tt[d][m];b.block_type!=P.SHORT_TYPE?(p=0,v=o.PSY.mask_adjust-p):(p=0,v=o.PSY.mask_adjust_short-p),o.masking_lower=Math.pow(10,.1*v),this.quantize.init_outer_loop(o,b),this.quantize.init_xrpow(o,b,u)&&(this.quantize.qupvt.calc_xmin(e,a[d][m],b,l),this.quantize.outer_loop(e,b,l,u,m,_[m])),this.quantize.iteration_finish_one(o,d,m)}}this.quantize.rv.ResvFrameEnd(o,f)}}function T(){}function M(e,t,n,i){this.l=r(1+P.SBMAX_l),this.s=r(1+P.SBMAX_s),this.psfb21=r(1+P.PSFB21),this.psfb12=r(1+P.PSFB12);var a=this.l,s=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Q.arraycopy(this.arrL,0,a,0,Math.min(this.arrL.length,this.l.length)),Q.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),Q.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Q.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function L(){function e(e){return p[e+L.Q_MAX2]}function t(e,t){var n=l.ATHformula(t,e);return n-=d,n=Math.pow(10,n/10+e.ATHlower)}function n(e){for(var n=e.internal_flags.ATH.l,r=e.internal_flags.ATH.psfb21,i=e.internal_flags.ATH.s,a=e.internal_flags.ATH.psfb12,s=e.internal_flags,o=e.out_samplerate,l=0;l<P.SBMAX_l;l++){var u=s.scalefac_band.l[l],_=s.scalefac_band.l[l+1];n[l]=$.MAX_VALUE;for(var f=u;f<_;f++){var c=f*o/1152,h=t(e,c);n[l]=Math.min(n[l],h)}}for(var l=0;l<P.PSFB21;l++){var u=s.scalefac_band.psfb21[l],_=s.scalefac_band.psfb21[l+1];r[l]=$.MAX_VALUE;for(var f=u;f<_;f++){var c=f*o/1152,h=t(e,c);r[l]=Math.min(r[l],h)}}for(var l=0;l<P.SBMAX_s;l++){var u=s.scalefac_band.s[l],_=s.scalefac_band.s[l+1];i[l]=$.MAX_VALUE;for(var f=u;f<_;f++){var c=f*o/384,h=t(e,c);i[l]=Math.min(i[l],h)}i[l]*=s.scalefac_band.s[l+1]-s.scalefac_band.s[l]}for(var l=0;l<P.PSFB12;l++){var u=s.scalefac_band.psfb12[l],_=s.scalefac_band.psfb12[l+1];a[l]=$.MAX_VALUE;for(var f=u;f<_;f++){var c=f*o/384,h=t(e,c);a[l]=Math.min(a[l],h)}a[l]*=s.scalefac_band.s[13]-s.scalefac_band.s[12]}if(e.noATH){for(var l=0;l<P.SBMAX_l;l++)n[l]=1e-20;for(var l=0;l<P.PSFB21;l++)r[l]=1e-20;for(var l=0;l<P.SBMAX_s;l++)i[l]=1e-20;for(var l=0;l<P.PSFB12;l++)a[l]=1e-20}s.ATH.floor=10*W(t(e,-1))}function a(e){this.s=e}var s=null,o=null,l=null;this.setModules=function(e,t,n){s=e,o=t,l=n},this.IPOW20=function(e){return v[e]};var u=L.IXMAX_VAL,_=u+2,c=L.Q_MAX,h=L.Q_MAX2,d=(L.LARGE_BITS,100);this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var m=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=m,this.sfBandIndex=[new M([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new M([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var p=i(c+h+1),v=i(c),b=i(_),y=i(_);this.adj43=y,this.iteration_init=function(e){var t,r=e.internal_flags,i=r.l3_side;if(0==r.iteration_init_init){for(r.iteration_init_init=1,i.main_data_begin=0,n(e),b[0]=0,t=1;t<_;t++)b[t]=Math.pow(t,4/3);for(t=0;t<_-1;t++)y[t]=t+1-Math.pow(.5*(b[t]+b[t+1]),.75);for(y[t]=.5,t=0;t<c;t++)v[t]=Math.pow(2,-.1875*(t-210));for(t=0;t<=c+h;t++)p[t]=Math.pow(2,.25*(t-210-h));s.huffman_init(r);var a,o,l,u;for(t=e.exp_nspsytune>>2&63,t>=32&&(t-=64),a=Math.pow(10,t/4/10),t=e.exp_nspsytune>>8&63,t>=32&&(t-=64),o=Math.pow(10,t/4/10),t=e.exp_nspsytune>>14&63,t>=32&&(t-=64),l=Math.pow(10,t/4/10),t=e.exp_nspsytune>>20&63,t>=32&&(t-=64),u=l*Math.pow(10,t/4/10),t=0;t<P.SBMAX_l;t++){var f;f=t<=6?a:t<=13?o:t<=20?l:u,r.nsPsy.longfact[t]=f}for(t=0;t<P.SBMAX_s;t++){var f;f=t<=5?a:t<=10?o:t<=11?l:u,r.nsPsy.shortfact[t]=f}}},this.on_pe=function(e,t,n,i,a,s){var l,u,_=e.internal_flags,f=0,c=r(2),h=new S(f),d=o.ResvMaxBits(e,i,h,s);f=h.bits;var m=f+d;for(m>F.MAX_BITS_PER_GRANULE&&(m=F.MAX_BITS_PER_GRANULE),l=0,u=0;u<_.channels_out;++u)n[u]=Math.min(F.MAX_BITS_PER_CHANNEL,f/_.channels_out),c[u]=0|n[u]*t[a][u]/700-n[u],c[u]>3*i/4&&(c[u]=3*i/4),c[u]<0&&(c[u]=0),c[u]+n[u]>F.MAX_BITS_PER_CHANNEL&&(c[u]=Math.max(0,F.MAX_BITS_PER_CHANNEL-n[u])),l+=c[u];if(l>d)for(u=0;u<_.channels_out;++u)c[u]=d*c[u]/l;for(u=0;u<_.channels_out;++u)n[u]+=c[u],d-=c[u];for(l=0,u=0;u<_.channels_out;++u)l+=n[u];if(l>F.MAX_BITS_PER_GRANULE){var p=0;for(u=0;u<_.channels_out;++u)n[u]*=F.MAX_BITS_PER_GRANULE,n[u]/=l,p+=n[u]}return m},this.reduce_side=function(e,t,n,r){var i=.33*(.5-t)/.5;i<0&&(i=0),i>.5&&(i=.5);var a=0|.5*i*(e[0]+e[1]);a>F.MAX_BITS_PER_CHANNEL-e[0]&&(a=F.MAX_BITS_PER_CHANNEL-e[0]),a<0&&(a=0),e[1]>=125&&(e[1]-a>125?(e[0]<n&&(e[0]+=a),e[1]-=a):(e[0]+=e[1]-125,e[1]=125)),(a=e[0]+e[1])>r&&(e[0]=r*e[0]/a,e[1]=r*e[1]/a)},this.athAdjust=function(e,t,n){var r=90.30873362,i=J.FAST_LOG10_X(t,10),a=e*e,s=0;return i-=n,a>1e-20&&(s=1+J.FAST_LOG10_X(a,10/r)),s<0&&(s=0),i*=s,i+=n+r-94.82444863,Math.pow(10,.1*i)},this.calc_xmin=function(e,t,n,r){var i,a=0,s=e.internal_flags,o=0,l=0,u=s.ATH,_=n.xr,c=e.VBR==f.vbr_mtrh?1:0,h=s.masking_lower;for(e.VBR!=f.vbr_mtrh&&e.VBR!=f.vbr_mt||(h=1),i=0;i<n.psy_lmax;i++){var d,m,p,v,b,y;m=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(u.adjust,u.l[i],u.floor):u.adjust*u.l[i],b=n.width[i],p=m/b,v=2.220446049250313e-16,y=b>>1,d=0;do{var S,k;S=_[o]*_[o],d+=S,v+=S<p?S:p,o++,k=_[o]*_[o],d+=k,v+=k<p?k:p,o++}while(--y>0);if(d>m&&l++,i==P.SBPSY_l){var E=m*s.nsPsy.longfact[i];v<E&&(v=E)}if(0!=c&&(m=v),!e.ATHonly){var w=t.en.l[i];if(w>0){var E;E=d*t.thm.l[i]*h/w,0!=c&&(E*=s.nsPsy.longfact[i]),m<E&&(m=E)}}r[a++]=0!=c?m:m*s.nsPsy.longfact[i]}var R=575;if(n.block_type!=P.SHORT_TYPE)for(var A=576;0!=A--&&g.EQ(_[A],0);)R=A;n.max_nonzero_coeff=R;for(var T=n.sfb_smin;i<n.psymax;T++,i+=3){var b,M,L;for(L=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(u.adjust,u.s[T],u.floor):u.adjust*u.s[T],b=n.width[i],M=0;M<3;M++){var m,p,v,d=0,y=b>>1;p=L/b,v=2.220446049250313e-16;do{var S,k;S=_[o]*_[o],d+=S,v+=S<p?S:p,o++,k=_[o]*_[o],d+=k,v+=k<p?k:p,o++}while(--y>0);if(d>L&&l++,T==P.SBPSY_s){var E=L*s.nsPsy.shortfact[T];v<E&&(v=E)}if(m=0!=c?v:L,!e.ATHonly&&!e.ATHshort){var w=t.en.s[T][M];if(w>0){var E;E=d*t.thm.s[T][M]*h/w,0!=c&&(E*=s.nsPsy.shortfact[T]),m<E&&(m=E)}}r[a++]=0!=c?m:m*s.nsPsy.shortfact[T]}e.useTemporal&&(r[a-3]>r[a-3+1]&&(r[a-3+1]+=(r[a-3]-r[a-3+1])*s.decay),r[a-3+1]>r[a-3+2]&&(r[a-3+2]+=(r[a-3+1]-r[a-3+2])*s.decay))}return l},this.calc_noise_core=function(e,t,n,r){var a=0,s=t.s,o=e.l3_enc;if(s>e.count1)for(;0!=n--;){var l;l=e.xr[s],s++,a+=l*l,l=e.xr[s],s++,a+=l*l}else if(s>e.big_values){var u=i(2);for(u[0]=0,u[1]=r;0!=n--;){var l;l=Math.abs(e.xr[s])-u[o[s]],s++,a+=l*l,l=Math.abs(e.xr[s])-u[o[s]],s++,a+=l*l}}else for(;0!=n--;){var l;l=Math.abs(e.xr[s])-b[o[s]]*r,s++,a+=l*l,l=Math.abs(e.xr[s])-b[o[s]]*r,s++,a+=l*l}return t.s=s,a},this.calc_noise=function(t,n,r,i,s){var o,l,u=0,_=0,f=0,c=0,h=0,d=-20,p=0,v=t.scalefac,b=0;for(i.over_SSD=0,o=0;o<t.psymax;o++){var g=t.global_gain-(v[b++]+(0!=t.preflag?m[o]:0)<<t.scalefac_scale+1)-8*t.subblock_gain[t.window[o]],y=0;if(null!=s&&s.step[o]==g)y=s.noise[o],p+=t.width[o],r[u++]=y/n[_++],y=s.noise_log[o];else{var S=e(g);if(l=t.width[o]>>1,p+t.width[o]>t.max_nonzero_coeff){var k;k=t.max_nonzero_coeff-p+1,l=k>0?k>>1:0}var E=new a(p);y=this.calc_noise_core(t,E,l,S),p=E.s,null!=s&&(s.step[o]=g,s.noise[o]=y),y=r[u++]=y/n[_++],y=J.FAST_LOG10(Math.max(y,1e-20)),null!=s&&(s.noise_log[o]=y)}if(null!=s&&(s.global_gain=t.global_gain),h+=y,y>0){var w;w=Math.max(0|10*y+.5,1),i.over_SSD+=w*w,f++,c+=y}d=Math.max(d,y)}return i.over_count=f,i.tot_noise=h,i.over_noise=c,i.max_noise=d,f},this.set_pinfo=function(e,t,n,r,a){var s,o,l,u,_,f=e.internal_flags,c=0==t.scalefac_scale?.5:1,h=t.scalefac,d=i(te.SFBMAX),p=i(te.SFBMAX),v=new k;calc_xmin(e,n,t,d),calc_noise(t,d,p,v,null);var b=0;for(o=t.sfb_lmax,t.block_type!=P.SHORT_TYPE&&0==t.mixed_block_flag&&(o=22),s=0;s<o;s++){var g=f.scalefac_band.l[s],y=f.scalefac_band.l[s+1],S=y-g;for(u=0;b<y;b++)u+=t.xr[b]*t.xr[b];u/=S,_=1e15,f.pinfo.en[r][a][s]=_*u,f.pinfo.xfsf[r][a][s]=_*d[s]*p[s]/S,n.en.l[s]>0&&!e.ATHonly?u/=n.en.l[s]:u=0,f.pinfo.thr[r][a][s]=_*Math.max(u*n.thm.l[s],f.ATH.l[s]),f.pinfo.LAMEsfb[r][a][s]=0,0!=t.preflag&&s>=11&&(f.pinfo.LAMEsfb[r][a][s]=-c*m[s]),s<P.SBPSY_l&&(f.pinfo.LAMEsfb[r][a][s]-=c*h[s])}if(t.block_type==P.SHORT_TYPE)for(o=s,s=t.sfb_smin;s<P.SBMAX_s;s++)for(var g=f.scalefac_band.s[s],y=f.scalefac_band.s[s+1],S=y-g,E=0;E<3;E++){for(u=0,l=g;l<y;l++)u+=t.xr[b]*t.xr[b],b++;u=Math.max(u/S,1e-20),_=1e15,f.pinfo.en_s[r][a][3*s+E]=_*u,f.pinfo.xfsf_s[r][a][3*s+E]=_*d[o]*p[o]/S,n.en.s[s][E]>0?u/=n.en.s[s][E]:u=0,(e.ATHonly||e.ATHshort)&&(u=0),f.pinfo.thr_s[r][a][3*s+E]=_*Math.max(u*n.thm.s[s][E],f.ATH.s[s]),f.pinfo.LAMEsfb_s[r][a][3*s+E]=-2*t.subblock_gain[E],s<P.SBPSY_s&&(f.pinfo.LAMEsfb_s[r][a][3*s+E]-=c*h[o]),o++}f.pinfo.LAMEqss[r][a]=t.global_gain,f.pinfo.LAMEmainbits[r][a]=t.part2_3_length+t.part2_length,f.pinfo.LAMEsfbits[r][a]=t.part2_length,f.pinfo.over[r][a]=v.over_count,f.pinfo.max_noise[r][a]=10*v.max_noise,f.pinfo.over_noise[r][a]=10*v.over_noise,f.pinfo.tot_noise[r][a]=10*v.tot_noise,f.pinfo.over_SSD[r][a]=v.over_SSD}}function x(){this.global_gain=0,this.sfb_count1=0,this.step=r(39),this.noise=i(39),this.noise_log=i(39)}function B(){function e(e){return new Int32Array(e)}function t(e){return new Float32Array(e)}this.xr=i(576),this.l3_enc=r(576),this.scalefac=r(te.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=r(3),this.subblock_gain=r(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=r(te.SFBMAX),this.window=r(te.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=r(4),this.max_nonzero_coeff=0;var n=this;this.assign=function(r){n.xr=t(r.xr),n.l3_enc=e(r.l3_enc),n.scalefac=e(r.scalefac),n.xrpow_max=r.xrpow_max,n.part2_3_length=r.part2_3_length,n.big_values=r.big_values,n.count1=r.count1,n.global_gain=r.global_gain,n.scalefac_compress=r.scalefac_compress,n.block_type=r.block_type,n.mixed_block_flag=r.mixed_block_flag,n.table_select=e(r.table_select),n.subblock_gain=e(r.subblock_gain),n.region0_count=r.region0_count,n.region1_count=r.region1_count,n.preflag=r.preflag,n.scalefac_scale=r.scalefac_scale,n.count1table_select=r.count1table_select,n.part2_length=r.part2_length,n.sfb_lmax=r.sfb_lmax,n.sfb_smin=r.sfb_smin,n.psy_lmax=r.psy_lmax,n.sfbmax=r.sfbmax,n.psymax=r.psymax,n.sfbdivide=r.sfbdivide,n.width=e(r.width),n.window=e(r.window),n.count1bits=r.count1bits,n.sfb_partition_table=r.sfb_partition_table.slice(0),n.slen=e(r.slen),n.max_nonzero_coeff=r.max_nonzero_coeff}}function O(){function e(e,t,n,r){r=0;for(var i=0;i<=n;++i){var a=Math.abs(e.xr[i]);r+=a,t[i]=Math.sqrt(a*Math.sqrt(a)),t[i]>e.xrpow_max&&(e.xrpow_max=t[i])}return r}function t(e,t){var n=e.ATH,r=t.xr;if(t.block_type!=P.SHORT_TYPE)for(var i=!1,a=P.PSFB21-1;a>=0&&!i;a--){var s=e.scalefac_band.psfb21[a],o=e.scalefac_band.psfb21[a+1],l=p.athAdjust(n.adjust,n.psfb21[a],n.floor);e.nsPsy.longfact[21]>1e-12&&(l*=e.nsPsy.longfact[21]);for(var u=o-1;u>=s;u--){if(!(Math.abs(r[u])<l)){i=!0;break}r[u]=0}}else for(var _=0;_<3;_++)for(var i=!1,a=P.PSFB12-1;a>=0&&!i;a--){var s=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*_+(e.scalefac_band.psfb12[a]-e.scalefac_band.psfb12[0]),o=s+(e.scalefac_band.psfb12[a+1]-e.scalefac_band.psfb12[a]),f=p.athAdjust(n.adjust,n.psfb12[a],n.floor);e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]);for(var u=o-1;u>=s;u--){if(!(Math.abs(r[u])<f)){i=!0;break}r[u]=0}}}function n(e){this.ordinal=e}function r(e,t,r,i,a){var s,o=e.CurrentStep[i],l=!1,u=e.OldValue[i],_=n.BINSEARCH_NONE;for(t.global_gain=u,r-=t.part2_length;;){var f;if(s=v.count_bits(e,a,t,null),1==o||s==r)break;s>r?(_==n.BINSEARCH_DOWN&&(l=!0),l&&(o/=2),_=n.BINSEARCH_UP,f=o):(_==n.BINSEARCH_UP&&(l=!0),l&&(o/=2),_=n.BINSEARCH_DOWN,f=-o),t.global_gain+=f,t.global_gain<0&&(t.global_gain=0,l=!0),t.global_gain>255&&(t.global_gain=255,l=!0)}for(;s>r&&t.global_gain<255;)t.global_gain++,s=v.count_bits(e,a,t,null);return e.CurrentStep[i]=u-t.global_gain>=4?4:2,e.OldValue[i]=t.global_gain,t.part2_3_length=s,s}function a(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function s(e){return J.FAST_LOG10(.368+.632*e*e*e)}function o(e,t){for(var n=1e-37,r=0;r<t.psymax;r++)n+=s(e[r]);return Math.max(1e-20,n)}function l(e,t,n,r,i){var a;switch(e){default:case 9:t.over_count>0?(a=n.over_SSD<=t.over_SSD,n.over_SSD==t.over_SSD&&(a=n.bits<t.bits)):a=n.max_noise<0&&10*n.max_noise+n.bits<=10*t.max_noise+t.bits;break;case 0:a=n.over_count<t.over_count||n.over_count==t.over_count&&n.over_noise<t.over_noise||n.over_count==t.over_count&&g.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 8:n.max_noise=o(i,r);case 1:a=n.max_noise<t.max_noise;break;case 2:a=n.tot_noise<t.tot_noise;break;case 3:a=n.tot_noise<t.tot_noise&&n.max_noise<t.max_noise;break;case 4:
a=n.max_noise<=0&&t.max_noise>.2||n.max_noise<=0&&t.max_noise<0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise||n.max_noise<=0&&t.max_noise>0&&t.max_noise>n.max_noise-.2&&n.tot_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.05&&t.max_noise>n.max_noise-.1&&n.tot_noise+n.over_noise<t.tot_noise+t.over_noise||n.max_noise>0&&t.max_noise>-.1&&t.max_noise>n.max_noise-.15&&n.tot_noise+n.over_noise+n.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:a=n.over_noise<t.over_noise||g.EQ(n.over_noise,t.over_noise)&&n.tot_noise<t.tot_noise;break;case 6:a=n.over_noise<t.over_noise||g.EQ(n.over_noise,t.over_noise)&&(n.max_noise<t.max_noise||g.EQ(n.max_noise,t.max_noise)&&n.tot_noise<=t.tot_noise);break;case 7:a=n.over_count<t.over_count||n.over_noise<t.over_noise}return 0==t.over_count&&(a=a&&n.bits<t.bits),a}function u(e,t,n,r,i){var a,s=e.internal_flags;a=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<n[l]&&(o=n[l]);var u=s.noise_shaping_amp;switch(3==u&&(u=i?2:1),u){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;case 0:default:o>1?o=1:o*=.95}for(var _=0,l=0;l<t.sfbmax;l++){var f,c=t.width[l];if(_+=c,!(n[l]<o)){if(0!=(2&s.substep_shaping)&&(s.pseudohalf[l]=0==s.pseudohalf[l]?1:0,0==s.pseudohalf[l]&&2==s.noise_shaping_amp))return;for(t.scalefac[l]++,f=-c;f<0;f++)r[_+f]*=a,r[_+f]>t.xrpow_max&&(t.xrpow_max=r[_+f]);if(2==s.noise_shaping_amp)return}}}function _(e,t){for(var n=0,r=0;r<e.sfbmax;r++){var i=e.width[r],a=e.scalefac[r];if(0!=e.preflag&&(a+=p.pretab[r]),n+=i,0!=(1&a)){a++;for(var s=-i;s<0;s++)t[n+s]*=1.2968395546510096,t[n+s]>e.xrpow_max&&(e.xrpow_max=t[n+s])}e.scalefac[r]=a>>1}e.preflag=0,e.scalefac_scale=1}function c(e,t,n){var r,i=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(i[r]>=16)return!0;for(var a=0;a<3;a++){var s=0,o=0;for(r=t.sfb_lmax+a;r<t.sfbdivide;r+=3)s<i[r]&&(s=i[r]);for(;r<t.sfbmax;r+=3)o<i[r]&&(o=i[r]);if(!(s<16&&o<8)){if(t.subblock_gain[a]>=7)return!0;t.subblock_gain[a]++;var l=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+a;r<t.sfbmax;r+=3){var u,_=t.width[r],f=i[r];if((f-=4>>t.scalefac_scale)>=0)i[r]=f,l+=3*_;else{i[r]=0;var c=210+(f<<t.scalefac_scale+1);u=p.IPOW20(c),l+=_*(a+1);for(var h=-_;h<0;h++)n[l+h]*=u,n[l+h]>t.xrpow_max&&(t.xrpow_max=n[l+h]);l+=_*(3-a-1)}}var u=p.IPOW20(202);l+=t.width[r]*(a+1);for(var h=-t.width[r];h<0;h++)n[l+h]*=u,n[l+h]>t.xrpow_max&&(t.xrpow_max=n[l+h])}}return!1}function h(e,t,n,r,i){var s=e.internal_flags;u(e,t,n,r,i);var o=a(t);return!o&&(!(o=2==s.mode_gr?v.scale_bitcount(t):v.scale_bitcount_lsf(s,t))||(s.noise_shaping>1&&(Z.fill(s.pseudohalf,0),0==t.scalefac_scale?(_(t,r),o=!1):t.block_type==P.SHORT_TYPE&&s.subblock_gain>0&&(o=c(s,t,r)||a(t))),o||(o=2==s.mode_gr?v.scale_bitcount(t):v.scale_bitcount_lsf(s,t)),!o))}var d;this.rv=null;var m;this.qupvt=null;var p,v,b=new E;this.setModules=function(e,t,n,r){d=e,m=t,this.rv=t,p=n,this.qupvt=n,v=r,b.setModules(p,v)},this.ms_convert=function(e,t){for(var n=0;n<576;++n){var r=e.tt[t][0].xr[n],i=e.tt[t][1].xr[n];e.tt[t][0].xr[n]=(r+i)*(.5*J.SQRT2),e.tt[t][1].xr[n]=(r-i)*(.5*J.SQRT2)}},this.init_xrpow=function(t,n,r){var i=0,a=0|n.max_nonzero_coeff;if(n.xrpow_max=0,Z.fill(r,a,576,0),(i=e(n,r,a,i))>1e-20){var s=0;0!=(2&t.substep_shaping)&&(s=1);for(var o=0;o<n.psymax;o++)t.pseudohalf[o]=s;return!0}return Z.fill(n.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,n){n.part2_3_length=0,n.big_values=0,n.count1=0,n.global_gain=210,n.scalefac_compress=0,n.table_select[0]=0,n.table_select[1]=0,n.table_select[2]=0,n.subblock_gain[0]=0,n.subblock_gain[1]=0,n.subblock_gain[2]=0,n.subblock_gain[3]=0,n.region0_count=0,n.region1_count=0,n.preflag=0,n.scalefac_scale=0,n.count1table_select=0,n.part2_length=0,n.sfb_lmax=P.SBPSY_l,n.sfb_smin=P.SBPSY_s,n.psy_lmax=e.sfb21_extra?P.SBMAX_l:P.SBPSY_l,n.psymax=n.psy_lmax,n.sfbmax=n.sfb_lmax,n.sfbdivide=11;for(var r=0;r<P.SBMAX_l;r++)n.width[r]=e.scalefac_band.l[r+1]-e.scalefac_band.l[r],n.window[r]=3;if(n.block_type==P.SHORT_TYPE){var a=i(576);n.sfb_smin=0,n.sfb_lmax=0,0!=n.mixed_block_flag&&(n.sfb_smin=3,n.sfb_lmax=2*e.mode_gr+4),n.psymax=n.sfb_lmax+3*((e.sfb21_extra?P.SBMAX_s:P.SBPSY_s)-n.sfb_smin),n.sfbmax=n.sfb_lmax+3*(P.SBPSY_s-n.sfb_smin),n.sfbdivide=n.sfbmax-18,n.psy_lmax=n.sfb_lmax;var s=e.scalefac_band.l[n.sfb_lmax];Q.arraycopy(n.xr,0,a,0,576);for(var r=n.sfb_smin;r<P.SBMAX_s;r++)for(var o=e.scalefac_band.s[r],l=e.scalefac_band.s[r+1],u=0;u<3;u++)for(var _=o;_<l;_++)n.xr[s++]=a[3*_+u];for(var f=n.sfb_lmax,r=n.sfb_smin;r<P.SBMAX_s;r++)n.width[f]=n.width[f+1]=n.width[f+2]=e.scalefac_band.s[r+1]-e.scalefac_band.s[r],n.window[f]=0,n.window[f+1]=1,n.window[f+2]=2,f+=3}n.count1bits=0,n.sfb_partition_table=p.nr_of_sfb_block[0][0],n.slen[0]=0,n.slen[1]=0,n.slen[2]=0,n.slen[3]=0,n.max_nonzero_coeff=575,Z.fill(n.scalefac,0),t(e,n)},n.BINSEARCH_NONE=new n(0),n.BINSEARCH_UP=new n(1),n.BINSEARCH_DOWN=new n(2),this.trancate_smallspectrums=function(e,t,n,r){var a=i(te.SFBMAX);if((0!=(4&e.substep_shaping)||t.block_type!=P.SHORT_TYPE)&&0==(128&e.substep_shaping)){p.calc_noise(t,n,a,new k,null);for(var s=0;s<576;s++){var o=0;0!=t.l3_enc[s]&&(o=Math.abs(t.xr[s])),r[s]=o}var s=0,l=8;t.block_type==P.SHORT_TYPE&&(l=6);do{var u,_,f,c,h=t.width[l];if(s+=h,!(a[l]>=1||(Z.sort(r,s-h,h),g.EQ(r[s-1],0)))){u=(1-a[l])*n[l],_=0,c=0;do{var d;for(f=1;c+f<h&&!g.NEQ(r[c+s-h],r[c+s+f-h]);f++);if(d=r[c+s-h]*r[c+s-h]*f,u<d){0!=c&&(_=r[c+s-h-1]);break}u-=d,c+=f}while(c<h);if(!g.EQ(_,0))do{Math.abs(t.xr[s-h])<=_&&(t.l3_enc[s-h]=0)}while(--h>0)}}while(++l<t.psymax);t.part2_3_length=v.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,n,a,s,o){var u,_=e.internal_flags,c=new B,d=i(576),m=i(te.SFBMAX),b=new k,g=new x,y=9999999,S=!1,E=!1,w=0;if(r(_,t,o,s,a),0==_.noise_shaping)return 100;p.calc_noise(t,n,m,b,g),b.bits=t.part2_3_length,c.assign(t);var R=0;for(Q.arraycopy(a,0,d,0,576);!S;){do{var A,T=new k,M=255;if(A=0!=(2&_.substep_shaping)?20:3,_.sfb21_extra){if(m[c.sfbmax]>1)break;if(c.block_type==P.SHORT_TYPE&&(m[c.sfbmax+1]>1||m[c.sfbmax+2]>1))break}if(!h(e,c,m,a,E))break;0!=c.scalefac_scale&&(M=254);var L=o-c.part2_length;if(L<=0)break;for(;(c.part2_3_length=v.count_bits(_,a,c,g))>L&&c.global_gain<=M;)c.global_gain++;if(c.global_gain>M)break;if(0==b.over_count){for(;(c.part2_3_length=v.count_bits(_,a,c,g))>y&&c.global_gain<=M;)c.global_gain++;if(c.global_gain>M)break}if(p.calc_noise(c,n,m,T,g),T.bits=c.part2_3_length,u=t.block_type!=P.SHORT_TYPE?e.quant_comp:e.quant_comp_short,0!=(u=l(u,b,T,c,m)?1:0))y=t.part2_3_length,b=T,t.assign(c),R=0,Q.arraycopy(a,0,d,0,576);else if(0==_.full_outer_loop){if(++R>A&&0==b.over_count)break;if(3==_.noise_shaping_amp&&E&&R>30)break;if(3==_.noise_shaping_amp&&E&&c.global_gain-w>15)break}}while(c.global_gain+c.scalefac_scale<255);3==_.noise_shaping_amp?E?S=!0:(c.assign(t),Q.arraycopy(d,0,a,0,576),R=0,w=c.global_gain,E=!0):S=!0}return e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?Q.arraycopy(d,0,a,0,576):0!=(1&_.substep_shaping)&&trancate_smallspectrums(_,t,n,a),b.over_count},this.iteration_finish_one=function(e,t,n){var r=e.l3_side,i=r.tt[t][n];v.best_scalefac_store(e,t,n,r),1==e.use_best_huffman&&v.best_huffman_divide(e,i),m.ResvAdjust(e,i)},this.VBR_encode_granule=function(e,t,n,r,a,s,o){var l,u,_=e.internal_flags,f=new B,c=i(576),h=o,d=o+1,m=(o+s)/2,p=0,v=_.sfb21_extra;Z.fill(f.l3_enc,0);do{_.sfb21_extra=!(m>h-42)&&v,u=outer_loop(e,t,n,r,a,m),u<=0?(p=1,d=t.part2_3_length,f.assign(t),Q.arraycopy(r,0,c,0,576),o=d-32,l=o-s,m=(o+s)/2):(s=m+32,l=o-s,m=(o+s)/2,0!=p&&(p=2,t.assign(f),Q.arraycopy(c,0,r,0,576)))}while(l>12);_.sfb21_extra=v,2==p&&Q.arraycopy(f.l3_enc,0,t.l3_enc,0,576)},this.get_framebits=function(e,t){var n=e.internal_flags;n.bitrate_index=n.VBR_min_bitrate;var r=d.getframebits(e);n.bitrate_index=1,r=d.getframebits(e);for(var i=1;i<=n.VBR_max_bitrate;i++){n.bitrate_index=i;var a=new S(r);t[i]=m.ResvFrameBegin(e,a),r=a.bits}},this.VBR_old_prepare=function(e,t,n,r,i,a,s,o,l){var u,_=e.internal_flags,f=0,c=1,h=0;_.bitrate_index=_.VBR_max_bitrate;var d=m.ResvFrameBegin(e,new S(0))/_.mode_gr;get_framebits(e,a);for(var v=0;v<_.mode_gr;v++){var b=p.on_pe(e,t,o[v],d,v,0);_.mode_ext==P.MPG_MD_MS_LR&&(ms_convert(_.l3_side,v),p.reduce_side(o[v],n[v],d,b));for(var g=0;g<_.channels_out;++g){var y=_.l3_side.tt[v][g];y.block_type!=P.SHORT_TYPE?(f=1.28/(1+Math.exp(3.5-t[v][g]/300))-.05,u=_.PSY.mask_adjust-f):(f=2.56/(1+Math.exp(3.5-t[v][g]/300))-.14,u=_.PSY.mask_adjust_short-f),_.masking_lower=Math.pow(10,.1*u),init_outer_loop(_,y),l[v][g]=p.calc_xmin(e,r[v][g],y,i[v][g]),0!=l[v][g]&&(c=0),s[v][g]=126,h+=o[v][g]}}for(var v=0;v<_.mode_gr;v++)for(var g=0;g<_.channels_out;g++)h>a[_.VBR_max_bitrate]&&(o[v][g]*=a[_.VBR_max_bitrate],o[v][g]/=h),s[v][g]>o[v][g]&&(s[v][g]=o[v][g]);return c},this.bitpressure_strategy=function(e,t,n,r){for(var i=0;i<e.mode_gr;i++)for(var a=0;a<e.channels_out;a++){for(var s=e.l3_side.tt[i][a],o=t[i][a],l=0,u=0;u<s.psy_lmax;u++)o[l++]*=1+.029*u*u/P.SBMAX_l/P.SBMAX_l;if(s.block_type==P.SHORT_TYPE)for(var u=s.sfb_smin;u<P.SBMAX_s;u++)o[l++]*=1+.029*u*u/P.SBMAX_s/P.SBMAX_s,o[l++]*=1+.029*u*u/P.SBMAX_s/P.SBMAX_s,o[l++]*=1+.029*u*u/P.SBMAX_s/P.SBMAX_s;r[i][a]=0|Math.max(n[i][a],.9*r[i][a])}},this.VBR_new_prepare=function(e,t,n,r,i,a){var s,o=e.internal_flags,l=1,u=0,_=0;if(e.free_format){o.bitrate_index=0;var f=new S(u);s=m.ResvFrameBegin(e,f),u=f.bits,i[0]=s}else{o.bitrate_index=o.VBR_max_bitrate;var f=new S(u);m.ResvFrameBegin(e,f),u=f.bits,get_framebits(e,i),s=i[o.VBR_max_bitrate]}for(var c=0;c<o.mode_gr;c++){p.on_pe(e,t,a[c],u,c,0),o.mode_ext==P.MPG_MD_MS_LR&&ms_convert(o.l3_side,c);for(var h=0;h<o.channels_out;++h){var d=o.l3_side.tt[c][h];o.masking_lower=Math.pow(10,.1*o.PSY.mask_adjust),init_outer_loop(o,d),0!=p.calc_xmin(e,n[c][h],d,r[c][h])&&(l=0),_+=a[c][h]}}for(var c=0;c<o.mode_gr;c++)for(var h=0;h<o.channels_out;h++)_>s&&(a[c][h]*=s,a[c][h]/=_);return l},this.calc_target_bits=function(e,t,n,r,i,a){var s,o,l,u,_=e.internal_flags,f=_.l3_side,c=0;_.bitrate_index=_.VBR_max_bitrate;var h=new S(c);for(a[0]=m.ResvFrameBegin(e,h),c=h.bits,_.bitrate_index=1,c=d.getframebits(e)-8*_.sideinfo_len,i[0]=c/(_.mode_gr*_.channels_out),c=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&_.substep_shaping)&&(c*=1.09),c/=e.out_samplerate,c-=8*_.sideinfo_len,c/=_.mode_gr*_.channels_out,s=.93+.07*(11-e.compression_ratio)/5.5,s<.9&&(s=.9),s>1&&(s=1),o=0;o<_.mode_gr;o++){var v=0;for(l=0;l<_.channels_out;l++){if(r[o][l]=int(s*c),t[o][l]>700){var b=int((t[o][l]-700)/1.4),g=f.tt[o][l];r[o][l]=int(s*c),g.block_type==P.SHORT_TYPE&&b<c/2&&(b=c/2),b>3*c/2?b=3*c/2:b<0&&(b=0),r[o][l]+=b}r[o][l]>F.MAX_BITS_PER_CHANNEL&&(r[o][l]=F.MAX_BITS_PER_CHANNEL),v+=r[o][l]}if(v>F.MAX_BITS_PER_GRANULE)for(l=0;l<_.channels_out;++l)r[o][l]*=F.MAX_BITS_PER_GRANULE,r[o][l]/=v}if(_.mode_ext==P.MPG_MD_MS_LR)for(o=0;o<_.mode_gr;o++)p.reduce_side(r[o],n[o],c*_.channels_out,F.MAX_BITS_PER_GRANULE);for(u=0,o=0;o<_.mode_gr;o++)for(l=0;l<_.channels_out;l++)r[o][l]>F.MAX_BITS_PER_CHANNEL&&(r[o][l]=F.MAX_BITS_PER_CHANNEL),u+=r[o][l];if(u>a[0])for(o=0;o<_.mode_gr;o++)for(l=0;l<_.channels_out;l++)r[o][l]*=a[0],r[o][l]/=u}}function C(){function e(e,t,n){for(var i=10,a=t+238-14-286,s=-15;s<0;s++){var o,l,u;o=r[i+-10],l=e[a+-224]*o,u=e[t+224]*o,o=r[i+-9],l+=e[a+-160]*o,u+=e[t+160]*o,o=r[i+-8],l+=e[a+-96]*o,u+=e[t+96]*o,o=r[i+-7],l+=e[a+-32]*o,u+=e[t+32]*o,o=r[i+-6],l+=e[a+32]*o,u+=e[t+-32]*o,o=r[i+-5],l+=e[a+96]*o,u+=e[t+-96]*o,o=r[i+-4],l+=e[a+160]*o,u+=e[t+-160]*o,o=r[i+-3],l+=e[a+224]*o,u+=e[t+-224]*o,o=r[i+-2],l+=e[t+-256]*o,u-=e[a+256]*o,o=r[i+-1],l+=e[t+-192]*o,u-=e[a+192]*o,o=r[i+0],l+=e[t+-128]*o,u-=e[a+128]*o,o=r[i+1],l+=e[t+-64]*o,u-=e[a+64]*o,o=r[i+2],l+=e[t+0]*o,u-=e[a+0]*o,o=r[i+3],l+=e[t+64]*o,u-=e[a+-64]*o,o=r[i+4],l+=e[t+128]*o,u-=e[a+-128]*o,o=r[i+5],l+=e[t+192]*o,u-=e[a+-192]*o,l*=r[i+6],o=u-l,n[30+2*s]=u+l,n[31+2*s]=r[i+7]*o,i+=18,t--,a++}var l,u,_,f;u=e[t+-16]*r[i+-10],l=e[t+-32]*r[i+-2],u+=(e[t+-48]-e[t+16])*r[i+-9],l+=e[t+-96]*r[i+-1],u+=(e[t+-80]+e[t+48])*r[i+-8],l+=e[t+-160]*r[i+0],u+=(e[t+-112]-e[t+80])*r[i+-7],l+=e[t+-224]*r[i+1],u+=(e[t+-144]+e[t+112])*r[i+-6],l-=e[t+32]*r[i+2],u+=(e[t+-176]-e[t+144])*r[i+-5],l-=e[t+96]*r[i+3],u+=(e[t+-208]+e[t+176])*r[i+-4],l-=e[t+160]*r[i+4],u+=(e[t+-240]-e[t+208])*r[i+-3],l-=e[t+224],_=l-u,f=l+u,u=n[14],l=n[15]-u,n[31]=f+u,n[30]=_+l,n[15]=_-l,n[14]=f-u;var c;c=n[28]-n[0],n[0]+=n[28],n[28]=c*r[i+-36+7],c=n[29]-n[1],n[1]+=n[29],n[29]=c*r[i+-36+7],c=n[26]-n[2],n[2]+=n[26],n[26]=c*r[i+-72+7],c=n[27]-n[3],n[3]+=n[27],n[27]=c*r[i+-72+7],c=n[24]-n[4],n[4]+=n[24],n[24]=c*r[i+-108+7],c=n[25]-n[5],n[5]+=n[25],n[25]=c*r[i+-108+7],c=n[22]-n[6],n[6]+=n[22],n[22]=c*J.SQRT2,c=n[23]-n[7],n[7]+=n[23],n[23]=c*J.SQRT2-n[7],n[7]-=n[6],n[22]-=n[7],n[23]-=n[22],c=n[6],n[6]=n[31]-c,n[31]=n[31]+c,c=n[7],n[7]=n[30]-c,n[30]=n[30]+c,c=n[22],n[22]=n[15]-c,n[15]=n[15]+c,c=n[23],n[23]=n[14]-c,n[14]=n[14]+c,c=n[20]-n[8],n[8]+=n[20],n[20]=c*r[i+-180+7],c=n[21]-n[9],n[9]+=n[21],n[21]=c*r[i+-180+7],c=n[18]-n[10],n[10]+=n[18],n[18]=c*r[i+-216+7],c=n[19]-n[11],n[11]+=n[19],n[19]=c*r[i+-216+7],c=n[16]-n[12],n[12]+=n[16],n[16]=c*r[i+-252+7],c=n[17]-n[13],n[13]+=n[17],n[17]=c*r[i+-252+7],c=-n[20]+n[24],n[20]+=n[24],n[24]=c*r[i+-216+7],c=-n[21]+n[25],n[21]+=n[25],n[25]=c*r[i+-216+7],c=n[4]-n[8],n[4]+=n[8],n[8]=c*r[i+-216+7],c=n[5]-n[9],n[5]+=n[9],n[9]=c*r[i+-216+7],c=n[0]-n[12],n[0]+=n[12],n[12]=c*r[i+-72+7],c=n[1]-n[13],n[1]+=n[13],n[13]=c*r[i+-72+7],c=n[16]-n[28],n[16]+=n[28],n[28]=c*r[i+-72+7],c=-n[17]+n[29],n[17]+=n[29],n[29]=c*r[i+-72+7],c=J.SQRT2*(n[2]-n[10]),n[2]+=n[10],n[10]=c,c=J.SQRT2*(n[3]-n[11]),n[3]+=n[11],n[11]=c,c=J.SQRT2*(-n[18]+n[26]),n[18]+=n[26],n[26]=c-n[18],c=J.SQRT2*(-n[19]+n[27]),n[19]+=n[27],n[27]=c-n[19],c=n[2],n[19]-=n[3],n[3]-=c,n[2]=n[31]-c,n[31]+=c,c=n[3],n[11]-=n[19],n[18]-=c,n[3]=n[30]-c,n[30]+=c,c=n[18],n[27]-=n[11],n[19]-=c,n[18]=n[15]-c,n[15]+=c,c=n[19],n[10]-=c,n[19]=n[14]-c,n[14]+=c,c=n[10],n[11]-=c,n[10]=n[23]-c,n[23]+=c,c=n[11],n[26]-=c,n[11]=n[22]-c,n[22]+=c,c=n[26],n[27]-=c,n[26]=n[7]-c,n[7]+=c,c=n[27],n[27]=n[6]-c,n[6]+=c,c=J.SQRT2*(n[0]-n[4]),n[0]+=n[4],n[4]=c,c=J.SQRT2*(n[1]-n[5]),n[1]+=n[5],n[5]=c,c=J.SQRT2*(n[16]-n[20]),n[16]+=n[20],n[20]=c,c=J.SQRT2*(n[17]-n[21]),n[17]+=n[21],n[21]=c,c=-J.SQRT2*(n[8]-n[12]),n[8]+=n[12],n[12]=c-n[8],c=-J.SQRT2*(n[9]-n[13]),n[9]+=n[13],n[13]=c-n[9],c=-J.SQRT2*(n[25]-n[29]),n[25]+=n[29],n[29]=c-n[25],c=-J.SQRT2*(n[24]+n[28]),n[24]-=n[28],n[28]=c-n[24],c=n[24]-n[16],n[24]=c,c=n[20]-c,n[20]=c,c=n[28]-c,n[28]=c,c=n[25]-n[17],n[25]=c,c=n[21]-c,n[21]=c,c=n[29]-c,n[29]=c,c=n[17]-n[1],n[17]=c,c=n[9]-c,n[9]=c,c=n[25]-c,n[25]=c,c=n[5]-c,n[5]=c,c=n[21]-c,n[21]=c,c=n[13]-c,n[13]=c,c=n[29]-c,n[29]=c,c=n[1]-n[0],n[1]=c,c=n[16]-c,n[16]=c,c=n[17]-c,n[17]=c,c=n[8]-c,n[8]=c,c=n[9]-c,n[9]=c,c=n[24]-c,n[24]=c,c=n[25]-c,n[25]=c,c=n[4]-c,n[4]=c,c=n[5]-c,n[5]=c,c=n[20]-c,n[20]=c,c=n[21]-c,n[21]=c,c=n[12]-c;n[12]=c,c=n[13]-c,n[13]=c,c=n[28]-c,n[28]=c,c=n[29]-c,n[29]=c,c=n[0],n[0]+=n[31],n[31]-=c,c=n[1],n[1]+=n[30],n[30]-=c,c=n[16],n[16]+=n[15],n[15]-=c,c=n[17],n[17]+=n[14],n[14]-=c,c=n[8],n[8]+=n[23],n[23]-=c,c=n[9],n[9]+=n[22],n[22]-=c,c=n[24],n[24]+=n[7],n[7]-=c,c=n[25],n[25]+=n[6],n[6]-=c,c=n[4],n[4]+=n[27],n[27]-=c,c=n[5],n[5]+=n[26],n[26]-=c,c=n[20],n[20]+=n[11],n[11]-=c,c=n[21],n[21]+=n[10],n[10]-=c,c=n[12],n[12]+=n[19],n[19]-=c,c=n[13],n[13]+=n[18],n[18]-=c,c=n[28],n[28]+=n[3],n[3]-=c,c=n[29],n[29]+=n[2],n[2]-=c}function t(e,t){for(var n=0;n<3;n++){var r,i,s,o,l,u;o=e[t+6]*a[P.SHORT_TYPE][0]-e[t+15],r=e[t+0]*a[P.SHORT_TYPE][2]-e[t+9],i=o+r,s=o-r,o=e[t+15]*a[P.SHORT_TYPE][0]+e[t+6],r=e[t+9]*a[P.SHORT_TYPE][2]+e[t+0],l=o+r,u=-o+r,r=2.069978111953089e-11*(e[t+3]*a[P.SHORT_TYPE][1]-e[t+12]),o=2.069978111953089e-11*(e[t+12]*a[P.SHORT_TYPE][1]+e[t+3]),e[t+0]=1.90752519173728e-11*i+r,e[t+15]=1.90752519173728e-11*-l+o,s=.8660254037844387*s*1.907525191737281e-11,l=.5*l*1.907525191737281e-11+o,e[t+3]=s-l,e[t+6]=s+l,i=.5*i*1.907525191737281e-11-r,u=.8660254037844387*u*1.907525191737281e-11,e[t+9]=i+u,e[t+12]=i-u,t++}}function n(e,t,n){var r,i,a,s,l,u,_,f,c,h;a=n[17]-n[9],l=n[15]-n[11],u=n[14]-n[12],_=n[0]+n[8],f=n[1]+n[7],c=n[2]+n[6],h=n[3]+n[5],e[t+17]=_+c-h-(f-n[4]),i=(_+c-h)*o[19]+(f-n[4]),r=(a-l-u)*o[18],e[t+5]=r+i,e[t+6]=r-i,s=(n[16]-n[10])*o[18],f=f*o[19]+n[4],r=a*o[12]+s+l*o[13]+u*o[14],i=-_*o[16]+f-c*o[17]+h*o[15],e[t+1]=r+i,e[t+2]=r-i,r=a*o[13]-s-l*o[14]+u*o[12],i=-_*o[17]+f-c*o[15]+h*o[16],e[t+9]=r+i,e[t+10]=r-i,r=a*o[14]-s+l*o[12]-u*o[13],i=_*o[15]-f+c*o[16]-h*o[17],e[t+13]=r+i,e[t+14]=r-i;var d,m,p,v,b,g,y,S;d=n[8]-n[0],p=n[6]-n[2],v=n[5]-n[3],b=n[17]+n[9],g=n[16]+n[10],y=n[15]+n[11],S=n[14]+n[12],e[t+0]=b+y+S+(g+n[13]),r=(b+y+S)*o[19]-(g+n[13]),i=(d-p+v)*o[18],e[t+11]=r+i,e[t+12]=r-i,m=(n[7]-n[1])*o[18],g=n[13]-g*o[19],r=b*o[15]-g+y*o[16]+S*o[17],i=d*o[14]+m+p*o[12]+v*o[13],e[t+3]=r+i,e[t+4]=r-i,r=-b*o[17]+g-y*o[15]-S*o[16],i=d*o[13]+m-p*o[14]-v*o[12],e[t+7]=r+i,e[t+8]=r-i,r=-b*o[16]+g-y*o[17]-S*o[15],i=d*o[12]-m+p*o[13]-v*o[14],e[t+15]=r+i,e[t+16]=r-i}var r=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*J.SQRT2*.5/2384e-9,.017876148*J.SQRT2*.5/2384e-9,.003134727*J.SQRT2*.5/2384e-9,.002457142*J.SQRT2*.5/2384e-9,971317e-9*J.SQRT2*.5/2384e-9,218868e-9*J.SQRT2*.5/2384e-9,101566e-9*J.SQRT2*.5/2384e-9,13828e-9*J.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,49591e-9/2384e-9,1995.1556208053692,21458e-9/2384e-9,-69618e-9/2384e-9],a=[[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.40084909404969e-13,6.423305872147839e-13,2.382191739347918e-13,5.456116108943412e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758252e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558783e-12,8.371015190102974e-13,2.599706096327376e-13,-5.456116108943412e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758252e-12,-2.858043359288076e-12,-2.156177623817898e-12,-1.475637723558783e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347923e-13,-6.423305872147843e-13,-9.400849094049696e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049694e-13,-6.42330587214784e-13,-2.382191739347918e-13],[2.382191739347913e-13,6.423305872147834e-13,9.400849094049688e-13,1.122435026096556e-12,1.183840321267481e-12,1.122435026096556e-12,9.400849094049688e-13,6.423305872147841e-13,2.382191739347918e-13,5.456116108943413e-12,4.878985199565852e-12,4.240448995017367e-12,3.559909094758253e-12,2.858043359288075e-12,2.156177623817898e-12,1.475637723558782e-12,8.371015190102975e-13,2.599706096327376e-13,-5.461314069809755e-12,-4.921085770524055e-12,-4.343405037091838e-12,-3.732668368707687e-12,-3.093523840190885e-12,-2.430835727329465e-12,-1.734679010007751e-12,-9.74825365660928e-13,-2.797435120168326e-13,0,0,0,0,0,0,-2.283748241799531e-13,-4.037858874020686e-13,-2.146547464825323e-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531e-13,4.037858874020686e-13,2.146547464825323e-13,5.461314069809755e-12,4.921085770524055e-12,4.343405037091838e-12,3.732668368707687e-12,3.093523840190885e-12,2.430835727329466e-12,1.734679010007751e-12,9.74825365660928e-13,2.797435120168326e-13,-5.456116108943413e-12,-4.878985199565852e-12,-4.240448995017367e-12,-3.559909094758253e-12,-2.858043359288075e-12,-2.156177623817898e-12,-1.475637723558782e-12,-8.371015190102975e-13,-2.599706096327376e-13,-2.382191739347913e-13,-6.423305872147834e-13,-9.400849094049688e-13,-1.122435026096556e-12,-1.183840321267481e-12,-1.122435026096556e-12,-9.400849094049688e-13,-6.423305872147841e-13,-2.382191739347918e-13]],s=a[P.SHORT_TYPE],o=a[P.SHORT_TYPE],l=a[P.SHORT_TYPE],u=a[P.SHORT_TYPE],_=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(r,o,f){for(var c=o,h=286,d=0;d<r.channels_out;d++){for(var m=0;m<r.mode_gr;m++){for(var p,v=r.l3_side.tt[m][d],b=v.xr,g=0,y=r.sb_sample[d][1-m],S=0,k=0;k<9;k++)for(e(c,h,y[S]),e(c,h+32,y[S+1]),S+=2,h+=64,p=1;p<32;p+=2)y[S-1][p]*=-1;for(p=0;p<32;p++,g+=18){var E=v.block_type,w=r.sb_sample[d][m],R=r.sb_sample[d][1-m];if(0!=v.mixed_block_flag&&p<2&&(E=0),r.amp_filter[p]<1e-12)Z.fill(b,g+0,g+18,0);else{if(r.amp_filter[p]<1)for(var k=0;k<18;k++)R[k][_[p]]*=r.amp_filter[p];if(E==P.SHORT_TYPE){for(var k=-3;k<0;k++){var A=a[P.SHORT_TYPE][k+3];b[g+3*k+9]=w[9+k][_[p]]*A-w[8-k][_[p]],b[g+3*k+18]=w[14-k][_[p]]*A+w[15+k][_[p]],b[g+3*k+10]=w[15+k][_[p]]*A-w[14-k][_[p]],b[g+3*k+19]=R[2-k][_[p]]*A+R[3+k][_[p]],b[g+3*k+11]=R[3+k][_[p]]*A-R[2-k][_[p]],b[g+3*k+20]=R[8-k][_[p]]*A+R[9+k][_[p]]}t(b,g)}else{for(var T=i(18),k=-9;k<0;k++){var M,L;M=a[E][k+27]*R[k+9][_[p]]+a[E][k+36]*R[8-k][_[p]],L=a[E][k+9]*w[k+9][_[p]]-a[E][k+18]*w[8-k][_[p]],T[k+9]=M-L*s[3+k+9],T[k+18]=M*s[3+k+9]+L}n(b,g,T)}}if(E!=P.SHORT_TYPE&&0!=p)for(var k=7;k>=0;--k){var x,B;x=b[g+k]*l[20+k]+b[g+-1-k]*u[28+k],B=b[g+k]*u[28+k]-b[g+-1-k]*l[20+k],b[g+-1-k]=x,b[g+k]=B}}}if(c=f,h=286,1==r.mode_gr)for(var O=0;O<18;O++)Q.arraycopy(r.sb_sample[d][1][O],0,r.sb_sample[d][0][O],0,32)}}}function I(){this.thm=new N,this.en=new N}function P(){function e(e){var t,n;if(0==e.ATH.useAdjust)return void(e.ATH.adjust=1);if(n=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(n+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(n+=n,t+=t),2==e.mode_gr&&(n=Math.max(n,t)),n*=.5,(n*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var r=31.98*n+625e-6;e.ATH.adjust>=r?(e.ATH.adjust*=.075*r+.925,e.ATH.adjust<r&&(e.ATH.adjust=r)):e.ATH.adjustLimit>=r?e.ATH.adjust=r:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=r}}function t(e){var t,n;for(e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(n=0;n<e.channels_out;++n){var r=0|e.l3_side.tt[t][n].block_type;0!=e.l3_side.tt[t][n].mixed_block_flag&&(r=4),e.bitrate_blockType_Hist[e.bitrate_index][r]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][r]++,e.bitrate_blockType_Hist[15][5]++}}function n(e,t){var n,r,a=e.internal_flags;if(0==a.lame_encode_frame_init){var s,o,l=i(2014),u=i(2014);for(a.lame_encode_frame_init=1,s=0,o=0;s<286+576*(1+a.mode_gr);++s)s<576*a.mode_gr?(l[s]=0,2==a.channels_out&&(u[s]=0)):(l[s]=t[0][o],2==a.channels_out&&(u[s]=t[1][o]),++o);for(r=0;r<a.mode_gr;r++)for(n=0;n<a.channels_out;n++)a.l3_side.tt[r][n].block_type=P.SHORT_TYPE;m.mdct_sub48(a,l,u)}}var a=P.FFTOFFSET,o=P.MPG_MD_MS_LR,l=null;this.psy=null;var _=null,h=null,d=null;this.setModules=function(e,t,n,r){l=e,this.psy=t,_=t,h=r,d=n};var m=new C;this.lame_encode_mp3_frame=function(i,p,v,b,g,y){var S,k=u([2,2]);k[0][0]=new I,k[0][1]=new I,k[1][0]=new I,k[1][1]=new I;var E=u([2,2]);E[0][0]=new I,E[0][1]=new I,E[1][0]=new I,E[1][1]=new I;var w,R,A,T,M=[null,null],L=i.internal_flags,x=s([2,4]),B=[.5,.5],O=[[0,0],[0,0]],C=[[0,0],[0,0]];if(M[0]=p,M[1]=v,0==L.lame_encode_frame_init&&n(i,M),L.padding=0,(L.slot_lag-=L.frac_SpF)<0&&(L.slot_lag+=i.out_samplerate,L.padding=1),0!=L.psymodel){var D=[null,null],j=0,N=r(2);for(T=0;T<L.mode_gr;T++){for(A=0;A<L.channels_out;A++)D[A]=M[A],j=576+576*T-P.FFTOFFSET;if(0!=(i.VBR==f.vbr_mtrh||i.VBR==f.vbr_mt?_.L3psycho_anal_vbr(i,D,j,T,k,E,O[T],C[T],x[T],N):_.L3psycho_anal_ns(i,D,j,T,k,E,O[T],C[T],x[T],N)))return-4;for(i.mode==c.JOINT_STEREO&&(B[T]=x[T][2]+x[T][3],B[T]>0&&(B[T]=x[T][3]/B[T])),A=0;A<L.channels_out;A++){var U=L.l3_side.tt[T][A];U.block_type=N[A],U.mixed_block_flag=0}}}else for(T=0;T<L.mode_gr;T++)for(A=0;A<L.channels_out;A++)L.l3_side.tt[T][A].block_type=P.NORM_TYPE,L.l3_side.tt[T][A].mixed_block_flag=0,C[T][A]=O[T][A]=700;if(e(L),m.mdct_sub48(L,M[0],M[1]),L.mode_ext=P.MPG_MD_LR_LR,i.force_ms)L.mode_ext=P.MPG_MD_MS_LR;else if(i.mode==c.JOINT_STEREO){var F=0,V=0;for(T=0;T<L.mode_gr;T++)for(A=0;A<L.channels_out;A++)F+=C[T][A],V+=O[T][A];if(F<=1*V){var H=L.l3_side.tt[0],G=L.l3_side.tt[L.mode_gr-1];H[0].block_type==H[1].block_type&&G[0].block_type==G[1].block_type&&(L.mode_ext=P.MPG_MD_MS_LR)}}if(L.mode_ext==o?(w=E,R=C):(w=k,R=O),i.analysis&&null!=L.pinfo)for(T=0;T<L.mode_gr;T++)for(A=0;A<L.channels_out;A++)L.pinfo.ms_ratio[T]=L.ms_ratio[T],L.pinfo.ms_ener_ratio[T]=B[T],L.pinfo.blocktype[T][A]=L.l3_side.tt[T][A].block_type,L.pinfo.pe[T][A]=R[T][A],Q.arraycopy(L.l3_side.tt[T][A].xr,0,L.pinfo.xr[T][A],0,576),L.mode_ext==o&&(L.pinfo.ers[T][A]=L.pinfo.ers[T][A+2],Q.arraycopy(L.pinfo.energy[T][A+2],0,L.pinfo.energy[T][A],0,L.pinfo.energy[T][A].length));if(i.VBR==f.vbr_off||i.VBR==f.vbr_abr){var z,q;for(z=0;z<18;z++)L.nsPsy.pefirbuf[z]=L.nsPsy.pefirbuf[z+1];for(q=0,T=0;T<L.mode_gr;T++)for(A=0;A<L.channels_out;A++)q+=R[T][A];for(L.nsPsy.pefirbuf[18]=q,q=L.nsPsy.pefirbuf[9],z=0;z<9;z++)q+=(L.nsPsy.pefirbuf[z]+L.nsPsy.pefirbuf[18-z])*P.fircoef[z];for(q=3350*L.mode_gr*L.channels_out/q,T=0;T<L.mode_gr;T++)for(A=0;A<L.channels_out;A++)R[T][A]*=q}if(L.iteration_loop.iteration_loop(i,R,B,w),l.format_bitstream(i),S=l.copy_buffer(L,b,g,y,1),i.bWriteVbrTag&&h.addVbrFrame(i),i.analysis&&null!=L.pinfo){for(A=0;A<L.channels_out;A++){var Y;for(Y=0;Y<a;Y++)L.pinfo.pcmdata[A][Y]=L.pinfo.pcmdata[A][Y+i.framesize];for(Y=a;Y<1600;Y++)L.pinfo.pcmdata[A][Y]=M[A][Y-a]}d.set_frame_pinfo(i,w)}return t(L),S}}function D(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}function j(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[r(4),r(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new B}function N(){this.l=i(P.SBMAX_l),this.s=s([P.SBMAX_s,3]);var e=this;this.assign=function(t){Q.arraycopy(t.l,0,e.l,0,P.SBMAX_l);for(var n=0;n<P.SBMAX_s;n++)for(var r=0;r<3;r++)e.s[n][r]=t.s[n][r]}}function U(){this.last_en_subshort=s([4,9]),this.lastAttacks=r(4),this.pefirbuf=i(19),this.longfact=i(P.SBMAX_l),this.shortfact=i(P.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function F(){function e(){this.write_timing=0,this.ptr=0,this.buf=t(n)}var n=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=s([2,F.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,
this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new j,this.ms_ratio=i(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=r(2),this.CurrentStep=r(2),this.masking_lower=0,this.bv_scf=r(576),this.pseudohalf=r(te.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*F.BPC+1),this.itime=a(2),this.sideinfo_len=0,this.sb_sample=s([2,2,18,P.SBLIMIT]),this.amp_filter=i(32),this.header=new Array(F.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new M,this.minval_l=i(P.CBANDS),this.minval_s=i(P.CBANDS),this.nb_1=s([4,P.CBANDS]),this.nb_2=s([4,P.CBANDS]),this.nb_s1=s([4,P.CBANDS]),this.nb_s2=s([4,P.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=i(4),this.loudness_sq=s([2,2]),this.loudness_sq_save=i(2),this.mld_l=i(P.SBMAX_l),this.mld_s=i(P.SBMAX_s),this.bm_l=r(P.SBMAX_l),this.bo_l=r(P.SBMAX_l),this.bm_s=r(P.SBMAX_s),this.bo_s=r(P.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=o([P.CBANDS,2]),this.s3ind_s=o([P.CBANDS,2]),this.numlines_s=r(P.CBANDS),this.numlines_l=r(P.CBANDS),this.rnumlines_l=i(P.CBANDS),this.mld_cb_l=i(P.CBANDS),this.mld_cb_s=i(P.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=i(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=r(2),this.nsPsy=new U,this.VBR_seek_table=new D,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=o([16,5]),this.bitrate_blockType_Hist=o([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var l=0;l<this.en.length;l++)this.en[l]=new N;for(var l=0;l<this.thm.length;l++)this.thm[l]=new N;for(var l=0;l<this.header.length;l++)this.header[l]=new e}function V(){function e(e,t,n){var i,a,s,o=0;n<<=1;var l=t+n;i=4;do{var u,_,f,c,h,d,m;m=i>>1,c=i,h=i<<1,d=h+c,i=h<<1,a=t,s=a+m;do{var p,v,b,g;v=e[a+0]-e[a+c],p=e[a+0]+e[a+c],g=e[a+h]-e[a+d],b=e[a+h]+e[a+d],e[a+h]=p-b,e[a+0]=p+b,e[a+d]=v-g,e[a+c]=v+g,v=e[s+0]-e[s+c],p=e[s+0]+e[s+c],g=J.SQRT2*e[s+d],b=J.SQRT2*e[s+h],e[s+h]=p-b,e[s+0]=p+b,e[s+d]=v-g,e[s+c]=v+g,s+=i,a+=i}while(a<l);for(_=r[o+0],u=r[o+1],f=1;f<m;f++){var y,S;y=1-2*u*u,S=2*u*_,a=t+f,s=t+c-f;do{var k,E,w,p,v,R,b,A,g,T;E=S*e[a+c]-y*e[s+c],k=y*e[a+c]+S*e[s+c],v=e[a+0]-k,p=e[a+0]+k,R=e[s+0]-E,w=e[s+0]+E,E=S*e[a+d]-y*e[s+d],k=y*e[a+d]+S*e[s+d],g=e[a+h]-k,b=e[a+h]+k,T=e[s+h]-E,A=e[s+h]+E,E=u*b-_*T,k=_*b+u*T,e[a+h]=p-k,e[a+0]=p+k,e[s+d]=R-E,e[s+c]=R+E,E=_*A-u*g,k=u*A+_*g,e[s+h]=w-k,e[s+0]=w+k,e[a+d]=v-E,e[a+c]=v+E,s+=i,a+=i}while(a<l);y=_,_=y*r[o+0]-u*r[o+1],u=y*r[o+1]+u*r[o+0]}o+=2}while(i<n)}var t=i(P.BLKSIZE),n=i(P.BLKSIZE_s/2),r=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],a=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(t,r,i,s,o){for(var l=0;l<3;l++){var u=P.BLKSIZE_s/2,_=65535&192*(l+1),f=P.BLKSIZE_s/8-1;do{var c,h,d,m,p,v=255&a[f<<2];c=n[v]*s[i][o+v+_],p=n[127-v]*s[i][o+v+_+128],h=c-p,c+=p,d=n[v+64]*s[i][o+v+_+64],p=n[63-v]*s[i][o+v+_+192],m=d-p,d+=p,u-=4,r[l][u+0]=c+d,r[l][u+2]=c-d,r[l][u+1]=h+m,r[l][u+3]=h-m,c=n[v+1]*s[i][o+v+_+1],p=n[126-v]*s[i][o+v+_+129],h=c-p,c+=p,d=n[v+65]*s[i][o+v+_+65],p=n[62-v]*s[i][o+v+_+193],m=d-p,d+=p,r[l][u+P.BLKSIZE_s/2+0]=c+d,r[l][u+P.BLKSIZE_s/2+2]=c-d,r[l][u+P.BLKSIZE_s/2+1]=h+m,r[l][u+P.BLKSIZE_s/2+3]=h-m}while(--f>=0);e(r[l],u,P.BLKSIZE_s/2)}},this.fft_long=function(n,r,i,s,o){var l=P.BLKSIZE/8-1,u=P.BLKSIZE/2;do{var _,f,c,h,d,m=255&a[l];_=t[m]*s[i][o+m],d=t[m+512]*s[i][o+m+512],f=_-d,_+=d,c=t[m+256]*s[i][o+m+256],d=t[m+768]*s[i][o+m+768],h=c-d,c+=d,u-=4,r[u+0]=_+c,r[u+2]=_-c,r[u+1]=f+h,r[u+3]=f-h,_=t[m+1]*s[i][o+m+1],d=t[m+513]*s[i][o+m+513],f=_-d,_+=d,c=t[m+257]*s[i][o+m+257],d=t[m+769]*s[i][o+m+769],h=c-d,c+=d,r[u+P.BLKSIZE/2+0]=_+c,r[u+P.BLKSIZE/2+2]=_-c,r[u+P.BLKSIZE/2+1]=f+h,r[u+P.BLKSIZE/2+3]=f-h}while(--l>=0);e(r,u,P.BLKSIZE/2)},this.init_fft=function(e){for(var r=0;r<P.BLKSIZE;r++)t[r]=.42-.5*Math.cos(2*Math.PI*(r+.5)/P.BLKSIZE)+.08*Math.cos(4*Math.PI*(r+.5)/P.BLKSIZE);for(var r=0;r<P.BLKSIZE_s/2;r++)n[r]=.5*(1-Math.cos(2*Math.PI*(r+.5)/P.BLKSIZE_s))}}function H(){function e(e){return e}function t(e,t){for(var n=0,r=0;r<P.BLKSIZE/2;++r)n+=e[r]*t.ATH.eql_w[r];return n*=ae}function n(n,r,i,a,s,o,l,u,_,f,c){var h=n.internal_flags;if(_<2)W.fft_long(h,a[s],_,f,c),W.fft_short(h,o[l],_,f,c);else if(2==_){for(var d=P.BLKSIZE-1;d>=0;--d){var m=a[s+0][d],p=a[s+1][d];a[s+0][d]=(m+p)*J.SQRT2*.5,a[s+1][d]=(m-p)*J.SQRT2*.5}for(var v=2;v>=0;--v)for(var d=P.BLKSIZE_s-1;d>=0;--d){var m=o[l+0][v][d],p=o[l+1][v][d];o[l+0][v][d]=(m+p)*J.SQRT2*.5,o[l+1][v][d]=(m-p)*J.SQRT2*.5}}r[0]=e(a[s+0][0]),r[0]*=r[0];for(var d=P.BLKSIZE/2-1;d>=0;--d){var b=a[s+0][P.BLKSIZE/2-d],g=a[s+0][P.BLKSIZE/2+d];r[P.BLKSIZE/2-d]=e(.5*(b*b+g*g))}for(var v=2;v>=0;--v){i[v][0]=o[l+0][v][0],i[v][0]*=i[v][0];for(var d=P.BLKSIZE_s/2-1;d>=0;--d){var b=o[l+0][v][P.BLKSIZE_s/2-d],g=o[l+0][v][P.BLKSIZE_s/2+d];i[v][P.BLKSIZE_s/2-d]=e(.5*(b*b+g*g))}}for(var y=0,d=11;d<P.HBLKSIZE;d++)y+=r[d];if(h.tot_ener[_]=y,n.analysis){for(var d=0;d<P.HBLKSIZE;d++)h.pinfo.energy[u][_][d]=h.pinfo.energy_save[_][d],h.pinfo.energy_save[_][d]=r[d];h.pinfo.pe[u][_]=h.pe[_]}2==n.athaa_loudapprox&&_<2&&(h.loudness_sq[u][_]=h.loudness_sq_save[_],h.loudness_sq_save[_]=t(r,h))}function a(){Y=Math.pow(10,(ue+1)/16),X=Math.pow(10,(_e+1)/16),K=Math.pow(10,fe/10)}function o(e,t,n,r,i,a){var s;if(t>e){if(!(t<e*X))return e+t;s=t/e}else{if(e>=t*X)return e+t;s=e/t}if(e+=t,r+3<=6){if(s>=Y)return e;var o=0|J.FAST_LOG10_X(s,16);return e*de[o]}var o=0|J.FAST_LOG10_X(s,16);if(t=0!=a?i.ATH.cb_s[n]*i.ATH.adjust:i.ATH.cb_l[n]*i.ATH.adjust,e<K*t){if(e>t){var l,u;return l=1,o<=13&&(l=me[o]),u=J.FAST_LOG10_X(e/t,10/15),e*((he[o]-l)*u+l)}return o>13?e:e*me[o]}return e*he[o]}function l(e,t,n){var r;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(r=t>e?t/e:e/t,-2<=n&&n<=2){if(r>=Y)return e+t;var i=0|J.FAST_LOG10_X(r,16);return(e+t)*pe[i]}return r<X?e+t:(e<t&&(e=t),e)}function u(e,t){var n=e.internal_flags;if(n.channels_out>1){for(var r=0;r<P.SBMAX_l;r++){var i=n.thm[0].l[r],a=n.thm[1].l[r];n.thm[0].l[r]+=a*t,n.thm[1].l[r]+=i*t}for(var r=0;r<P.SBMAX_s;r++)for(var s=0;s<3;s++){var i=n.thm[0].s[r][s],a=n.thm[1].s[r][s];n.thm[0].s[r][s]+=a*t,n.thm[1].s[r][s]+=i*t}}}function h(e){for(var t=0;t<P.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var n=e.mld_l[t]*e.en[3].l[t],r=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],n));n=e.mld_l[t]*e.en[2].l[t];var i=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],n));e.thm[2].l[t]=r,e.thm[3].l[t]=i}for(var t=0;t<P.SBMAX_s;t++)for(var a=0;a<3;a++)if(!(e.thm[0].s[t][a]>1.58*e.thm[1].s[t][a]||e.thm[1].s[t][a]>1.58*e.thm[0].s[t][a])){var n=e.mld_s[t]*e.en[3].s[t][a],r=Math.max(e.thm[2].s[t][a],Math.min(e.thm[3].s[t][a],n));n=e.mld_s[t]*e.en[2].s[t][a];var i=Math.max(e.thm[3].s[t][a],Math.min(e.thm[2].s[t][a],n));e.thm[2].s[t][a]=r,e.thm[3].s[t][a]=i}}function d(e,t,n){var r=t,i=Math.pow(10,n);t*=2,r*=2;for(var a=0;a<P.SBMAX_l;a++){var s,o,l,u;if(u=e.ATH.cb_l[e.bm_l[a]]*i,s=Math.min(Math.max(e.thm[0].l[a],u),Math.max(e.thm[1].l[a],u)),o=Math.max(e.thm[2].l[a],u),l=Math.max(e.thm[3].l[a],u),s*t<o+l){var _=s*r/(o+l);o*=_,l*=_}e.thm[2].l[a]=Math.min(o,e.thm[2].l[a]),e.thm[3].l[a]=Math.min(l,e.thm[3].l[a])}i*=P.BLKSIZE_s/P.BLKSIZE;for(var a=0;a<P.SBMAX_s;a++)for(var f=0;f<3;f++){var s,o,l,u;if(u=e.ATH.cb_s[e.bm_s[a]]*i,s=Math.min(Math.max(e.thm[0].s[a][f],u),Math.max(e.thm[1].s[a][f],u)),o=Math.max(e.thm[2].s[a][f],u),l=Math.max(e.thm[3].s[a][f],u),s*t<o+l){var _=s*t/(o+l);o*=_,l*=_}e.thm[2].s[a][f]=Math.min(e.thm[2].s[a][f],o),e.thm[3].s[a][f]=Math.min(e.thm[3].s[a][f],l)}}function m(e,t,n,r,i){var a,s,o=0,l=0;for(a=s=0;a<P.SBMAX_s;++s,++a){for(var u=e.bo_s[a],_=e.npart_s,f=u<_?u:_;s<f;)o+=t[s],l+=n[s],s++;if(e.en[r].s[a][i]=o,e.thm[r].s[a][i]=l,s>=_){++a;break}var c=e.PSY.bo_s_weight[a],h=1-c;o=c*t[s],l=c*n[s],e.en[r].s[a][i]+=o,e.thm[r].s[a][i]+=l,o=h*t[s],l=h*n[s]}for(;a<P.SBMAX_s;++a)e.en[r].s[a][i]=0,e.thm[r].s[a][i]=0}function p(e,t,n,r){var i,a,s=0,o=0;for(i=a=0;i<P.SBMAX_l;++a,++i){for(var l=e.bo_l[i],u=e.npart_l,_=l<u?l:u;a<_;)s+=t[a],o+=n[a],a++;if(e.en[r].l[i]=s,e.thm[r].l[i]=o,a>=u){++i;break}var f=e.PSY.bo_l_weight[i],c=1-f;s=f*t[a],o=f*n[a],e.en[r].l[i]+=s,e.thm[r].l[i]+=o,s=c*t[a],o=c*n[a]}for(;i<P.SBMAX_l;++i)e.en[r].l[i]=0,e.thm[r].l[i]=0}function v(e,t,n,r,i,a){var s,o,l=e.internal_flags;for(o=s=0;o<l.npart_s;++o){for(var u=0,_=0,f=l.numlines_s[o],c=0;c<f;++c,++s){var h=t[a][s];u+=h,_<h&&(_=h)}n[o]=u}for(s=o=0;o<l.npart_s;o++){var d=l.s3ind_s[o][0],m=l.s3_ss[s++]*n[d];for(++d;d<=l.s3ind_s[o][1];)m+=l.s3_ss[s]*n[d],++s,++d;var p=ne*l.nb_s1[i][o];if(r[o]=Math.min(m,p),l.blocktype_old[1&i]==P.SHORT_TYPE){var p=re*l.nb_s2[i][o],v=r[o];r[o]=Math.min(p,v)}l.nb_s2[i][o]=l.nb_s1[i][o],l.nb_s1[i][o]=m}for(;o<=P.CBANDS;++o)n[o]=0,r[o]=0}function b(e,t,n,r){var i=e.internal_flags;e.short_blocks!=_.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var a=0;a<i.channels_out;a++)r[a]=P.NORM_TYPE,e.short_blocks==_.short_block_dispensed&&(t[a]=1),e.short_blocks==_.short_block_forced&&(t[a]=0),0!=t[a]?i.blocktype_old[a]==P.SHORT_TYPE&&(r[a]=P.STOP_TYPE):(r[a]=P.SHORT_TYPE,i.blocktype_old[a]==P.NORM_TYPE&&(i.blocktype_old[a]=P.START_TYPE),i.blocktype_old[a]==P.STOP_TYPE&&(i.blocktype_old[a]=P.SHORT_TYPE)),n[a]=i.blocktype_old[a],i.blocktype_old[a]=r[a]}function g(e,t,n){return n>=1?e:n<=0?t:t>0?Math.pow(e/t,n)*t:0}function y(e,t){for(var n=309.07,r=0;r<P.SBMAX_s-1;r++)for(var i=0;i<3;i++){var a=e.thm.s[r][i];if(a>0){var s=a*t,o=e.en.s[r][i];o>s&&(n+=o>1e10*s?ve[r]*(10*Q):ve[r]*J.FAST_LOG10(o/s))}}return n}function S(e,t){for(var n=281.0575,r=0;r<P.SBMAX_l-1;r++){var i=e.thm.l[r];if(i>0){var a=i*t,s=e.en.l[r];s>a&&(n+=s>1e10*a?be[r]*(10*Q):be[r]*J.FAST_LOG10(s/a))}}return n}function k(e,t,n,r,i){var a,s;for(a=s=0;a<e.npart_l;++a){var o,l=0,u=0;for(o=0;o<e.numlines_l[a];++o,++s){var _=t[s];l+=_,u<_&&(u=_)}n[a]=l,r[a]=u,i[a]=l*e.rnumlines_l[a]}}function E(e,t,n,r){var i=ce.length-1,a=0,s=n[a]+n[a+1];if(s>0){var o=t[a];o<t[a+1]&&(o=t[a+1]),s=20*(2*o-s)/(s*(e.numlines_l[a]+e.numlines_l[a+1]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0;for(a=1;a<e.npart_l-1;a++)if((s=n[a-1]+n[a]+n[a+1])>0){var o=t[a-1];o<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),s=20*(3*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]+e.numlines_l[a+1]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0;if((s=n[a-1]+n[a])>0){var o=t[a-1];o<t[a]&&(o=t[a]),s=20*(2*o-s)/(s*(e.numlines_l[a-1]+e.numlines_l[a]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0}function w(t,n,r,i,a,s,o,l){var u=t.internal_flags;if(i<2)W.fft_long(u,o[l],i,n,r);else if(2==i)for(var _=P.BLKSIZE-1;_>=0;--_){var f=o[l+0][_],c=o[l+1][_];o[l+0][_]=(f+c)*J.SQRT2*.5,o[l+1][_]=(f-c)*J.SQRT2*.5}s[0]=e(o[l+0][0]),s[0]*=s[0];for(var _=P.BLKSIZE/2-1;_>=0;--_){var h=o[l+0][P.BLKSIZE/2-_],d=o[l+0][P.BLKSIZE/2+_];s[P.BLKSIZE/2-_]=e(.5*(h*h+d*d))}for(var m=0,_=11;_<P.HBLKSIZE;_++)m+=s[_];if(u.tot_ener[i]=m,t.analysis){for(var _=0;_<P.HBLKSIZE;_++)u.pinfo.energy[a][i][_]=u.pinfo.energy_save[i][_],u.pinfo.energy_save[i][_]=s[_];u.pinfo.pe[a][i]=u.pe[i]}}function R(t,n,r,i,a,s,o,l){var u=t.internal_flags;if(0==a&&i<2&&W.fft_short(u,o[l],i,n,r),2==i)for(var _=P.BLKSIZE_s-1;_>=0;--_){var f=o[l+0][a][_],c=o[l+1][a][_];o[l+0][a][_]=(f+c)*J.SQRT2*.5,o[l+1][a][_]=(f-c)*J.SQRT2*.5}s[a][0]=o[l+0][a][0],s[a][0]*=s[a][0];for(var _=P.BLKSIZE_s/2-1;_>=0;--_){var h=o[l+0][a][P.BLKSIZE_s/2-_],d=o[l+0][a][P.BLKSIZE_s/2+_];s[a][P.BLKSIZE_s/2-_]=e(.5*(h*h+d*d))}}function A(e,n,r,i){var a=e.internal_flags;2==e.athaa_loudapprox&&r<2&&(a.loudness_sq[n][r]=a.loudness_sq_save[r],a.loudness_sq_save[r]=t(i,a))}function T(e,t,n,r,a,o,l,u,_,f){for(var h=s([2,576]),d=e.internal_flags,m=d.channels_out,p=e.mode==c.JOINT_STEREO?4:m,v=0;v<m;v++){firbuf=t[v];for(var b=n+576-350-oe+192,g=0;g<576;g++){var y,S;y=firbuf[b+g+10],S=0;for(var k=0;k<(oe-1)/2-1;k+=2)y+=ye[k]*(firbuf[b+g+k]+firbuf[b+g+oe-k]),S+=ye[k+1]*(firbuf[b+g+k+1]+firbuf[b+g+oe-k-1]);h[v][g]=y+S}a[r][v].en.assign(d.en[v]),a[r][v].thm.assign(d.thm[v]),p>2&&(o[r][v].en.assign(d.en[v+2]),o[r][v].thm.assign(d.thm[v+2]))}for(var v=0;v<p;v++){var E=i(12),w=i(12),R=[0,0,0,0],A=h[1&v],T=0,M=3==v?d.nsPsy.attackthre_s:d.nsPsy.attackthre,L=1;if(2==v)for(var g=0,k=576;k>0;++g,--k){var x=h[0][g],B=h[1][g];h[0][g]=x+B,h[1][g]=x-B}for(var g=0;g<3;g++)w[g]=d.nsPsy.last_en_subshort[v][g+6],E[g]=w[g]/d.nsPsy.last_en_subshort[v][g+4],R[0]+=w[g];for(var g=0;g<9;g++){for(var O=T+64,C=1;T<O;T++)C<Math.abs(A[T])&&(C=Math.abs(A[T]));d.nsPsy.last_en_subshort[v][g]=w[g+3]=C,R[1+g/3]+=C,C>w[g+3-2]?C/=w[g+3-2]:C=w[g+3-2]>10*C?w[g+3-2]/(10*C):0,E[g+3]=C}for(var g=0;g<3;++g){var I=w[3*g+3]+w[3*g+4]+w[3*g+5],P=1;6*w[3*g+5]<I&&(P*=.5,6*w[3*g+4]<I&&(P*=.5)),u[v][g]=P}if(e.analysis){for(var D=E[0],g=1;g<12;g++)D<E[g]&&(D=E[g]);d.pinfo.ers[r][v]=d.pinfo.ers_save[v],d.pinfo.ers_save[v]=D}for(var g=0;g<12;g++)0==_[v][g/3]&&E[g]>M&&(_[v][g/3]=g%3+1);for(var g=1;g<4;g++){var j=R[g-1],N=R[g];Math.max(j,N)<4e4&&j<1.7*N&&N<1.7*j&&(1==g&&_[v][0]<=_[v][g]&&(_[v][0]=0),_[v][g]=0)}_[v][0]<=d.nsPsy.lastAttacks[v]&&(_[v][0]=0),3!=d.nsPsy.lastAttacks[v]&&_[v][0]+_[v][1]+_[v][2]+_[v][3]==0||(L=0,0!=_[v][1]&&0!=_[v][0]&&(_[v][1]=0),0!=_[v][2]&&0!=_[v][1]&&(_[v][2]=0),0!=_[v][3]&&0!=_[v][2]&&(_[v][3]=0)),v<2?f[v]=L:0==L&&(f[0]=f[1]=0),l[v]=d.tot_ener[v]}}function M(e,t,n){if(0==n)for(var r=0;r<e.npart_s;r++)e.nb_s2[t][r]=e.nb_s1[t][r],e.nb_s1[t][r]=0}function L(e,t){for(var n=0;n<e.npart_l;n++)e.nb_2[t][n]=e.nb_1[t][n],e.nb_1[t][n]=0}function x(e,t,n,r){var i=ce.length-1,a=0,s=n[a]+n[a+1];if(s>0){var o=t[a];o<t[a+1]&&(o=t[a+1]),s=20*(2*o-s)/(s*(e.numlines_s[a]+e.numlines_s[a+1]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0;for(a=1;a<e.npart_s-1;a++)if((s=n[a-1]+n[a]+n[a+1])>0){var o=t[a-1];o<t[a]&&(o=t[a]),o<t[a+1]&&(o=t[a+1]),s=20*(3*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]+e.numlines_s[a+1]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0;if((s=n[a-1]+n[a])>0){var o=t[a-1];o<t[a]&&(o=t[a]),s=20*(2*o-s)/(s*(e.numlines_s[a-1]+e.numlines_s[a]-1));var l=0|s;l>i&&(l=i),r[a]=l}else r[a]=0}function B(e,t,n,r,a,s){var o,u,_,f=e.internal_flags,c=new float[P.CBANDS],h=i(P.CBANDS),d=new int[P.CBANDS];for(_=u=0;_<f.npart_s;++_){var m=0,p=0,v=f.numlines_s[_];for(o=0;o<v;++o,++u){var b=t[s][u];m+=b,p<b&&(p=b)}n[_]=m,c[_]=p,h[_]=m/v}for(;_<P.CBANDS;++_)c[_]=0,h[_]=0;for(x(f,c,h,d),u=_=0;_<f.npart_s;_++){var g,y,S,k,E,w=f.s3ind_s[_][0],R=f.s3ind_s[_][1];for(g=d[w],y=1,k=f.s3_ss[u]*n[w]*ce[d[w]],++u,++w;w<=R;)g+=d[w],y+=1,S=f.s3_ss[u]*n[w]*ce[d[w]],k=l(k,S,w-_),++u,++w;g=(1+2*g)/(2*y),E=.5*ce[g],k*=E,r[_]=k,f.nb_s2[a][_]=f.nb_s1[a][_],f.nb_s1[a][_]=k,S=c[_],S*=f.minval_s[_],S*=E,r[_]>S&&(r[_]=S),f.masking_lower>1&&(r[_]*=f.masking_lower),r[_]>n[_]&&(r[_]=n[_]),f.masking_lower<1&&(r[_]*=f.masking_lower)}for(;_<P.CBANDS;++_)n[_]=0,r[_]=0}function O(e,t,n,a,s){var o,u=i(P.CBANDS),_=i(P.CBANDS),f=r(P.CBANDS+2);k(e,t,n,u,_),E(e,u,_,f);var c=0;for(o=0;o<e.npart_l;o++){var h,d,m,p,v=e.s3ind[o][0],b=e.s3ind[o][1],g=0,y=0;for(g=f[v],y+=1,d=e.s3_ll[c]*n[v]*ce[f[v]],++c,++v;v<=b;)g+=f[v],y+=1,h=e.s3_ll[c]*n[v]*ce[f[v]],p=l(d,h,v-o),d=p,++c,++v;if(g=(1+2*g)/(2*y),m=.5*ce[g],d*=m,e.blocktype_old[1&s]==P.SHORT_TYPE){var S=ee*e.nb_1[s][o];a[o]=S>0?Math.min(d,S):Math.min(d,n[o]*se)}else{var S,w=te*e.nb_2[s][o],R=ee*e.nb_1[s][o];w<=0&&(w=d),R<=0&&(R=d),S=e.blocktype_old[1&s]==P.NORM_TYPE?Math.min(R,w):R,a[o]=Math.min(d,S)}e.nb_2[s][o]=e.nb_1[s][o],e.nb_1[s][o]=d,h=u[o],h*=e.minval_l[o],h*=m,a[o]>h&&(a[o]=h),e.masking_lower>1&&(a[o]*=e.masking_lower),a[o]>n[o]&&(a[o]=n[o]),e.masking_lower<1&&(a[o]*=e.masking_lower)}for(;o<P.CBANDS;++o)n[o]=0,a[o]=0}function C(e,t){var n=e.internal_flags;e.short_blocks!=_.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var r=0;r<n.channels_out;r++)e.short_blocks==_.short_block_dispensed&&(t[r]=1),e.short_blocks==_.short_block_forced&&(t[r]=0)}function I(e,t,n){for(var r=e.internal_flags,i=0;i<r.channels_out;i++){var a=P.NORM_TYPE;0!=t[i]?r.blocktype_old[i]==P.SHORT_TYPE&&(a=P.STOP_TYPE):(a=P.SHORT_TYPE,r.blocktype_old[i]==P.NORM_TYPE&&(r.blocktype_old[i]=P.START_TYPE),r.blocktype_old[i]==P.STOP_TYPE&&(r.blocktype_old[i]=P.SHORT_TYPE)),n[i]=r.blocktype_old[i],r.blocktype_old[i]=a}}function D(e,t,n,r,i,a,s){for(var o,l,u=2*a,_=a>0?Math.pow(10,i):1,f=0;f<s;++f){var c=e[2][f],h=e[3][f],d=t[0][f],m=t[1][f],p=t[2][f],v=t[3][f];if(d<=1.58*m&&m<=1.58*d){var b=n[f]*h,g=n[f]*c;l=Math.max(p,Math.min(v,b)),o=Math.max(v,Math.min(p,g))}else l=p,o=v;if(a>0){var y,S,k=r[f]*_;if(y=Math.min(Math.max(d,k),Math.max(m,k)),p=Math.max(l,k),v=Math.max(o,k),(S=p+v)>0&&y*u<S){var E=y*u/S;p*=E,v*=E}l=Math.min(p,l),o=Math.min(v,o)}l>c&&(l=c),o>h&&(o=h),t[2][f]=l,t[3][f]=o}}function j(e,t){var n,r=e;return n=r>=0?27*-r:r*t,n<=-72?0:Math.exp(n*le)}function N(e){var t,n,r=0,i=0,a=0;for(a=0;j(a,e)>1e-20;a-=1);for(t=a,n=0;Math.abs(n-t)>1e-12;)a=(n+t)/2,j(a,e)>0?n=a:t=a;r=t;var t,n,a=0;for(a=0;j(a,e)>1e-20;a+=1);for(t=0,n=a;Math.abs(n-t)>1e-12;)a=(n+t)/2,j(a,e)>0?t=a:n=a;i=n;var s,o=0;for(s=0;s<=1e3;++s){var a=r+s*(i-r)/1e3;o+=j(a,e)}return 1001/(o*(i-r))}function U(e){var t,n,r,i;return t=e,t*=t>=0?3:1.5,t>=.5&&t<=2.5?(i=t-.5,n=8*(i*i-2*i)):n=0,t+=.474,(r=15.811389+7.5*t-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((n+r)*le),t/=.6609193)}function F(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function H(e,t,n,a,s,o,l,u,_,f,c,h){var d,m=i(P.CBANDS+1),p=u/(h>15?1152:384),v=r(P.HBLKSIZE);u/=_;var b=0,g=0;for(d=0;d<P.CBANDS;d++){var y,S;for(y=F(u*b),m[d]=u*b,S=b;F(u*S)-y<ie&&S<=_/2;S++);for(e[d]=S-b,g=d+1;b<S;)v[b++]=d;if(b>_/2){b=_/2,++d;break}}m[d]=u*b;for(var k=0;k<h;k++){var E,w,R,A,T;R=f[k],A=f[k+1],E=0|Math.floor(.5+c*(R-.5)),E<0&&(E=0),w=0|Math.floor(.5+c*(A-.5)),w>_/2&&(w=_/2),n[k]=(v[E]+v[w])/2,t[k]=v[w];var M=p*A;l[k]=(M-m[t[k]])/(m[t[k]+1]-m[t[k]]),l[k]<0?l[k]=0:l[k]>1&&(l[k]=1),T=F(u*f[k]*c),T=Math.min(T,15.5)/15.5,o[k]=Math.pow(10,1.25*(1-Math.cos(Math.PI*T))-2.5)}b=0;for(var L=0;L<g;L++){var y,x,B=e[L];y=F(u*b),x=F(u*(b+B-1)),a[L]=.5*(y+x),y=F(u*(b-.5)),x=F(u*(b+B-.5)),s[L]=x-y,b+=B}return g}function G(e,t,n,r,a,o){var l,u=s([P.CBANDS,P.CBANDS]),_=0;if(o)for(var f=0;f<t;f++)for(l=0;l<t;l++){var c=U(n[f]-n[l])*r[l];u[f][l]=c*a[f]}else for(l=0;l<t;l++)for(var h=15+Math.min(21/n[l],12),d=N(h),f=0;f<t;f++){var c=d*j(n[f]-n[l],h)*r[l];u[f][l]=c*a[f]}for(var f=0;f<t;f++){for(l=0;l<t&&!(u[f][l]>0);l++);for(e[f][0]=l,l=t-1;l>0&&!(u[f][l]>0);l--);e[f][1]=l,_+=e[f][1]-e[f][0]+1}for(var m=i(_),p=0,f=0;f<t;f++)for(l=e[f][0];l<=e[f][1];l++)m[p++]=u[f][l];return m}function z(e){var t=F(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function q(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}var Y,X,K,W=new V,Q=2.302585092994046,ee=2,te=16,ne=2,re=16,ie=.34,ae=1/217621504/(P.BLKSIZE/2),se=.3,oe=21,le=.2302585093,ue=8,_e=23,fe=15,ce=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],he=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],de=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],me=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],pe=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],ve=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],be=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],ge=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_ns=function(e,t,a,l,_,w,R,A,T,M){var L,x,B,O,C,I,D,j,N,U=e.internal_flags,F=s([2,P.BLKSIZE]),V=s([2,3,P.BLKSIZE_s]),H=i(P.CBANDS+1),G=i(P.CBANDS+1),z=i(P.CBANDS+2),q=r(2),Y=r(2),X=s([2,576]),K=r(P.CBANDS+2),W=r(P.CBANDS+2);for(Z.fill(W,0),L=U.channels_out,e.mode==c.JOINT_STEREO&&(L=4),N=e.VBR==f.vbr_off?0==U.ResvMax?0:U.ResvSize/U.ResvMax*.5:e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh||e.VBR==f.vbr_mt?.6:1,x=0;x<U.channels_out;x++){var Q=t[x],J=a+576-350-oe+192;for(O=0;O<576;O++){var $,ne;for($=Q[J+O+10],ne=0,C=0;C<(oe-1)/2-1;C+=2)$+=ge[C]*(Q[J+O+C]+Q[J+O+oe-C]),ne+=ge[C+1]*(Q[J+O+C+1]+Q[J+O+oe-C-1]);X[x][O]=$+ne}_[l][x].en.assign(U.en[x]),_[l][x].thm.assign(U.thm[x]),L>2&&(w[l][x].en.assign(U.en[x+2]),w[l][x].thm.assign(U.thm[x+2]))}for(x=0;x<L;x++){var re,ie,ae,le=i(12),ue=[0,0,0,0],_e=i(12),fe=1,he=i(P.CBANDS),de=i(P.CBANDS),me=[0,0,0,0],pe=i(P.HBLKSIZE),ve=s([3,P.HBLKSIZE_s]);for(O=0;O<3;O++)le[O]=U.nsPsy.last_en_subshort[x][O+6],_e[O]=le[O]/U.nsPsy.last_en_subshort[x][O+4],ue[0]+=le[O];if(2==x)for(O=0;O<576;O++){var be,ye;be=X[0][O],ye=X[1][O],X[0][O]=be+ye,X[1][O]=be-ye}var Se=X[1&x],ke=0;for(O=0;O<9;O++){for(var Ee=ke+64,we=1;ke<Ee;ke++)we<Math.abs(Se[ke])&&(we=Math.abs(Se[ke]));U.nsPsy.last_en_subshort[x][O]=le[O+3]=we,ue[1+O/3]+=we,we>le[O+3-2]?we/=le[O+3-2]:we=le[O+3-2]>10*we?le[O+3-2]/(10*we):0,_e[O+3]=we}if(e.analysis){var Re=_e[0];for(O=1;O<12;O++)Re<_e[O]&&(Re=_e[O]);U.pinfo.ers[l][x]=U.pinfo.ers_save[x],U.pinfo.ers_save[x]=Re}for(ae=3==x?U.nsPsy.attackthre_s:U.nsPsy.attackthre,O=0;O<12;O++)0==me[O/3]&&_e[O]>ae&&(me[O/3]=O%3+1);for(O=1;O<4;O++){var Ae;Ae=ue[O-1]>ue[O]?ue[O-1]/ue[O]:ue[O]/ue[O-1],Ae<1.7&&(me[O]=0,1==O&&(me[0]=0))}for(0!=me[0]&&0!=U.nsPsy.lastAttacks[x]&&(me[0]=0),3!=U.nsPsy.lastAttacks[x]&&me[0]+me[1]+me[2]+me[3]==0||(fe=0,0!=me[1]&&0!=me[0]&&(me[1]=0),0!=me[2]&&0!=me[1]&&(me[2]=0),0!=me[3]&&0!=me[2]&&(me[3]=0)),x<2?Y[x]=fe:0==fe&&(Y[0]=Y[1]=0),T[x]=U.tot_ener[x],ie=V,re=F,n(e,pe,ve,re,1&x,ie,1&x,l,x,t,a),k(U,pe,H,he,de),E(U,he,de,K),j=0;j<3;j++){var Te,Me;for(v(e,ve,G,z,x,j),m(U,G,z,x,j),D=0;D<P.SBMAX_s;D++){if(Me=U.thm[x].s[D][j],Me*=.8,me[j]>=2||1==me[j+1]){var Le=0!=j?j-1:2,we=g(U.thm[x].s[D][Le],Me,.6*N);Me=Math.min(Me,we)}if(1==me[j]){var Le=0!=j?j-1:2,we=g(U.thm[x].s[D][Le],Me,se*N);Me=Math.min(Me,we)}else if(0!=j&&3==me[j-1]||0==j&&3==U.nsPsy.lastAttacks[x]){var Le=2!=j?j+1:0,we=g(U.thm[x].s[D][Le],Me,se*N);Me=Math.min(Me,we)}Te=le[3*j+3]+le[3*j+4]+le[3*j+5],6*le[3*j+5]<Te&&(Me*=.5,6*le[3*j+4]<Te&&(Me*=.5)),U.thm[x].s[D][j]=Me}}for(U.nsPsy.lastAttacks[x]=me[2],I=0,B=0;B<U.npart_l;B++){for(var xe=U.s3ind[B][0],Be=H[xe]*ce[K[xe]],Oe=U.s3_ll[I++]*Be;++xe<=U.s3ind[B][1];)Be=H[xe]*ce[K[xe]],Oe=o(Oe,U.s3_ll[I++]*Be,xe,xe-B,U,0);Oe*=.158489319246111,U.blocktype_old[1&x]==P.SHORT_TYPE?z[B]=Oe:z[B]=g(Math.min(Oe,Math.min(ee*U.nb_1[x][B],te*U.nb_2[x][B])),Oe,N),U.nb_2[x][B]=U.nb_1[x][B],U.nb_1[x][B]=Oe}for(;B<=P.CBANDS;++B)H[B]=0,z[B]=0;p(U,H,z,x)}if(e.mode!=c.STEREO&&e.mode!=c.JOINT_STEREO||e.interChRatio>0&&u(e,e.interChRatio),e.mode==c.JOINT_STEREO){var Ce;h(U),Ce=e.msfix,Math.abs(Ce)>0&&d(U,Ce,e.ATHlower*U.ATH.adjust)}for(b(e,Y,M,q),x=0;x<L;x++){var Ie,Pe,De,je=0;x>1?(Ie=A,je=-2,Pe=P.NORM_TYPE,M[0]!=P.SHORT_TYPE&&M[1]!=P.SHORT_TYPE||(Pe=P.SHORT_TYPE),De=w[l][x-2]):(Ie=R,je=0,Pe=M[x],De=_[l][x]),Pe==P.SHORT_TYPE?Ie[je+x]=y(De,U.masking_lower):Ie[je+x]=S(De,U.masking_lower),e.analysis&&(U.pinfo.pe[l][x]=Ie[je+x])}return 0};var ye=[-1.730326e-17,-.01703172,-1.349528e-17,.0418072,-6.73278e-17,-.0876324,-3.0835e-17,.1863476,-1.104424e-16,-.627638];this.L3psycho_anal_vbr=function(e,t,n,a,o,l,u,_,f,h){var d,v,b=e.internal_flags,k=i(P.HBLKSIZE),E=s([3,P.HBLKSIZE_s]),x=s([2,P.BLKSIZE]),j=s([2,3,P.BLKSIZE_s]),N=s([4,P.CBANDS]),U=s([4,P.CBANDS]),F=s([4,3]),V=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],H=r(2),G=e.mode==c.JOINT_STEREO?4:b.channels_out;T(e,t,n,a,o,l,f,F,V,H),C(e,H);for(var z=0;z<G;z++){var q=1&z;d=x,w(e,t,n,z,a,k,d,q),A(e,a,z,k),0!=H[q]?O(b,k,N[z],U[z],z):L(b,z)}H[0]+H[1]==2&&e.mode==c.JOINT_STEREO&&D(N,U,b.mld_cb_l,b.ATH.cb_l,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_l);for(var z=0;z<G;z++){var q=1&z;0!=H[q]&&p(b,N[z],U[z],z)}for(var Y=0;Y<3;Y++){for(var z=0;z<G;++z){var q=1&z;0!=H[q]?M(b,z,Y):(v=j,R(e,t,n,z,Y,E,v,q),B(e,E,N[z],U[z],z,Y))}H[0]+H[1]==0&&e.mode==c.JOINT_STEREO&&D(N,U,b.mld_cb_s,b.ATH.cb_s,e.ATHlower*b.ATH.adjust,e.msfix,b.npart_s);for(var z=0;z<G;++z){var q=1&z;0==H[q]&&m(b,N[z],U[z],z,Y)}}for(var z=0;z<G;z++){var q=1&z;if(0==H[q])for(var X=0;X<P.SBMAX_s;X++){for(var K=i(3),Y=0;Y<3;Y++){var W=b.thm[z].s[X][Y];if(W*=.8,V[z][Y]>=2||1==V[z][Y+1]){var Z=0!=Y?Y-1:2,Q=g(b.thm[z].s[X][Z],W,.36);W=Math.min(W,Q)}else if(1==V[z][Y]){var Z=0!=Y?Y-1:2,Q=g(b.thm[z].s[X][Z],W,.6*se);W=Math.min(W,Q)}else if(0!=Y&&3==V[z][Y-1]||0==Y&&3==b.nsPsy.lastAttacks[z]){var Z=2!=Y?Y+1:0,Q=g(b.thm[z].s[X][Z],W,.6*se);W=Math.min(W,Q)}W*=F[z][Y],K[Y]=W}for(var Y=0;Y<3;Y++)b.thm[z].s[X][Y]=K[Y]}}for(var z=0;z<G;z++)b.nsPsy.lastAttacks[z]=V[z][2];I(e,H,h);for(var z=0;z<G;z++){var J,$,ee,te;z>1?(J=_,$=-2,ee=P.NORM_TYPE,h[0]!=P.SHORT_TYPE&&h[1]!=P.SHORT_TYPE||(ee=P.SHORT_TYPE),te=l[a][z-2]):(J=u,$=0,ee=h[z],te=o[a][z]),ee==P.SHORT_TYPE?J[$+z]=y(te,b.masking_lower):J[$+z]=S(te,b.masking_lower),e.analysis&&(b.pinfo.pe[a][z]=J[$+z])}return 0},this.psymodel_init=function(e){var t,n=e.internal_flags,r=!0,s=13,o=0,l=0,u=-8.25,_=-4.5,c=i(P.CBANDS),h=i(P.CBANDS),d=i(P.CBANDS),m=e.out_samplerate;switch(e.experimentalZ){default:case 0:r=!0;break;case 1:r=e.VBR!=f.vbr_mtrh&&e.VBR!=f.vbr_mt;break;case 2:r=!1;break;case 3:s=8,o=-1.75,l=-.0125,u=-8.25,_=-2.25}for(n.ms_ener_ratio_old=.25,n.blocktype_old[0]=n.blocktype_old[1]=P.NORM_TYPE,t=0;t<4;++t){for(var p=0;p<P.CBANDS;++p)n.nb_1[t][p]=1e20,n.nb_2[t][p]=1e20,n.nb_s1[t][p]=n.nb_s2[t][p]=1;for(var v=0;v<P.SBMAX_l;v++)n.en[t].l[v]=1e20,n.thm[t].l[v]=1e20;for(var p=0;p<3;++p){for(var v=0;v<P.SBMAX_s;v++)n.en[t].s[v][p]=1e20,n.thm[t].s[v][p]=1e20;n.nsPsy.lastAttacks[t]=0}for(var p=0;p<9;p++)n.nsPsy.last_en_subshort[t][p]=10}for(n.loudness_sq_save[0]=n.loudness_sq_save[1]=0,n.npart_l=H(n.numlines_l,n.bo_l,n.bm_l,c,h,n.mld_l,n.PSY.bo_l_weight,m,P.BLKSIZE,n.scalefac_band.l,P.BLKSIZE/1152,P.SBMAX_l),t=0;t<n.npart_l;t++){var b=o;c[t]>=s&&(b=l*(c[t]-s)/(24-s)+o*(24-c[t])/(24-s)),d[t]=Math.pow(10,b/10),n.numlines_l[t]>0?n.rnumlines_l[t]=1/n.numlines_l[t]:n.rnumlines_l[t]=0}n.s3_ll=G(n.s3ind,n.npart_l,c,h,d,r);var p=0;for(t=0;t<n.npart_l;t++){var g;g=$.MAX_VALUE;for(var y=0;y<n.numlines_l[t];y++,p++){var S,k=m*p/(1e3*P.BLKSIZE);S=this.ATHformula(1e3*k,e)-20,S=Math.pow(10,.1*S),S*=n.numlines_l[t],g>S&&(g=S)}n.ATH.cb_l[t]=g,g=20*c[t]/10-20,g>6&&(g=100),g<-15&&(g=-15),g-=8,n.minval_l[t]=Math.pow(10,g/10)*n.numlines_l[t]}for(n.npart_s=H(n.numlines_s,n.bo_s,n.bm_s,c,h,n.mld_s,n.PSY.bo_s_weight,m,P.BLKSIZE_s,n.scalefac_band.s,P.BLKSIZE_s/384,P.SBMAX_s),p=0,t=0;t<n.npart_s;t++){var g,b=u;c[t]>=s&&(b=_*(c[t]-s)/(24-s)+u*(24-c[t])/(24-s)),d[t]=Math.pow(10,b/10),g=$.MAX_VALUE;for(var y=0;y<n.numlines_s[t];y++,p++){var S,k=m*p/(1e3*P.BLKSIZE_s);S=this.ATHformula(1e3*k,e)-20,S=Math.pow(10,.1*S),S*=n.numlines_s[t],g>S&&(g=S)}n.ATH.cb_s[t]=g,g=7*c[t]/12-7,c[t]>12&&(g*=1+3.1*Math.log(1+g)),c[t]<12&&(g*=1+2.3*Math.log(1-g)),g<-15&&(g=-15),g-=8,n.minval_s[t]=Math.pow(10,g/10)*n.numlines_s[t]}n.s3_ss=G(n.s3ind_s,n.npart_s,c,h,d,r),a(),W.init_fft(n),n.decay=Math.exp(-1*Q/(.01*m/192));var E;E=3.5,0!=(2&e.exp_nspsytune)&&(E=1),Math.abs(e.msfix)>0&&(E=e.msfix),e.msfix=E;for(var w=0;w<n.npart_l;w++)n.s3ind[w][1]>n.npart_l-1&&(n.s3ind[w][1]=n.npart_l-1);var R=576*n.mode_gr/m;if(n.ATH.decay=Math.pow(10,-1.2*R),n.ATH.adjust=.01,n.ATH.adjustLimit=1,-1!=e.ATHtype){var k,A=e.out_samplerate/P.BLKSIZE,T=0;for(k=0,t=0;t<P.BLKSIZE/2;++t)k+=A,n.ATH.eql_w[t]=1/Math.pow(10,this.ATHformula(k,e)/10),T+=n.ATH.eql_w[t];for(T=1/T,t=P.BLKSIZE/2;--t>=0;)n.ATH.eql_w[t]*=T}for(var w=p=0;w<n.npart_s;++w)for(t=0;t<n.numlines_s[w];++t)++p;for(var w=p=0;w<n.npart_l;++w)for(t=0;t<n.numlines_l[w];++t)++p;for(p=0,t=0;t<n.npart_l;t++){var k=m*(p+n.numlines_l[t]/2)/(1*P.BLKSIZE);n.mld_cb_l[t]=z(k),p+=n.numlines_l[t]}for(;t<P.CBANDS;++t)n.mld_cb_l[t]=1;for(p=0,t=0;t<n.npart_s;t++){var k=m*(p+n.numlines_s[t]/2)/(1*P.BLKSIZE_s);n.mld_cb_s[t]=z(k),p+=n.numlines_s[t]}for(;t<P.CBANDS;++t)n.mld_cb_s[t]=1;return 0},this.ATHformula=function(e,t){var n;switch(t.ATHtype){case 0:n=q(e,9);break;case 1:n=q(e,-1);break;case 2:n=q(e,0);break;case 3:n=q(e,1)+6;break;case 4:n=q(e,t.ATHcurve);break;default:n=q(e,0)}return n}}function G(){function e(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(P.SBMAX_l),this.bo_s_weight=i(P.SBMAX_s)}function t(){this.lowerlimit=0}function n(e,t){this.lowpass=t}function r(e){var t;return e.class_id=Z,t=e.internal_flags=new F,e.mode=c.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=f.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=P.ENCDELAY+P.POSTDELAY,e.encoder_padding=0,t.mf_size=P.ENCDELAY-P.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}function a(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function s(e,t){var n=44100;return t>=48e3?n=48e3:t>=44100?n=44100:t>=32e3?n=32e3:t>=24e3?n=24e3:t>=22050?n=22050:t>=16e3?n=16e3:t>=12e3?n=12e3:t>=11025?n=11025:t>=8e3&&(n=8e3),-1==e?n:(e<=15960&&(n=44100),e<=15250&&(n=32e3),e<=11220&&(n=24e3),e<=9970&&(n=22050),e<=7230&&(n=16e3),e<=5420&&(n=12e3),e<=4510&&(n=11025),e<=3970&&(n=8e3),t<n?t>44100?48e3:t>32e3?44100:t>24e3?32e3:t>22050?24e3:t>16e3?22050:t>12e3?16e3:t>11025?12e3:t>8e3?11025:8e3:n)}function u(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:return t.version=0,0;case 24e3:return t.version=0,1;case 16e3:return t.version=0,2;case 11025:return t.version=0,0;case 12e3:return t.version=0,1;case 8e3:return t.version=0,2;default:return t.version=0,-1}}function h(e,t,n){n<16e3&&(t=2)
;for(var r=ee.bitrate_table[t][1],i=2;i<=14;i++)ee.bitrate_table[t][i]>0&&Math.abs(ee.bitrate_table[t][i]-e)<Math.abs(r-e)&&(r=ee.bitrate_table[t][i]);return r}function d(e,t,n){n<16e3&&(t=2);for(var r=0;r<=14;r++)if(ee.bitrate_table[t][r]>0&&ee.bitrate_table[t][r]==e)return r;return-1}function p(e,t){var r=[new n(8,2e3),new n(16,3700),new n(24,3900),new n(32,5500),new n(40,7e3),new n(48,7500),new n(56,1e4),new n(64,11e3),new n(80,13500),new n(96,15100),new n(112,15600),new n(128,17e3),new n(160,17500),new n(192,18600),new n(224,19400),new n(256,19700),new n(320,20500)],i=D.nearestBitrateFullIndex(t);e.lowerlimit=r[i].lowpass}function v(e){var t=e.internal_flags,n=32,r=-1;if(t.lowpass1>0){for(var i=999,s=0;s<=31;s++){var o=s/31;o>=t.lowpass2&&(n=Math.min(n,s)),t.lowpass1<o&&o<t.lowpass2&&(i=Math.min(i,s))}t.lowpass1=999==i?(n-.75)/31:(i-.75)/31,t.lowpass2=n/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,Q.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){for(var l=-1,s=0;s<=31;s++){var o=s/31;o<=t.highpass1&&(r=Math.max(r,s)),t.highpass1<o&&o<t.highpass2&&(l=Math.max(l,s))}t.highpass1=r/31,t.highpass2=-1==l?(r+.75)/31:(l+.75)/31}for(var s=0;s<32;s++){var u,_,o=s/31;u=t.highpass2>t.highpass1?a((t.highpass2-o)/(t.highpass2-t.highpass1+1e-20)):1,_=t.lowpass2>t.lowpass1?a((o-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[s]=u*_}}function b(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}function y(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&X.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=o([16,5]),t.bitrate_blockType_Hist=o([16,6]),t.PeakSample=0,e.bWriteVbrTag&&q.InitVbrTag(e)}function S(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=i(t),e.in_buffer_1=i(t),e.in_buffer_nsamples=t)}function k(e){var t=P.BLKSIZE+e.framesize-P.FFTOFFSET;return t=Math.max(t,512+e.framesize-32)}function E(e,t,n,r,i,a,s){var o,l,u,_,f,c=e.internal_flags,h=0,d=[null,null],p=[null,null];if(c.Class_ID!=Z)return-3;if(0==r)return 0;if((f=N.copy_buffer(c,i,a,s,0))<0)return f;if(a+=f,h+=f,p[0]=t,p[1]=n,g.NEQ(e.scale,0)&&g.NEQ(e.scale,1))for(l=0;l<r;++l)p[0][l]*=e.scale,2==c.channels_out&&(p[1][l]*=e.scale);if(g.NEQ(e.scale_left,0)&&g.NEQ(e.scale_left,1))for(l=0;l<r;++l)p[0][l]*=e.scale_left;if(g.NEQ(e.scale_right,0)&&g.NEQ(e.scale_right,1))for(l=0;l<r;++l)p[1][l]*=e.scale_right;if(2==e.num_channels&&1==c.channels_out)for(l=0;l<r;++l)p[0][l]=.5*(p[0][l]+p[1][l]),p[1][l]=0;_=k(e),d[0]=c.mfbuf[0],d[1]=c.mfbuf[1];for(var v=0;r>0;){var b=[null,null],y=0,S=0;b[0]=p[0],b[1]=p[1];var E=new L;if(I(e,d,b,v,r,E),y=E.n_in,S=E.n_out,c.findReplayGain&&!c.decode_on_the_fly&&j.AnalyzeSamples(c.rgdata,d[0],c.mf_size,d[1],c.mf_size,S,c.channels_out)==m.GAIN_ANALYSIS_ERROR)return-6;if(r-=y,v+=y,c.channels_out,c.mf_size+=S,c.mf_samples_to_encode<1&&(c.mf_samples_to_encode=P.ENCDELAY+P.POSTDELAY),c.mf_samples_to_encode+=S,c.mf_size>=_){var w=s-h;if(0==s&&(w=0),(o=M(e,d[0],d[1],i,a,w))<0)return o;for(a+=o,h+=o,c.mf_size-=e.framesize,c.mf_samples_to_encode-=e.framesize,u=0;u<c.channels_out;u++)for(l=0;l<c.mf_size;l++)d[u][l]=d[u][l+e.framesize]}}return h}function M(e,t,n,r,i,a){var s=D.enc.lame_encode_mp3_frame(e,t,n,r,i,a);return e.frameNum++,s}function L(){this.n_in=0,this.n_out=0}function x(){this.num_used=0}function B(e,t){return 0!=t?B(t,e%t):e}function O(e,t,n){var r=Math.PI*t;e/=n,e<0&&(e=0),e>1&&(e=1);var i=e-.5,a=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(i)<1e-9?r/Math.PI:a*Math.sin(n*r*i)/(Math.PI*n*i)}function C(e,t,n,r,a,s,o,l,u){var _,f,c=e.internal_flags,h=0,d=e.out_samplerate/B(e.out_samplerate,e.in_samplerate);d>F.BPC&&(d=F.BPC);var m=Math.abs(c.resample_ratio-Math.floor(.5+c.resample_ratio))<1e-4?1:0,p=1/c.resample_ratio;p>1&&(p=1);var v=31;0==v%2&&--v,v+=m;var b=v+1;if(0==c.fill_buffer_resample_init){for(c.inbuf_old[0]=i(b),c.inbuf_old[1]=i(b),_=0;_<=2*d;++_)c.blackfilt[_]=i(b);for(c.itime[0]=0,c.itime[1]=0,h=0;h<=2*d;h++){var g=0,y=(h-d)/(2*d);for(_=0;_<=v;_++)g+=c.blackfilt[h][_]=O(_-y,p,v);for(_=0;_<=v;_++)c.blackfilt[h][_]/=g}c.fill_buffer_resample_init=1}var S=c.inbuf_old[u];for(f=0;f<r;f++){var k,E;if(k=f*c.resample_ratio,h=0|Math.floor(k-c.itime[u]),v+h-v/2>=o)break;var y=k-c.itime[u]-(h+v%2*.5);E=0|Math.floor(2*y*d+d+.5);var w=0;for(_=0;_<=v;++_){var R,A=_+h-v/2;R=A<0?S[b+A]:a[s+A],w+=R*c.blackfilt[E][_]}t[n+f]=w}if(l.num_used=Math.min(o,v+h-v/2),c.itime[u]+=l.num_used-f*c.resample_ratio,l.num_used>=b)for(_=0;_<b;_++)S[_]=a[s+l.num_used+_-b];else{var T=b-l.num_used;for(_=0;_<T;++_)S[_]=S[_+l.num_used];for(h=0;_<b;++_,++h)S[_]=a[s+h]}return f}function I(e,t,n,r,i,a){var s=e.internal_flags;if(s.resample_ratio<.9999||s.resample_ratio>1.0001)for(var o=0;o<s.channels_out;o++){var l=new x;a.n_out=C(e,t[o],s.mf_size,e.framesize,n[o],r,i,l,o),a.n_in=l.num_used}else{a.n_out=Math.min(e.framesize,i),a.n_in=a.n_out;for(var u=0;u<a.n_out;++u)t[0][s.mf_size+u]=n[0][r+u],2==s.channels_out&&(t[1][s.mf_size+u]=n[1][r+u])}}var D=this;G.V9=410,G.V8=420,G.V7=430,G.V6=440,G.V5=450,G.V4=460,G.V3=470,G.V2=480,G.V1=490,G.V0=500,G.R3MIX=1e3,G.STANDARD=1001,G.EXTREME=1002,G.INSANE=1003,G.STANDARD_FAST=1004,G.EXTREME_FAST=1005,G.MEDIUM=1006,G.MEDIUM_FAST=1007;G.LAME_MAXMP3BUFFER=147456;var j,N,U,V,z,q,Y,X,K,W=new H;this.enc=new P,this.setModules=function(e,t,n,r,i,a,s,o,l){j=e,N=t,U=n,V=r,z=i,q=a,Y=s,X=o,K=l,this.enc.setModules(N,W,V,q)};var Z=4294479419;this.lame_init=function(){var e=new R;return 0!=r(e)?null:(e.lame_allocated_gfp=1,e)},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],n=0,r=0,i=0,a=0;a=t[16],i=16,r=t[16],n=16;for(var s=0;s<16;s++)if(Math.max(e,t[s+1])!=e){a=t[s+1],i=s+1,r=t[s],n=s;break}return a-e>e-r?n:i},this.lame_init_params=function(n){var r=n.internal_flags;if(r.Class_ID=0,null==r.ATH&&(r.ATH=new w),null==r.PSY&&(r.PSY=new e),null==r.rgdata&&(r.rgdata=new T),r.channels_in=n.num_channels,1==r.channels_in&&(n.mode=c.MONO),r.channels_out=n.mode==c.MONO?1:2,r.mode_ext=P.MPG_MD_MS_LR,n.mode==c.MONO&&(n.force_ms=!1),n.VBR==f.vbr_off&&128!=n.VBR_mean_bitrate_kbps&&0==n.brate&&(n.brate=n.VBR_mean_bitrate_kbps),n.VBR==f.vbr_off||n.VBR==f.vbr_mtrh||n.VBR==f.vbr_mt||(n.free_format=!1),n.VBR==f.vbr_off&&0==n.brate&&g.EQ(n.compression_ratio,0)&&(n.compression_ratio=11.025),n.VBR==f.vbr_off&&n.compression_ratio>0&&(0==n.out_samplerate&&(n.out_samplerate=map2MP3Frequency(int(.97*n.in_samplerate))),n.brate=0|16*n.out_samplerate*r.channels_out/(1e3*n.compression_ratio),r.samplerate_index=u(n.out_samplerate,n),n.free_format||(n.brate=h(n.brate,n.version,n.out_samplerate))),0!=n.out_samplerate&&(n.out_samplerate<16e3?(n.VBR_mean_bitrate_kbps=Math.max(n.VBR_mean_bitrate_kbps,8),n.VBR_mean_bitrate_kbps=Math.min(n.VBR_mean_bitrate_kbps,64)):n.out_samplerate<32e3?(n.VBR_mean_bitrate_kbps=Math.max(n.VBR_mean_bitrate_kbps,8),n.VBR_mean_bitrate_kbps=Math.min(n.VBR_mean_bitrate_kbps,160)):(n.VBR_mean_bitrate_kbps=Math.max(n.VBR_mean_bitrate_kbps,32),n.VBR_mean_bitrate_kbps=Math.min(n.VBR_mean_bitrate_kbps,320))),0==n.lowpassfreq){var i=16e3;switch(n.VBR){case f.vbr_off:var a=new t;p(a,n.brate),i=a.lowerlimit;break;case f.vbr_abr:var a=new t;p(a,n.VBR_mean_bitrate_kbps),i=a.lowerlimit;break;case f.vbr_rh:var o=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=n.VBR_q&&n.VBR_q<=9){var l=o[n.VBR_q],S=o[n.VBR_q+1],k=n.VBR_q_frac;i=linear_int(l,S,k)}else i=19500;break;default:var o=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=n.VBR_q&&n.VBR_q<=9){var l=o[n.VBR_q],S=o[n.VBR_q+1],k=n.VBR_q_frac;i=linear_int(l,S,k)}else i=19500}n.mode!=c.MONO||n.VBR!=f.vbr_off&&n.VBR!=f.vbr_abr||(i*=1.5),n.lowpassfreq=0|i}if(0==n.out_samplerate&&(2*n.lowpassfreq>n.in_samplerate&&(n.lowpassfreq=n.in_samplerate/2),n.out_samplerate=s(0|n.lowpassfreq,n.in_samplerate)),n.lowpassfreq=Math.min(20500,n.lowpassfreq),n.lowpassfreq=Math.min(n.out_samplerate/2,n.lowpassfreq),n.VBR==f.vbr_off&&(n.compression_ratio=16*n.out_samplerate*r.channels_out/(1e3*n.brate)),n.VBR==f.vbr_abr&&(n.compression_ratio=16*n.out_samplerate*r.channels_out/(1e3*n.VBR_mean_bitrate_kbps)),n.bWriteVbrTag||(n.findReplayGain=!1,n.decode_on_the_fly=!1,r.findPeakSample=!1),r.findReplayGain=n.findReplayGain,r.decode_on_the_fly=n.decode_on_the_fly,r.decode_on_the_fly&&(r.findPeakSample=!0),r.findReplayGain&&j.InitGainAnalysis(r.rgdata,n.out_samplerate)==m.INIT_GAIN_ANALYSIS_ERROR)return n.internal_flags=null,-6;switch(r.decode_on_the_fly&&!n.decode_only&&(null!=r.hip&&K.hip_decode_exit(r.hip),r.hip=K.hip_decode_init()),r.mode_gr=n.out_samplerate<=24e3?1:2,n.framesize=576*r.mode_gr,n.encoder_delay=P.ENCDELAY,r.resample_ratio=n.in_samplerate/n.out_samplerate,n.VBR){case f.vbr_mt:case f.vbr_rh:case f.vbr_mtrh:var E=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];n.compression_ratio=E[n.VBR_q];break;case f.vbr_abr:n.compression_ratio=16*n.out_samplerate*r.channels_out/(1e3*n.VBR_mean_bitrate_kbps);break;default:n.compression_ratio=16*n.out_samplerate*r.channels_out/(1e3*n.brate)}if(n.mode==c.NOT_SET&&(n.mode=c.JOINT_STEREO),n.highpassfreq>0?(r.highpass1=2*n.highpassfreq,n.highpasswidth>=0?r.highpass2=2*(n.highpassfreq+n.highpasswidth):r.highpass2=2*n.highpassfreq,r.highpass1/=n.out_samplerate,r.highpass2/=n.out_samplerate):(r.highpass1=0,r.highpass2=0),n.lowpassfreq>0?(r.lowpass2=2*n.lowpassfreq,n.lowpasswidth>=0?(r.lowpass1=2*(n.lowpassfreq-n.lowpasswidth),r.lowpass1<0&&(r.lowpass1=0)):r.lowpass1=2*n.lowpassfreq,r.lowpass1/=n.out_samplerate,r.lowpass2/=n.out_samplerate):(r.lowpass1=0,r.lowpass2=0),v(n),r.samplerate_index=u(n.out_samplerate,n),r.samplerate_index<0)return n.internal_flags=null,-1;if(n.VBR==f.vbr_off){if(n.free_format)r.bitrate_index=0;else if(n.brate=h(n.brate,n.version,n.out_samplerate),r.bitrate_index=d(n.brate,n.version,n.out_samplerate),r.bitrate_index<=0)return n.internal_flags=null,-1}else r.bitrate_index=1;n.analysis&&(n.bWriteVbrTag=!1),null!=r.pinfo&&(n.bWriteVbrTag=!1),N.init_bit_stream_w(r);for(var R=r.samplerate_index+3*n.version+6*(n.out_samplerate<16e3?1:0),M=0;M<P.SBMAX_l+1;M++)r.scalefac_band.l[M]=V.sfBandIndex[R].l[M];for(var M=0;M<P.PSFB21+1;M++){var L=(r.scalefac_band.l[22]-r.scalefac_band.l[21])/P.PSFB21,x=r.scalefac_band.l[21]+M*L;r.scalefac_band.psfb21[M]=x}r.scalefac_band.psfb21[P.PSFB21]=576;for(var M=0;M<P.SBMAX_s+1;M++)r.scalefac_band.s[M]=V.sfBandIndex[R].s[M];for(var M=0;M<P.PSFB12+1;M++){var L=(r.scalefac_band.s[13]-r.scalefac_band.s[12])/P.PSFB12,x=r.scalefac_band.s[12]+M*L;r.scalefac_band.psfb12[M]=x}r.scalefac_band.psfb12[P.PSFB12]=192,1==n.version?r.sideinfo_len=1==r.channels_out?21:36:r.sideinfo_len=1==r.channels_out?13:21,n.error_protection&&(r.sideinfo_len+=2),y(n),r.Class_ID=Z;var B;for(B=0;B<19;B++)r.nsPsy.pefirbuf[B]=700*r.mode_gr*r.channels_out;switch(-1==n.ATHtype&&(n.ATHtype=4),n.VBR){case f.vbr_mt:n.VBR=f.vbr_mtrh;case f.vbr_mtrh:null==n.useTemporal&&(n.useTemporal=!1),U.apply_preset(n,500-10*n.VBR_q,0),n.quality<0&&(n.quality=LAME_DEFAULT_QUALITY),n.quality<5&&(n.quality=0),n.quality>5&&(n.quality=5),r.PSY.mask_adjust=n.maskingadjust,r.PSY.mask_adjust_short=n.maskingadjust_short,n.experimentalY?r.sfb21_extra=!1:r.sfb21_extra=n.out_samplerate>44e3,r.iteration_loop=new VBRNewIterationLoop(z);break;case f.vbr_rh:U.apply_preset(n,500-10*n.VBR_q,0),r.PSY.mask_adjust=n.maskingadjust,r.PSY.mask_adjust_short=n.maskingadjust_short,n.experimentalY?r.sfb21_extra=!1:r.sfb21_extra=n.out_samplerate>44e3,n.quality>6&&(n.quality=6),n.quality<0&&(n.quality=LAME_DEFAULT_QUALITY),r.iteration_loop=new VBROldIterationLoop(z);break;default:var O;r.sfb21_extra=!1,n.quality<0&&(n.quality=LAME_DEFAULT_QUALITY),O=n.VBR,O==f.vbr_off&&(n.VBR_mean_bitrate_kbps=n.brate),U.apply_preset(n,n.VBR_mean_bitrate_kbps,0),n.VBR=O,r.PSY.mask_adjust=n.maskingadjust,r.PSY.mask_adjust_short=n.maskingadjust_short,O==f.vbr_off?r.iteration_loop=new A(z):r.iteration_loop=new ABRIterationLoop(z)}if(n.VBR!=f.vbr_off){if(r.VBR_min_bitrate=1,r.VBR_max_bitrate=14,n.out_samplerate<16e3&&(r.VBR_max_bitrate=8),0!=n.VBR_min_bitrate_kbps&&(n.VBR_min_bitrate_kbps=h(n.VBR_min_bitrate_kbps,n.version,n.out_samplerate),r.VBR_min_bitrate=d(n.VBR_min_bitrate_kbps,n.version,n.out_samplerate),r.VBR_min_bitrate<0))return-1;if(0!=n.VBR_max_bitrate_kbps&&(n.VBR_max_bitrate_kbps=h(n.VBR_max_bitrate_kbps,n.version,n.out_samplerate),r.VBR_max_bitrate=d(n.VBR_max_bitrate_kbps,n.version,n.out_samplerate),r.VBR_max_bitrate<0))return-1;n.VBR_min_bitrate_kbps=ee.bitrate_table[n.version][r.VBR_min_bitrate],n.VBR_max_bitrate_kbps=ee.bitrate_table[n.version][r.VBR_max_bitrate],n.VBR_mean_bitrate_kbps=Math.min(ee.bitrate_table[n.version][r.VBR_max_bitrate],n.VBR_mean_bitrate_kbps),n.VBR_mean_bitrate_kbps=Math.max(ee.bitrate_table[n.version][r.VBR_min_bitrate],n.VBR_mean_bitrate_kbps)}return n.tune&&(r.PSY.mask_adjust+=n.tune_value_a,r.PSY.mask_adjust_short+=n.tune_value_a),b(n),n.athaa_type<0?r.ATH.useAdjust=3:r.ATH.useAdjust=n.athaa_type,r.ATH.aaSensitivityP=Math.pow(10,n.athaa_sensitivity/-10),null==n.short_blocks&&(n.short_blocks=_.short_block_allowed),n.short_blocks!=_.short_block_allowed||n.mode!=c.JOINT_STEREO&&n.mode!=c.STEREO||(n.short_blocks=_.short_block_coupled),n.quant_comp<0&&(n.quant_comp=1),n.quant_comp_short<0&&(n.quant_comp_short=0),n.msfix<0&&(n.msfix=0),n.exp_nspsytune=1|n.exp_nspsytune,n.internal_flags.nsPsy.attackthre<0&&(n.internal_flags.nsPsy.attackthre=H.NSATTACKTHRE),n.internal_flags.nsPsy.attackthre_s<0&&(n.internal_flags.nsPsy.attackthre_s=H.NSATTACKTHRE_S),n.scale<0&&(n.scale=1),n.ATHtype<0&&(n.ATHtype=4),n.ATHcurve<0&&(n.ATHcurve=4),n.athaa_loudapprox<0&&(n.athaa_loudapprox=2),n.interChRatio<0&&(n.interChRatio=0),null==n.useTemporal&&(n.useTemporal=!0),r.slot_lag=r.frac_SpF=0,n.VBR==f.vbr_off&&(r.slot_lag=r.frac_SpF=72e3*(n.version+1)*n.brate%n.out_samplerate|0),V.iteration_init(n),W.psymodel_init(n),0},this.lame_encode_flush=function(e,t,n,r){var i,a,s,o,u=e.internal_flags,_=l([2,1152]),f=0,c=u.mf_samples_to_encode-P.POSTDELAY,h=k(e);if(u.mf_samples_to_encode<1)return 0;for(i=0,e.in_samplerate!=e.out_samplerate&&(c+=16*e.out_samplerate/e.in_samplerate),s=e.framesize-c%e.framesize,s<576&&(s+=e.framesize),e.encoder_padding=s,o=(c+s)/e.framesize;o>0&&f>=0;){var d=h-u.mf_size,m=e.frameNum;d*=e.in_samplerate,d/=e.out_samplerate,d>1152&&(d=1152),d<1&&(d=1),a=r-i,0==r&&(a=0),f=this.lame_encode_buffer(e,_[0],_[1],d,t,n,a),n+=f,i+=f,o-=m!=e.frameNum?1:0}if(u.mf_samples_to_encode=0,f<0)return f;if(a=r-i,0==r&&(a=0),N.flush_bitstream(e),(f=N.copy_buffer(u,t,n,a,1))<0)return f;if(n+=f,i+=f,a=r-i,0==r&&(a=0),e.write_id3tag_automatic){if(X.id3tag_write_v1(e),(f=N.copy_buffer(u,t,n,a,0))<0)return f;i+=f}return i},this.lame_encode_buffer=function(e,t,n,r,i,a,s){var o=e.internal_flags,l=[null,null];if(o.Class_ID!=Z)return-3;if(0==r)return 0;S(o,r),l[0]=o.in_buffer_0,l[1]=o.in_buffer_1;for(var u=0;u<r;u++)l[0][u]=t[u],o.channels_in>1&&(l[1][u]=n[u]);return E(e,l[0],l[1],r,i,a,s)}}function z(){var e,t;this.setModules=function(n,r){e=n,t=r}}function q(){var e,t,n;this.setModules=function(r,i,a){e=r,t=i,n=a}}function Y(){}function X(){var e,t;this.setModules=function(n,r){e=n,t=r}}function K(e,n,r){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,n=44100,r=128);var i=new G,a=new z,s=new m,o=new g,l=new p,u=new L,_=new O,f=new b,y=new h,S=new X,k=new v,E=new d,w=new q,R=new Y;i.setModules(s,o,l,u,_,f,y,S,R),o.setModules(s,R,y,f),S.setModules(o,y),l.setModules(i),_.setModules(o,k,u,E),u.setModules(E,k,i.enc.psy),k.setModules(o),E.setModules(u),f.setModules(i,o,y),a.setModules(w,R),w.setModules(y,S,l);var A=i.lame_init();A.num_channels=e,A.in_samplerate=n,A.out_samplerate=n,A.brate=r,A.mode=c.STEREO,A.quality=3,A.bWriteVbrTag=!1,A.disable_reservoir=!0,A.write_id3tag_automatic=!1;var T=(i.lame_init_params(A),1152),M=0|1.25*T+7200,x=t(M);this.encodeBuffer=function(n,r){1==e&&(r=n),n.length>T&&(T=n.length,M=0|1.25*T+7200,x=t(M));var a=i.lame_encode_buffer(A,n,r,n.length,x,0,M);return new Int8Array(x.subarray(0,a))},this.flush=function(){var e=i.lame_encode_flush(A,x,0,M);return new Int8Array(x.subarray(0,e))}}var W=function(e){return Math.log(e)/Math.log(10)},Z={};Z.fill=function(e,t,n,r){if(2==arguments.length)for(var i=0;i<e.length;i++)e[i]=arguments[1];else for(var i=t;i<n;i++)e[i]=r};var Q={};Q.arraycopy=function(e,t,n,r,i){for(var a=t+i;t<a;)n[r++]=e[t++]};var J={};J.SQRT2=1.4142135623730951,J.FAST_LOG10=function(e){return W(e)},J.FAST_LOG10_X=function(e,t){return W(e)*t},_.short_block_allowed=new _(0),_.short_block_coupled=new _(1),_.short_block_dispensed=new _(2),_.short_block_forced=new _(3);var $={};$.MAX_VALUE=3.4028235e38,f.vbr_off=new f(0),f.vbr_mt=new f(1),f.vbr_rh=new f(2),f.vbr_abr=new f(3),f.vbr_mtrh=new f(4),f.vbr_default=f.vbr_mtrh;c.STEREO=new c(0),c.JOINT_STEREO=new c(1),c.DUAL_CHANNEL=new c(2),c.MONO=new c(3),c.NOT_SET=new c(4),m.STEPS_per_dB=100,m.MAX_dB=120,m.GAIN_NOT_ENOUGH_SAMPLES=-24601,m.GAIN_ANALYSIS_ERROR=0,m.GAIN_ANALYSIS_OK=1,m.INIT_GAIN_ANALYSIS_ERROR=0,m.INIT_GAIN_ANALYSIS_OK=1,m.YULE_ORDER=10,m.MAX_ORDER=m.YULE_ORDER,m.MAX_SAMP_FREQ=48e3,m.RMS_WINDOW_TIME_NUMERATOR=1,m.RMS_WINDOW_TIME_DENOMINATOR=20,m.MAX_SAMPLES_PER_WINDOW=m.MAX_SAMP_FREQ*m.RMS_WINDOW_TIME_NUMERATOR/m.RMS_WINDOW_TIME_DENOMINATOR+1,b.NUMTOCENTRIES=100,b.MAXFRAMESIZE=2880,g.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},g.NEQ=function(e,t){return!g.EQ(e,t)};var ee={};ee.t1HB=[1,1,1,0],ee.t2HB=[1,2,1,3,1,1,3,2,0],ee.t3HB=[3,2,1,1,1,1,3,2,0],ee.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],ee.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],ee.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],ee.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],ee.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],ee.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],ee.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],ee.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],ee.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],ee.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],ee.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],ee.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],ee.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],ee.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],ee.t1l=[1,4,3,5],ee.t2l=[1,4,7,4,5,7,6,7,8],ee.t3l=[2,3,7,4,4,7,6,7,8],ee.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],ee.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],ee.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],ee.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],ee.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],ee.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],ee.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],ee.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],ee.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],ee.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],ee.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],ee.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],ee.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],ee.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],ee.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8],ee.ht=[new y(0,0,null,null),new y(2,0,ee.t1HB,ee.t1l),new y(3,0,ee.t2HB,ee.t2l),new y(3,0,ee.t3HB,ee.t3l),new y(0,0,null,null),new y(4,0,ee.t5HB,ee.t5l),new y(4,0,ee.t6HB,ee.t6l),new y(6,0,ee.t7HB,ee.t7l),new y(6,0,ee.t8HB,ee.t8l),new y(6,0,ee.t9HB,ee.t9l),new y(8,0,ee.t10HB,ee.t10l),new y(8,0,ee.t11HB,ee.t11l),new y(8,0,ee.t12HB,ee.t12l),new y(16,0,ee.t13HB,ee.t13l),new y(0,0,null,ee.t16_5l),new y(16,0,ee.t15HB,ee.t15l),new y(1,1,ee.t16HB,ee.t16l),new y(2,3,ee.t16HB,ee.t16l),new y(3,7,ee.t16HB,ee.t16l),new y(4,15,ee.t16HB,ee.t16l),new y(6,63,ee.t16HB,ee.t16l),new y(8,255,ee.t16HB,ee.t16l),new y(10,1023,ee.t16HB,ee.t16l),new y(13,8191,ee.t16HB,ee.t16l),new y(4,15,ee.t24HB,ee.t24l),new y(5,31,ee.t24HB,ee.t24l),new y(6,63,ee.t24HB,ee.t24l),new y(7,127,ee.t24HB,ee.t24l),new y(8,255,ee.t24HB,ee.t24l),new y(9,511,ee.t24HB,ee.t24l),new y(11,2047,ee.t24HB,ee.t24l),new y(13,8191,ee.t24HB,ee.t24l),new y(0,0,ee.t32HB,ee.t32l),new y(0,0,ee.t33HB,ee.t33l)],ee.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],ee.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],ee.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],ee.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],ee.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],ee.scfsi_band=[0,6,11,16,21],L.Q_MAX=257,L.Q_MAX2=116,L.LARGE_BITS=1e5,L.IXMAX_VAL=8206;var te={};te.SFBMAX=3*P.SBMAX_s,P.ENCDELAY=576,P.POSTDELAY=1152,P.MDCTDELAY=48,P.FFTOFFSET=224+P.MDCTDELAY,P.DECDELAY=528,P.SBLIMIT=32,P.CBANDS=64,P.SBPSY_l=21,P.SBPSY_s=12,P.SBMAX_l=22,P.SBMAX_s=13,P.PSFB21=6,P.PSFB12=6,P.BLKSIZE=1024,P.HBLKSIZE=P.BLKSIZE/2+1,P.BLKSIZE_s=256,P.HBLKSIZE_s=P.BLKSIZE_s/2+1,P.NORM_TYPE=0,P.START_TYPE=1,P.SHORT_TYPE=2,P.STOP_TYPE=3,P.MPG_MD_LR_LR=0,
P.MPG_MD_LR_I=1,P.MPG_MD_MS_LR=2,P.MPG_MD_MS_I=3,P.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3.898045e-17,.0467745*5,.50455,.756825,.187098*5],F.MFSIZE=3456+P.ENCDELAY-P.MDCTDELAY,F.MAX_HEADER_BUF=256,F.MAX_BITS_PER_CHANNEL=4095,F.MAX_BITS_PER_GRANULE=7680,F.BPC=320,te.SFBMAX=3*P.SBMAX_s,e.Mp3Encoder=K}e(),Recorder.lamejs=e}()},{}],3:[function(e,t,n){!function(){"use strict";Recorder.prototype.enc_mp3={stable:!0,testmsg:"采样率范围48000, 44100, 32000, 24000, 22050, 16000, 12000, 11025, 8000"},Recorder.prototype.mp3=function(e,t,n){var a=this,s=a.set,o=e.length,l=a.mp3_start(s);if(l)return a.mp3_encode(l,e),void a.mp3_complete(l,t,n,1);var u=new Recorder.lamejs.Mp3Encoder(1,s.sampleRate,s.bitRate),_=[],f=0,c=0,h=function(){if(f<o){var n=u.encodeBuffer(e.subarray(f,f+57600));n.length>0&&(c+=n.buffer.byteLength,_.push(n.buffer)),f+=57600,setTimeout(h)}else{var n=u.flush();n.length>0&&(c+=n.buffer.byteLength,_.push(n.buffer));var a=r.fn(_,c,o,s.sampleRate);i(a,s),t(new Blob(_,{type:"audio/mp3"}))}};h()};var e;Recorder.BindDestroy("mp3Worker",function(){console.log("mp3Worker Destroy"),e&&e.terminate(),e=null}),Recorder.prototype.mp3_envCheck=function(e,t){var r="";return t.takeoffEncodeChunk&&(e.canProcess?n()||(r="当前浏览器版本太低，无法实时处理"):r=e.envName+"环境不支持实时处理"),r},Recorder.prototype.mp3_start=function(e){return n(e)};var t={id:0},n=function(n){var i=e;try{if(!i){var a=function(e){var t=e.data,n=wk_ctxs[t.id];if("init"==t.action)wk_ctxs[t.id]={sampleRate:t.sampleRate,bitRate:t.bitRate,takeoff:t.takeoff,mp3Size:0,pcmSize:0,encArr:[],encObj:new wk_lame.Mp3Encoder(1,t.sampleRate,t.bitRate)};else if(!n)return;switch(t.action){case"stop":n.encObj=null,delete wk_ctxs[t.id];break;case"encode":n.pcmSize+=t.pcm.length;var r=n.encObj.encodeBuffer(t.pcm);r.length>0&&(n.takeoff?self.postMessage({action:"takeoff",id:t.id,chunk:r}):(n.mp3Size+=r.buffer.byteLength,n.encArr.push(r.buffer)));break;case"complete":var r=n.encObj.flush();r.length>0&&(n.takeoff?self.postMessage({action:"takeoff",id:t.id,chunk:r}):(n.mp3Size+=r.buffer.byteLength,n.encArr.push(r.buffer)));var i=wk_mp3TrimFix.fn(n.encArr,n.mp3Size,n.pcmSize,n.sampleRate);self.postMessage({action:t.action,id:t.id,blob:new Blob(n.encArr,{type:"audio/mp3"}),meta:i})}},s=");wk_lame();var wk_ctxs={};self.onmessage="+a;s+=";var wk_mp3TrimFix={rm:"+r.rm+",fn:"+r.fn+"}";var o=Recorder.lamejs.toString(),l=(window.URL||webkitURL).createObjectURL(new Blob(["var wk_lame=(",o,s],{type:"text/javascript"}));i=new Worker(l),setTimeout(function(){(window.URL||webkitURL).revokeObjectURL(l)},1e4),i.onmessage=function(e){var n=e.data,r=t[n.id];r&&("takeoff"==n.action?r.set.takeoffEncodeChunk(new Uint8Array(n.chunk.buffer)):(r.call&&r.call(n),r.call=null))}}var u={worker:i,set:n,takeoffQueue:[]};return n?(u.id=++t.id,t[u.id]=u,i.postMessage({action:"init",id:u.id,sampleRate:n.sampleRate,bitRate:n.bitRate,takeoff:!!n.takeoffEncodeChunk,x:new Int16Array(5)})):i.postMessage({x:new Int16Array(5)}),e=i,u}catch(e){return i&&i.terminate(),console.error(e),null}};Recorder.prototype.mp3_stop=function(e){if(e&&e.worker){e.worker.postMessage({action:"stop",id:e.id}),e.worker=null,delete t[e.id];var n=-1;for(var r in t)n++;n&&console.warn("mp3 worker剩"+n+"个在串行等待")}},Recorder.prototype.mp3_encode=function(e,t){e&&e.worker&&e.worker.postMessage({action:"encode",id:e.id,pcm:t})},Recorder.prototype.mp3_complete=function(e,t,n,r){var a=this;e&&e.worker?(e.call=function(n){i(n.meta,e.set),t(n.blob),r&&a.mp3_stop(e)},e.worker.postMessage({action:"complete",id:e.id})):n("mp3编码器未打开")},Recorder.mp3ReadMeta=function(e,t){var n="object"==typeof window?window.parseInt:self.parseInt,r=new Uint8Array(e[0]||[]);if(r.length<4)return null;var i=function(e,t){return("0000000"+((t||r)[e]||0).toString(2)).substr(-8)},a=i(0)+i(1),s=i(2)+i(3);if(!/^1{11}/.test(a))return null;var o={"00":2.5,10:2,11:1}[a.substr(11,2)],l={"01":3}[a.substr(13,2)],u={1:[44100,48e3,32e3],2:[22050,24e3,16e3],2.5:[11025,12e3,8e3]}[o];u&&(u=u[n(s.substr(4,2),2)]);var _=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320]][1==o?1:0][n(s.substr(0,4),2)];if(!(o&&l&&_&&u))return null;for(var f=Math.round(8*t/_),c=1==l?384:2==l?1152:1==o?1152:576,h=c/u*1e3,d=Math.floor(c*_/8/u*1e3),m=0,p=0,v=0;v<e.length;v++){var b=e[v];if((p+=b.byteLength)>=d+3){var g=new Uint8Array(b);m="1"==i(b.byteLength-(p-(d+3)+1),g).charAt(6);break}}return m&&d++,{version:o,layer:l,sampleRate:u,bitRate:_,duration:f,size:t,hasPadding:m,frameSize:d,frameDurationFloat:h}};var r={rm:Recorder.mp3ReadMeta,fn:function(e,t,n,r){var i=this.rm(e,t);if(!i)return{err:"mp3非预定格式"};var a=Math.round(n/r*1e3),s=Math.floor((i.duration-a)/i.frameDurationFloat);if(s>0){var o=s*i.frameSize-(i.hasPadding?1:0);t-=o;for(var l=0,u=[],_=0;_<e.length;_++){var f=e[_];if(o<=0)break;o>=f.byteLength?(o-=f.byteLength,u.push(f),e.splice(_,1),_--):(e[_]=f.slice(o),l=f,o=0)}if(!this.rm(e,t)){l&&(e[0]=l);for(var _=0;_<u.length;_++)e.splice(_,0,u[_]);i.err="fix后数据错误，已还原，错误原因不明"}var c=i.trimFix={};c.remove=s,c.removeDuration=Math.round(s*i.frameDurationFloat),c.duration=Math.round(8*t/i.bitRate)}return i}},i=function(e,t){var n="MP3信息 ";(e.sampleRate&&e.sampleRate!=t.sampleRate||e.bitRate&&e.bitRate!=t.bitRate)&&(console.warn(n+"和设置的不匹配set:"+t.bitRate+"kbps "+t.sampleRate+"hz，已更新set:"+e.bitRate+"kbps "+e.sampleRate+"hz",t),t.sampleRate=e.sampleRate,t.bitRate=e.bitRate);var r=e.trimFix;r?(n+="Fix移除"+r.remove+"帧"+r.removeDuration+"ms -> "+r.duration+"ms",r.remove>2&&(e.err=(e.err?e.err+", ":"")+"移除帧数过多")):n+=(e.duration||"-")+"ms",e.err?console.error(n,e.err,e):console.log(n,e)}}()},{}],4:[function(t,n,r){!function(t){!function(e){"use strict";function t(e){this.id=++l,r.Traffic&&r.Traffic();var t={type:"mp3",bitRate:16,sampleRate:16e3,onProcess:n};for(var i in e)t[i]=e[i];this.set=t,this._S=9}var n=function(){},r=function(e){return new t(e)};r.IsOpen=function(){var e=r.Stream;if(e){var t=e.getTracks&&e.getTracks()||e.audioTracks||[],n=t[0];if(n){var i=n.readyState;return"live"==i||i==n.LIVE}}return!1},r.BufferSize=4096,r.Destroy=function(){o("Recorder Destroy");for(var e in i)i[e]()};var i={};r.BindDestroy=function(e,t){i[e]=t},r.Support=function(){var t=e.AudioContext;if(t||(t=e.webkitAudioContext),!t)return!1;var n=navigator.mediaDevices||{};return n.getUserMedia||(n=navigator,n.getUserMedia||(n.getUserMedia=n.webkitGetUserMedia||n.mozGetUserMedia||n.msGetUserMedia)),!!n.getUserMedia&&(r.Scope=n,r.Ctx&&"closed"!=r.Ctx.state||(r.Ctx=new t,r.BindDestroy("Ctx",function(){var e=r.Ctx;e&&e.close&&e.close()})),!0)};var a=function(){var e=r.Ctx,t=r.Stream,n=t._m=e.createMediaStreamSource(t),i=t._p=(e.createScriptProcessor||e.createJavaScriptNode).call(e,r.BufferSize,1,1);n.connect(i),i.connect(e.destination);var a=t._call;i.onaudioprocess=function(e){for(var t in a){for(var n=e.inputBuffer.getChannelData(0),r=n.length,i=new Int16Array(r),s=0,o=0;o<r;o++){var l=Math.max(-1,Math.min(1,n[o]));l=l<0?32768*l:32767*l,i[o]=l,s+=Math.abs(l)}for(var u in a)a[u](i,s);return}}},s=function(){var e=r.Stream;e._m&&(e._m.disconnect(),e._p.disconnect(),e._p.onaudioprocess=e._p=e._m=null)};r.SampleData=function(e,t,n,r,i){r||(r={});var a=r.index||0,s=r.offset||0,o=r.frameNext||[];i||(i={});var l=i.frameSize||1;i.frameType&&(l="mp3"==i.frameType?1152:1);for(var u=0,_=a;_<e.length;_++)u+=e[_].length;u=Math.max(0,u-Math.floor(s));var f=t/n;f>1?u=Math.floor(u/f):(f=1,n=t),u+=o.length;for(var c=new Int16Array(u),h=0,_=0;_<o.length;_++)c[h]=o[_],h++;for(var d=e.length;a<d;a++){for(var m=e[a],_=s,p=m.length;_<p;){var v=Math.floor(_),b=Math.ceil(_),g=_-v,y=m[v],S=b<p?m[b]:(e[a+1]||[y])[0]||0;c[h]=y+(S-y)*g,h++,_+=f}s=_-p}o=null;var k=c.length%l;if(k>0){var E=2*(c.length-k);o=new Int16Array(c.buffer.slice(E)),c=new Int16Array(c.buffer.slice(0,E))}return{index:a,offset:s,frameNext:o,sampleRate:n,data:c}},r.PowerLevel=function(e,t){var n=e/t||0;return n<1251?Math.round(n/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(n/1e4)/Math.log(10)))))};var o=function(e,t){var n=new Date,r=("0"+n.getMinutes()).substr(-2)+":"+("0"+n.getSeconds()).substr(-2)+"."+("00"+n.getMilliseconds()).substr(-3),i=["["+r+" Recorder]"+e],a=arguments,s=2,o=console.log;for("number"==typeof t?o=1==t?console.error:3==t?console.warn:o:s=1;s<a.length;s++)i.push(a[s]);o.apply(console,i)};r.CLog=o;var l=0;r.Sync={O:9,C:9},r.prototype=t.prototype={open:function(t,i){var s=this;t=t||n;var l=function(e,t){t=!!t,o("录音open失败："+e+",isUserNotAllow:"+t,1),i&&i(e,t)},u=function(){o("open成功"),t(),s._SO=0},_=function(t,n){try{e.top.a}catch(e){return void l('无权录音(跨域，请尝试给iframe添加麦克风访问策略，如allow="camera;microphone")')}/Permission|Allow/i.test(t)?l("用户拒绝了录音权限",!0):l(!1===e.isSecureContext?"无权录音(需https)":/Found/i.test(t)?n+"，无可用麦克风":n)},f=r.Sync,c=++f.O,h=f.C;s._O=s._O_=c,s._SO=s._S;var d=function(){if(h!=f.C||!s._O){var e="open被取消";return c==f.O?s.close():e="open被中断",l(e),!0}};if(r.IsOpen())return void u();if(!r.Support())return void _("","此浏览器不支持录音");var m=s.envCheck({envName:"H5",canProcess:!0});if(m)return void l("不能录音："+m);var p=function(e){r.Stream=e,e._call={},d()||setTimeout(function(){d()||(r.IsOpen()?(a(),u()):l("录音功能无效：无音频流"))},100)},v=function(e){var t=e.name||e.message||e.code+":"+e;o("请求录音权限错误",1,e),_(t,"无法录音："+t)},b=r.Scope.getUserMedia({audio:!0},p,v);b&&b.then&&b.then(p)[t&&"catch"](v)},close:function(e){e=e||n;var t=this;t._stop();var i=r.Sync;if(t._O=0,t._O_!=i.O)return o("close被忽略",3),void e();i.C++;var a=r.Stream;if(a){s();for(var l=a.getTracks&&a.getTracks()||a.audioTracks||[],u=0;u<l.length;u++){var _=l[u];_.stop&&_.stop()}a.stop&&a.stop()}r.Stream=0,o("close"),e()},mock:function(e,t){var n=this;return n._stop(),n.isMock=1,n.mockEnvInfo=null,n.buffers=[e],n.recSize=e.length,n.srcSampleRate=t,n},envCheck:function(e){var t,n=this,r=n.set;return t||(n[r.type+"_envCheck"]?t=n[r.type+"_envCheck"](e,r):r.takeoffEncodeChunk&&(t=r.type+"类型不支持设置takeoffEncodeChunk")),t||""},envStart:function(e,t){var n=this,r=n.set;if(n.isMock=e?1:0,n.mockEnvInfo=e,n.buffers=[],n.recSize=0,n.envInLast=0,n.envInFirst=0,n.envInFix=0,n.envInFixTs=[],r.sampleRate=Math.min(t,r.sampleRate),n.srcSampleRate=t,n.engineCtx=0,n[r.type+"_start"]){var i=n.engineCtx=n[r.type+"_start"](r);i&&(i.pcmDatas=[],i.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var n=this,i=n.set,a=n.engineCtx,s=n.srcSampleRate,l=e.length,u=r.PowerLevel(t,l),_=n.buffers,f=_.length;_.push(e);var c=_,h=f,d=Date.now(),m=Math.round(l/s*1e3);n.envInLast=d,1==n.buffers.length&&(n.envInFirst=d-m);var p=n.envInFixTs;p.splice(0,0,{t:d,d:m});for(var v=d,b=0,g=0;g<p.length;g++){var y=p[g];if(d-y.t>3e3){p.length=g;break}v=y.t,b+=y.d}var S=p[1],k=d-v;if(k-b>k/3&&(S&&k>1e3||p.length>=6)){var E=d-S.t-m;if(E>m/5){var w=!i.disableEnvInFix;if(o("["+d+"]"+(w?"":"未")+"补偿"+E+"ms",3),n.envInFix+=E,w){var R=new Int16Array(E*s/1e3);l+=R.length,_.push(R)}}}var A=n.recSize,T=l,M=A+T;if(n.recSize=M,a){var L=r.SampleData(_,s,i.sampleRate,a.chunkInfo);a.chunkInfo=L,A=a.pcmSize,T=L.data.length,M=A+T,a.pcmSize=M,_=a.pcmDatas,f=_.length,_.push(L.data),s=L.sampleRate}var x=Math.round(M/s*1e3),B=_.length,O=c.length,C=function(){for(var e=I?0:-T,t=null==_[0],r=f;r<B;r++){var s=_[r];null==s?t=1:(e+=s.length,a&&s.length&&n[i.type+"_encode"](a,s))}if(t&&a){var r=h;for(c[0]&&(r=0);r<O;r++)c[r]=null}t&&(e=I?T:0,_[0]=null),a?a.pcmSize+=e:n.recSize+=e},I=i.onProcess(_,u,x,s,f,C);if(!0===I){for(var P=0,g=f;g<B;g++)null==_[g]?P=1:_[g]=new Int16Array(0);P?o("未进入异步前不能清除buffers",3):a?a.pcmSize-=T:n.recSize-=T}else C()},start:function(){if(!r.IsOpen())return void o("未open",1);o("开始录音");var e=this,t=(e.set,r.Ctx);if(e._stop(),e.state=0,e.envStart(null,t.sampleRate),e._SO&&e._SO+1!=e._S)return void o("start被中断",3);e._SO=0;var n=function(){e.state=1,e.resume()};"suspended"==t.state?t.resume().then(function(){o("ctx resume"),n()}):n()},pause:function(){var e=this;e.state&&(e.state=2,o("pause"),delete r.Stream._call[e.id])},resume:function(){var e=this;e.state&&(e.state=1,o("resume"),e.envResume(),r.Stream._call[e.id]=function(t,n){1==e.state&&e.envIn(t,n)})},_stop:function(e){var t=this,n=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[n.type+"_stop"]&&(t[n.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(e,t,n){var i,a=this,s=a.set;o("Stop "+(a.envInLast?a.envInLast-a.envInFirst+"ms 补"+a.envInFix+"ms":"-"));var l=function(){a._stop(),n&&a.close()},u=function(e){o("结束录音失败："+e,1),t&&t(e),l()},_=function(t,n){if(o("结束录音 编码"+(Date.now()-i)+"ms 音频"+n+"ms/"+t.size+"b"),s.takeoffEncodeChunk)o("启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据",3);else if(t.size<Math.max(100,n/2))return void u("生成的"+s.type+"无效");e&&e(t,n),l()};if(!a.isMock){if(!a.state)return void u("未开始录音");a._stop(!0)}var f=a.recSize;if(!f)return void u("未采集到录音");if(!a.buffers[0])return void u("音频被释放");if(!a[s.type])return void u("未加载"+s.type+"编码器");if(a.isMock){var c=a.envCheck(a.mockEnvInfo||{envName:"mock",canProcess:!1});if(c)return void u("录音错误："+c)}var h=a.engineCtx;if(a[s.type+"_complete"]&&h){var d=Math.round(h.pcmSize/s.sampleRate*1e3);return i=Date.now(),void a[s.type+"_complete"](h,function(e){_(e,d)},u)}i=Date.now();var m=r.SampleData(a.buffers,a.srcSampleRate,s.sampleRate);s.sampleRate=m.sampleRate;var p=m.data,d=Math.round(p.length/s.sampleRate*1e3);o("采样"+f+"->"+p.length+" 花:"+(Date.now()-i)+"ms"),setTimeout(function(){i=Date.now(),a[s.type](p,function(e){_(e,d)},function(e){u(e)})})}},e.Recorder&&e.Recorder.Destroy(),e.Recorder=r,r.LM="2020-11-15 21:36:11",r.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1",r.Traffic=function(){var e=r.TrafficImgUrl;if(e){var t=r.Traffic,n=location.href.replace(/#.*/,"");if(0==e.indexOf("//")&&(e=/^https:/i.test(n)?"https:"+e:"http:"+e),!t[n]){t[n]=1;(new Image).src=e,o("Traffic Analysis Image: Recorder.TrafficImgUrl="+r.TrafficImgUrl)}}}}(window),"function"==typeof e&&e.amd&&e(function(){return Recorder}),"object"==typeof n&&n.exports&&(n.exports=Recorder)}()},{}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.ByteArray=function(){function e(){r(this,e),this.list=[],this.byteOffset=0,this.length=0}return i(e,[{key:"push",value:function(e){this.list.push(e),this.length+=e.length}},{key:"readBytes",value:function(e){if(e>0){for(var t=new Uint8Array(e),n=0;n<e;){if(!(this.list.length>0)){t=t.subarray(0,n);break}var r=this.list.shift(),i=r.length,a=e-n;if(i>=a){var s=r.subarray(0,a);if(t.set(s,n),n+=s.length,a<i){var o=r.subarray(a,i);this.list.unshift(o)}break}t.set(r,n),n+=i}return this.length-=t.length,t}return null}}]),e}()},{}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Util=function(){function e(){r(this,e)}return i(e,null,[{key:"isEmptyString",value:function(e){return void 0==e||null==e||""==e}}]),e}()},{}],7:[function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new u.HttpFlvPlayer;return n.init(e,t),n}function i(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=new _.HttpFlvTalker;return a.init(e,t,n,r,i)?a:null}function a(){return u.HttpFlvPlayer.isSupported()}function s(){return _.HttpFlvTalker.isSupported()}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./player/gplayer-events"),l=e("./talker/gtalker-events"),u=(e("./player/gplayer.js"),e("./player/httpflv-player.js")),_=e("./talker/httpflv-talker.js"),f={};f.createPlayer=r,f.isHttpFlvSupported=a,f.HttpFlvPlayer=u.HttpFlvPlayer,f.GPlayerEvent=o.GPlayerEvent,f.GErrorType=o.GErrorType,f.GPlaybackControlStatus=o.GPlaybackControlStatus,f.createTalker=i,f.isTalkSupported=s,f.HttpFlvTalker=_.HttpFlvTalker,f.GTalkerEvent=l.GTalkerEvent,f.GTalkerConnectStatus=l.GTalkerConnectStatus,f.GTalkerConnectErrorType=l.GTalkerConnectErrorType,n.default=f},{"./player/gplayer-events":9,"./player/gplayer.js":10,"./player/httpflv-player.js":11,"./talker/gtalker-events":12,"./talker/httpflv-talker.js":14}],8:[function(e,t,n){"use strict";t.exports=e("./gmedia.js").default},{"./gmedia.js":7}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.GPlayerEvent={ERROR:"error",MEDIA_SOURCE_END:"media_source_end",TIMEUPDATE:"timeupdate",STATISTICS_INFO:"statistics_info",PLAYBACK_CONTROL_EVENT:"playback_control_event"},n.GErrorType={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},n.GPlaybackControlStatus={SeekStart:0,SeekFail:1,SeekSuccess:2}},{}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.GPlayer=function(){function e(t){r(this,e),this._type=t||"undefined"}return i(e,[{key:"init",value:function(e,t){}},{key:"on",value:function(e,t){}},{key:"off",value:function(e){}},{key:"attachMediaElement",value:function(e){}},{key:"load",value:function(){}},{key:"play",value:function(){}},{key:"capture",value:function(){}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"seekToNewestTime",value:function(){}},{key:"seek",value:function(e){}},{key:"destroy",value:function(){}}]),e}()},{}],11:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpFlvPlayer=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./gplayer-events.js"),l=e("./gplayer.js"),u=e("flv-g7.js"),_=function(e){return e&&e.__esModule?e:{default:e}}(u),f={None:0,Active:1,Passive:2};n.HttpFlvPlayer=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"httpflv-player"));return e.TAG="HttpFlvPlayer",e.player=null,e.element=null,e.isLive=!0,e.playbackPlan=1,e.playbackControl=f.None,e.streamEnd=!1,e.needSeek=!1,e.seeking=!1,e.seekTime=0,e.newPlayStartTime=0,e.lastSendSeekTs=0,e.callbackTimeUpdate=null,e.callbackStatistics=null,e.callbackError=null,e.callbackMediaSourceEnd=null,e.callbackPlaybackControlEvent=null,e.checkerSeek=null,e.e={onTimeUpdate:e._onElementTime.bind(e)},e}return a(t,e),s(t,[{key:"init",value:function(e,t){this._checkConfig(t),this.isLive=this._checkIfLive(e),this.playbackControl=this._checkPlaybackControl(e),this.player=_.default.createPlayer({isLive:this.isLive,type:"flv",url:e},{lazyLoad:!1,enableStashBuffer:!1,deferLoadAfterSourceOpen:!0}),this.player.on(_.default.Events.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),this.player.on(_.default.Events.ERROR,this._onError.bind(this)),this.player.setMediaSourceEndCallback(this._onMediaSourceEnd.bind(this)),this.player.setStreamTimeCallback(this._onStreamTime.bind(this))}},{key:"on",value:function(e,t){e===o.GPlayerEvent.TIMEUPDATE?this.callbackTimeUpdate=t:e===o.GPlayerEvent.STATISTICS_INFO?this.callbackStatistics=t:e===o.GPlayerEvent.ERROR?this.callbackError=t:e===o.GPlayerEvent.MEDIA_SOURCE_END?this.callbackMediaSourceEnd=t:e===o.GPlayerEvent.PLAYBACK_CONTROL_EVENT&&(this.callbackPlaybackControlEvent=t)}},{key:"off",value:function(e){e===o.GPlayerEvent.TIMEUPDATE?this.callbackTimeUpdate=null:e===o.GPlayerEvent.STATISTICS_INFO?this.callbackStatistics=null:e===o.GPlayerEvent.ERROR?this.callbackError=null:e===o.GPlayerEvent.MEDIA_SOURCE_END?this.callbackMediaSourceEnd=null:e===o.GPlayerEvent.PLAYBACK_CONTROL_EVENT&&(this.callbackPlaybackControlEvent=null)}},{key:"attachMediaElement",value:function(e){this.element=e,this.element.addEventListener("timeupdate",this.e.onTimeUpdate),this.player.attachMediaElement(e)}},{key:"load",value:function(){this.player.load()}},{key:"play",value:function(){this.player.play()}},{key:"capture",value:function(){var e=document.createElement("canvas");return e.width=this.element.videoWidth,e.height=this.element.videoHeight,e.getContext("2d").drawImage(this.element,0,0,e.width,e.height),e.toDataURL()}},{key:"pause",value:function(){return this.element.pause(),!1}},{key:"resume",value:function(){return this.element.play(),!1}},{key:"seekToNewestTime",value:function(){var e=this.element.buffered;if(e.length>0){var t=(e.start(e.length-1),e.end(e.length-1));this.element.currentTime=t}}},{key:"seek",value:function(e){return null!=this.element&&(!this.seeking&&(null!=this.callbackPlaybackControlEvent&&this.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekStart,"开始切换播放时间"),!!this._seekByCached(e)&&(this.playbackControl==f.Active?this._seekByActive(e):this._seekByPassive(e),!0)))}},{key:"destroy",value:function(){null!=this.player&&(this.player.pause(),this.player.unload(),this.player.detachMediaElement(),this.player.destroy(),this.player=null),null!=this.element&&(this.element.removeEventListener("timeupdate",this.e.onTimeUpdate),this.element=null)}},{key:"_checkConfig",value:function(e){null!=e&&null!=e.playbackPlan&&(this.playbackPlan=e.playbackPlan)}},{key:"_checkIfLive",value:function(e){return-1==e.indexOf("g7-flv-video-playback")}},{key:"_checkPlaybackControl",value:function(e){var t=e.split("&stream=");return t.length<2||t[1].length<3?f.None:"131"==t[1].substring(0,3)?f.Passive:f.Active}},{key:"_seekByCached",value:function(e){if(!this.streamEnd)return!0;this.seeking=!0;for(var t=!1,n=this.element.buffered,r=0;r<n.length;r++){var i=n.start(r),a=n.end(r);e>i&&e<a&&(t=!0)}return t&&e>this.element.currentTime?(this.element.currentTime=e,null!=this.callbackPlaybackControlEvent&&this.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekSuccess,"切换播放时间成功")):null!=this.callbackPlaybackControlEvent&&this.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekFail,"缓冲流已结束，无法切换到未缓冲区域"),this.seeking=!1,!1}},{key:"_seekByActive",value:function(e){var t=this;this.seeking=!0,this.lastSendSeekTs=(new Date).getTime(),this.checkerSeek=setTimeout(function(){t.needSeek=!1,t.seeking=!1,null!=t.callbackPlaybackControlEvent&&t.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekFail,"切换播放时间失败，请重新尝试")},15e3),this.seekTime=e,this.needSeek=!0}},{key:"_seekByPassive",value:function(e){var t=this;this.seeking=!0,this.seekTime=e;var n=this.element.buffered;if(n.length>0){var r=(n.start(0),n.end(0));this.newPlayStartTime=r,this.element.currentTime=this.newPlayStartTime}setTimeout(function(){t.seeking=!1,null!=t.callbackPlaybackControlEvent&&t.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekSuccess,"切换播放时间成功")},1e3)}},{key:"_onStatisticsInfo",value:function(e){if(null!=this.callbackStatistics){var t={};t.speed=e.speed,this.callbackStatistics(t)}}},{key:"_onError",value:function(e,t,n){if(null!=this.callbackError){var r=t,i=e;this.callbackError(e,r,i)}}},{key:"_onMediaSourceEnd",value:function(e){this.streamEnd=!0,null!=this.callbackMediaSourceEnd&&this.callbackMediaSourceEnd()}},{key:"_onElementTime",value:function(e){if(1==this.playbackPlan)return void(null!=this.callbackTimeUpdate&&null!=this.element&&this.callbackTimeUpdate(this.element.currentTime));if(this.playbackControl===f.Active)this.seeking||null==this.callbackTimeUpdate||null==this.element||this.callbackTimeUpdate(this.element.currentTime);else if(this.playbackControl===f.Passive&&!this.seeking&&null!=this.callbackTimeUpdate&&null!=this.element){var t=this.seekTime+(this.element.currentTime-this.newPlayStartTime);this.callbackTimeUpdate(t)}}},{key:"_onStreamTime",value:function(e){var t=this;if(this.needSeek){if(Math.abs(1e3*this.seekTime-e)>=1e3)return;return null!=this.checkerSeek&&(clearTimeout(this.checkerSeek),this.checkerSeek=null),this.needSeek=!1,void setTimeout(function(){t.seeking=!1,t.element.currentTime=e/1e3;var n=(new Date).getTime()-t.lastSendSeekTs;console.log("切换耗时: "+n),null!=t.callbackPlaybackControlEvent&&t.callbackPlaybackControlEvent(o.GPlaybackControlStatus.SeekSuccess,"切换播放时间成功")},1e3)}}}],[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}}]),t}(l.GPlayer)},{"./gplayer-events.js":9,"./gplayer.js":10,"flv-g7.js":1}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.GTalkerEvent={CONNECT_STATUS:"connect_status"},n.GTalkerConnectStatus={ConnectSuccess:"ConnectSuccess",ConnectError:"ConnectError"},n.GTalkerConnectErrorType={DeviceNotResponding:"DeviceNotResponding",DeviceStopedResponding:"DeviceStopedResponding",DownLinkFail:"DownLinkFail",UpLinkFail:"UpLinkFail",WaitOpenMicrophoneTimeout:"WaitOpenMicrophoneTimeout",NotAllowOpenMicrophone:"NotAllowOpenMicrophone"}},{}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.GTalker=function(){function e(t){r(this,e),this._type=t||"undefined"}return i(e,[{key:"init",value:function(e,t,n,r,i){}},{key:"on",value:function(e,t){}},{key:"off",value:function(e){}},{key:"attachMediaElement",value:function(e){}},{key:"load",value:function(){}},{key:"destroy",value:function(){}}]),e}()},{}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpFlvTalker=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./gtalker-events.js"),u=e("./gtalker.js"),_=e("../common/bytearray.js"),f=e("../common/util.js"),c=e("flv-g7.js"),h=r(c),d=e("recorder-core"),m=r(d);e("recorder-core/src/engine/mp3"),e("recorder-core/src/engine/mp3-engine");n.HttpFlvTalker=function(e){function t(){i(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"httpflv-talker"));return e.TAG="HttpFlvTalker",e.downUrl=null,e.upUrl=null,e.imei=null,e.channel=null,e.player=null,e.recorder=null,e.sender=null,e.element=null,e.callbackConnectStatus=null,e.byteArray=new _.ByteArray,e.timerCheck=null,e.timerSend=null,e.hasReceiveServerData=!1,e.hasSendClientData=!1,e.hasWaitOpenMicrophoneTimeout=!1,e.hasDestory=!1,e}return s(t,e),o(t,[{key:"init",value:function(e,t,n,r,i){return this.downUrl=e,this.upUrl=t,this.imei=n,this.channel=r,!!this._checkInputParam()&&(this._startPlayer(e),!0)}},{key:"on",value:function(e,t){e===l.GTalkerEvent.CONNECT_STATUS&&(this.callbackConnectStatus=t)}},{key:"off",value:function(e){e===l.GTalkerEvent.CONNECT_STATUS&&(this.callbackConnectStatus=null)}},{key:"attachMediaElement",value:function(e){this.element=e,this.element.addEventListener("loadeddata",this._onPlayerLoadedData.bind(this),{once:!0}),this.player.on(h.default.Events.ERROR,this._onPlayerError.bind(this)),this.player.setMediaSourceEndCallback(this._onPlayerMediaSourceEnd.bind(this)),this.player.attachMediaElement(e)}},{key:"load",value:function(){this.player.load(),this._startSender(this.upUrl)}},{key:"destroy",value:function(){this.hasDestory=!0,this._destroyPlayer(),this._destroySender(),this._destroyRecorder(),this._destroySendProc()}},{key:"_checkInputParam",value:function(){return!f.Util.isEmptyString(this.downUrl)&&!f.Util.isEmptyString(this.upUrl)&&(!f.Util.isEmptyString(this.imei)&&!(this.channel<0||this.channel>255))}},{key:"_startPlayer",value:function(e){this._destroyPlayer(),this.player=h.default.createPlayer({isLive:!0,type:"flv",url:e},{lazyLoad:!1,enableStashBuffer:!1,deferLoadAfterSourceOpen:!0})}},{key:"_onPlayerLoadedData",value:function(){this.hasReceiveServerData=!0,this.hasSendClientData&&null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectSuccess,"")}},{key:"_onPlayerError",value:function(e,t,n){null!=this.callbackConnectStatus&&(this.hasReceiveServerData?this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.DownLinkFail):this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.DeviceNotResponding))}},{key:"_onPlayerMediaSourceEnd",value:function(e){null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.DeviceStopedResponding)}},{key:"_destroyPlayer",value:function(){null!=this.player&&(this.player.pause(),this.player.unload(),this.player.detachMediaElement(),this.player.destroy(),this.player=null),null!=this.element&&(this.element=null)}},{key:"_startSender",value:function(e){this.sender=new WebSocket(e),this.sender.onopen=this._onSenderOpen.bind(this),this.sender.onmessage=this._onSenderMsg.bind(this),this.sender.onclose=this._onSenderClose.bind(this),this.sender.onerror=this._onSenderError.bind(this)}},{key:"_onSenderOpen",value:function(){this._startRecorder()}},{key:"_onSenderMsg",value:function(e){}},{key:"_onSenderClose",value:function(e){null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.UpLinkFail)}},{key:"_onSenderError",value:function(e){}},{key:"_destroySender",value:function(){this.sender.close(),this.sender=null}},{key:"_startRecorder",value:function(){this.recorder&&this.recorder.close(),this.recorder=(0,m.default)({type:"mp3",sampleRate:8e3,bitRate:16,onProcess:this._onReceiveMicrophoneData.bind(this)}),this.timerCheck=setTimeout(this._timeoutCheckIfAllowOpenMicrophone.bind(this),1e4),this.recorder.open(this._onAllowOpenMicrophone.bind(this),this._onNotAllowOpenMicrophone.bind(this))}},{key:"_timeoutCheckIfAllowOpenMicrophone",value:function(){this.hasWaitOpenMicrophoneTimeout=!0,null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.WaitOpenMicrophoneTimeout)}},{
key:"_onAllowOpenMicrophone",value:function(){this.hasWaitOpenMicrophoneTimeout||(clearTimeout(this.timerCheck),this.hasSendClientData=!0,this.hasReceiveServerData&&null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectSuccess,""),this.recorder.start(),this._sendProc())}},{key:"_onNotAllowOpenMicrophone",value:function(e,t){clearTimeout(this.timerCheck),null!=this.callbackConnectStatus&&this.callbackConnectStatus(l.GTalkerConnectStatus.ConnectError,l.GTalkerConnectErrorType.NotAllowOpenMicrophone)}},{key:"_onReceiveMicrophoneData",value:function(e,t,n,r){var i=e[e.length-1].buffer,a=new Uint8Array(i);this.byteArray.push(a)}},{key:"_destroyRecorder",value:function(){this.recorder.close(),this.recorder=null}},{key:"_sendProc",value:function(){if(!this.hasDestory)if(this.byteArray.length<640)this.timerSend=setTimeout(this._sendProc.bind(this),5);else{var e=this.byteArray.readBytes(640),t=new _.ByteArray;t.push(new Uint8Array([49,50,99,100]));for(var n=this.imei.split(""),r=0;r<n.length;r++)t.push(new Uint8Array([n[r].charCodeAt()]));t.push(new Uint8Array([parseInt(this.channel)])),t.push(new Uint8Array([Math.floor(2.5)])),t.push(new Uint8Array([128])),t.push(e);var i=4+n.length+3+640;null!=this.sender&&this.sender.send(t.readBytes(i)),this._sendProc()}}},{key:"_destroySendProc",value:function(){clearTimeout(this.timerSend)}}],[{key:"isSupported",value:function(){return"undefined"!=typeof WebSocket&&m.default.Support()&&window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}}]),t}(u.GTalker)},{"../common/bytearray.js":5,"../common/util.js":6,"./gtalker-events.js":12,"./gtalker.js":13,"flv-g7.js":1,"recorder-core":4,"recorder-core/src/engine/mp3":3,"recorder-core/src/engine/mp3-engine":2}]},{},[8])(8)});
//# sourceMappingURL=gmedia.min.js.map
